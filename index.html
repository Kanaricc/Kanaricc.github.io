<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">
  <link rel="alternate" href="/atom.xml" title="Kanari's blog" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.json',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="keywords" content="kanari,blog,icpc,coding">
<meta property="og:type" content="website">
<meta property="og:title" content="Kanari&#39;s blog">
<meta property="og:url" content="https://blog.kanari.moe/index.html">
<meta property="og:site_name" content="Kanari&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kanari&#39;s blog">
  <link rel="canonical" href="https://blog.kanari.moe/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Kanari's blog</title>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-104395871-2"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-104395871-2');
    }
  </script>








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kanari's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-projects">
      
    

    <a href="/projects/" rel="section"><i class="menu-item-icon fa fa-fw fa-bullseye"></i> <br>项目</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/27/problem-liaoning-ships-voyage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/27/problem-liaoning-ships-voyage/" class="post-title-link" itemprop="url">Liaoning Ship’s Voyage</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-27 14:13:50 / 修改时间：14:23:12" itemprop="dateCreated datePublished" datetime="2019-10-27T14:13:50+08:00">2019-10-27</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Liaoning ship, which named after a province of China, is the first aircraft carrier commissioned into the People's Liberation Army Navy. It was bought from Ukraine as a stripped hulk and was rebuilt by China as an important part of China’s blue water Navy plan. Liaoning ship has sailed far into the Pacific Ocean for serval times, which shows the power and resolve of China to defend her integrity of territory.</p>
<p>Now Liaoning ship is on a new voyage to the Atlantic Ocean for a maneuver! The vast maneuver region on the ocean can be seen as an n×n grid which has n×n crosspoints. Each crosspoint stands for a check point of the maneuver region. Liaoning starts from the bottom-left check point whose coordinate is (0,0), and its destination is the upper-right checkpoint whose coordinate is (n-1,n-1). The positive side of the x axis points to the right, and the positive side of the y axis points up. All check points’ coordinates are integral. During each move, Liaoning can go from one check point to its adjacent 8 check points along a straight line, and each move takes Liaoning one day. Some check points are not available to go due to the bad weather. And, as you know, on the Atlantic Ocean, there is a Bermuda Triangle in which many ships and planes were missing. Liaoning can’t take risk to go into that triangle. Of course, Liaoning can’t go outside the maneuver region. Please figure out a route for Liaoning to reach its destination as soon as possible.</p>
<h2 id="分析">分析</h2>
<p>实际上本体是个Dijkstra，但是两点是否相连需要使用到计算几何的东西。重点就在于如何判断行进过程是否穿过了百慕大三角。</p>
<p>然后就WA了8发。</p>
<p>实际判断时会有很多问题。例如从边上经过，从外界到边，从边到边，从边到外界，从外界到点，从点到外界，从边穿过点……如果一开始选择的判断方法有锅的话，之后就改不出来了，只能WA……</p>
<p>最终想出来的解决办法是拿到行进线段与三角形三边的交点，连接交点构造新线段后，判断线段中点是否在三角形内；并同时判断起点终点是否在三角形内。这样就能避免掉复杂的讨论。</p>
<p>其次，顺便把已经在三角形内的整点全部标记了不能访问。</p>
<p>这样就过了。</p>
<h2 id="代码">代码</h2>
<p>板子判点在线段部分有问题，要改。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> fuck=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS=<span class="number">1e-7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x&gt;-EPS)-(x&lt;EPS);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vec</span>&#123;</span></span><br><span class="line">    <span class="keyword">double</span> x,y;<span class="comment">//never change it yourself unless you dont need polar angle.</span></span><br><span class="line">    <span class="keyword">double</span> _polar;<span class="comment">// make cache to accumulate speed as atan is too slow.</span></span><br><span class="line"></span><br><span class="line">    Vec()&#123;</span><br><span class="line">        x=y=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Vec(<span class="keyword">double</span> x,<span class="keyword">double</span> y):x(x),y(y)&#123;</span><br><span class="line">        _polar=<span class="built_in">atan2</span>(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(<span class="keyword">const</span> Vec &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*b.x+y*b.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(<span class="keyword">const</span> Vec &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*b.y-b.x*y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">len</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sqrt</span>(sqlen());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">sqlen</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*x+y*y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Vec <span class="title">normalize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">double</span> l=len();</span><br><span class="line">        <span class="keyword">return</span> Vec(x/l,y/l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Vec <span class="title">rotate</span><span class="params">(<span class="keyword">double</span> angle)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Vec(x*<span class="built_in">cos</span>(angle)-y*<span class="built_in">sin</span>(angle),x*<span class="built_in">sin</span>(angle)+y*<span class="built_in">cos</span>(angle));</span><br><span class="line">    &#125;</span><br><span class="line">    Vec <span class="keyword">operator</span> * (<span class="keyword">double</span> factor)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Vec(x*factor,y*factor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> Vec &amp;b)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cross(b);</span><br><span class="line">    &#125;</span><br><span class="line">    Vec <span class="keyword">operator</span> - (<span class="keyword">const</span> Vec &amp;b)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Vec(x-b.x,y-b.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Vec <span class="keyword">operator</span> +(<span class="keyword">const</span> Vec &amp;b)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Vec(x+b.x,y+b.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">polar</span><span class="params">()</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _polar;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">leftby</span><span class="params">(<span class="keyword">const</span> Vec &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sgn(b.cross(*<span class="keyword">this</span>))&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">samed</span><span class="params">(<span class="keyword">const</span> Vec &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sgn(<span class="keyword">this</span>-&gt;cross(b))==<span class="number">0</span> &amp;&amp; sgn(<span class="keyword">this</span>-&gt;dot(b))&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Vec &amp;b)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;polar()&lt;b.polar();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Vec &amp;b)<span class="keyword">const</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sgn(b.x-<span class="keyword">this</span>-&gt;x)==<span class="number">0</span> &amp;&amp;sgn(b.y-<span class="keyword">this</span>-&gt;y)==<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; out,<span class="keyword">const</span> Vec &amp;b)&#123;</span><br><span class="line">    out&lt;&lt;<span class="string">"("</span>&lt;&lt;b.x&lt;&lt;<span class="string">","</span>&lt;&lt;b.y&lt;&lt;<span class="string">")"</span>;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> Vec Point;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span>&#123;</span></span><br><span class="line">    Point pos;</span><br><span class="line">    Vec dirc;</span><br><span class="line">    Line(Point pos=Point(<span class="number">0</span>,<span class="number">0</span>),Vec dirc=Vec(<span class="number">0</span>,<span class="number">0</span>)):pos(pos),dirc(dirc)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Line <span class="title">fromPoints</span><span class="params">(Point a,Point b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Line(a,b-a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getarea</span><span class="params">(<span class="keyword">const</span> Line &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(dirc.cross(b.dirc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获得垂线</span></span><br><span class="line">    <span class="function">Line <span class="title">getppd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Line(pos+dirc*<span class="number">0.5</span>,dirc.rotate(PI/<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> what will happen if they have no intersection,-nan</span></span><br><span class="line">    <span class="function">Point <span class="title">getintersection</span><span class="params">(<span class="keyword">const</span> Line &amp;b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">        Vec down=<span class="keyword">this</span>-&gt;pos-b.pos;</span><br><span class="line">        <span class="keyword">double</span> aa=b.dirc.cross(down);</span><br><span class="line">        <span class="keyword">double</span> bb=<span class="keyword">this</span>-&gt;dirc.cross(b.dirc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;pos+<span class="keyword">this</span>-&gt;dirc*(aa/bb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">point_on_line</span><span class="params">(Point point)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!dirc.samed(point-pos))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(sgn((point-pos).sqlen()-dirc.sqlen())&gt;<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">on_ver</span><span class="params">(Point point)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sgn(point.x-pos.x)==<span class="number">0</span> &amp;&amp; sgn(point.y-pos.y)==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(sgn(point.x-(pos.x+dirc.x))==<span class="number">0</span> &amp;&amp; sgn(point.y-(pos.y+dirc.y))==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">get_distance</span><span class="params">(Point point)</span></span>&#123;</span><br><span class="line">        Line ppd=getppd();</span><br><span class="line">        ppd.pos=point;</span><br><span class="line"></span><br><span class="line">        Point intersection=getintersection(ppd);</span><br><span class="line"></span><br><span class="line">        ppd.dirc=intersection-point;</span><br><span class="line">        Vec v=intersection-pos;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(v.cross(point-pos)/v.len());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">get_distance</span><span class="params">(Line line)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get_distance(line.pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Point points[<span class="number">3</span>];</span><br><span class="line">Line triangle[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> game[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">get_area</span><span class="params">(<span class="built_in">vector</span>&lt;Point&gt; &amp;points)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(points.size()&lt;<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(points.begin(),points.end(),[](<span class="keyword">const</span> Point &amp;a,<span class="keyword">const</span> Point &amp;b)&#123;</span><br><span class="line">        <span class="keyword">return</span> a.polar()&lt;b.polar();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="function">Point <span class="title">base</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">    Point last=points[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;points.size();i++)&#123;</span><br><span class="line">        Vec a=last-base,b=points[i]-base;</span><br><span class="line">        res+=a.cross(b)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        last=points[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//add the last point(also the first point)</span></span><br><span class="line">    Vec a=last-base,b=points[<span class="number">0</span>]-base;</span><br><span class="line">    res+=a.cross(b)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">in_triangle</span><span class="params">(Point p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fuck)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(Line::fromPoints(points[i%<span class="number">3</span>],points[(i+<span class="number">1</span>)%<span class="number">3</span>]).point_on_line(p))<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> areas=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;Point&gt; ps;</span><br><span class="line">        ps.push_back(points[i%<span class="number">3</span>]);</span><br><span class="line">        ps.push_back(points[(i+<span class="number">1</span>)%<span class="number">3</span>]);</span><br><span class="line">        ps.push_back(p);</span><br><span class="line">        areas+=get_area(ps);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;Point&gt; ps;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)ps.push_back(points[i]);</span><br><span class="line">    <span class="keyword">return</span> sgn(areas-get_area(ps))==<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">has_intersetct</span><span class="params">(Line line)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fuck)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>; </span><br><span class="line">    Point p[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">bool</span> flg[<span class="number">3</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sgn(line.dirc.cross(triangle[i].dirc))==<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">        p[i]=line.getintersection(triangle[i]);</span><br><span class="line">        <span class="keyword">if</span>(line.point_on_line(p[i])||p[i]==line.pos) flg[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(in_triangle(line.pos)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(in_triangle(line.pos+line.dirc)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    Line l;</span><br><span class="line">    <span class="keyword">if</span>(flg[<span class="number">0</span>]&amp;&amp;flg[<span class="number">1</span>])</span><br><span class="line">    &#123;</span><br><span class="line">		l=Line::fromPoints(p[<span class="number">0</span>],p[<span class="number">1</span>]);</span><br><span class="line">	    <span class="keyword">if</span>(in_triangle(l.pos+l.dirc*<span class="number">0.5</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flg[<span class="number">2</span>]&amp;&amp;flg[<span class="number">1</span>])</span><br><span class="line">    &#123;</span><br><span class="line">		l=Line::fromPoints(p[<span class="number">2</span>],p[<span class="number">1</span>]);</span><br><span class="line">	    <span class="keyword">if</span>(in_triangle(l.pos+l.dirc*<span class="number">0.5</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flg[<span class="number">0</span>]&amp;&amp;flg[<span class="number">2</span>])</span><br><span class="line">    &#123;</span><br><span class="line">		l=Line::fromPoints(p[<span class="number">0</span>],p[<span class="number">2</span>]);</span><br><span class="line">	    <span class="keyword">if</span>(in_triangle(l.pos+l.dirc*<span class="number">0.5</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">v4q</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i,j,step;</span><br><span class="line">    v4q(<span class="keyword">int</span> i,<span class="keyword">int</span> j,<span class="keyword">int</span> step):i(i),j(j),step(step)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> v4q &amp;other)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> step&gt;other.step;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> nlen;</span><br><span class="line"><span class="keyword">int</span> dist[MAXN][MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    priority_queue&lt;v4q&gt; pq;</span><br><span class="line">    pq.push(v4q(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(dist));</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">    dist[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!pq.empty())&#123;</span><br><span class="line">        v4q cur=pq.top();pq.pop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(vis[cur.i][cur.j])<span class="keyword">continue</span>;</span><br><span class="line">        vis[cur.i][cur.j]=<span class="number">1</span>;</span><br><span class="line">		<span class="comment">//printf("now:%d %d\n",cur.i,cur.j);</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=max(<span class="number">1</span>,cur.i<span class="number">-1</span>);i&lt;=min(nlen,cur.i+<span class="number">1</span>);i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=max(<span class="number">1</span>,cur.j<span class="number">-1</span>);j&lt;=min(nlen,cur.j+<span class="number">1</span>);j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==cur.i &amp;&amp; j==cur.j)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(game[i][j]==<span class="string">'#'</span>)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(has_intersetct(Line::fromPoints(Point(j<span class="number">-1</span>,i<span class="number">-1</span>),Point(cur.j<span class="number">-1</span>,cur.i<span class="number">-1</span>))))<span class="keyword">continue</span>;</span><br><span class="line">               <span class="comment">//cout&lt;&lt;"arrive "&lt;&lt;i&lt;&lt;","&lt;&lt;j;</span></span><br><span class="line">                <span class="keyword">if</span>(dist[i][j]&gt;dist[cur.i][cur.j]+<span class="number">1</span>)&#123;</span><br><span class="line">                    dist[i][j]=dist[cur.i][cur.j]+<span class="number">1</span>;</span><br><span class="line">                    <span class="comment">//cout&lt;&lt;" and update it to "&lt;&lt;dist[i][j];</span></span><br><span class="line">                    pq.push(v4q(i,j,dist[i][j]));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//cout&lt;&lt;endl;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist[nlen][nlen];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//	freopen("in.txt","r",stdin);</span></span><br><span class="line"><span class="comment">//	freopen("out.txt","w",stdout);</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;nlen)&#123;</span><br><span class="line">    	fuck=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            Point &amp;p=points[i];</span><br><span class="line">            <span class="built_in">cin</span>&gt;&gt;p.x&gt;&gt;p.y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            triangle[i]=Line::fromPoints(points[i%<span class="number">3</span>],points[(i+<span class="number">1</span>)%<span class="number">3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sgn(triangle[i%<span class="number">3</span>].dirc.cross(triangle[(i+<span class="number">1</span>)%<span class="number">3</span>].dirc))==<span class="number">0</span>)&#123;</span><br><span class="line">                fuck=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=nlen;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=nlen;j++)&#123;</span><br><span class="line">                <span class="built_in">cin</span>&gt;&gt;game[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//solve triangle</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=nlen;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=nlen;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(in_triangle(Point(j<span class="number">-1</span>,i<span class="number">-1</span>)))game[i][j]=<span class="string">'#'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        for(int i=nlen;i&gt;=1;i--)&#123;</span></span><br><span class="line"><span class="comment">            for(int j=1;j&lt;=nlen;j++)&#123;</span></span><br><span class="line"><span class="comment">                cout&lt;&lt;game[i][j];</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            cout&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans=solve();</span><br><span class="line">        <span class="keyword">if</span>(ans!=<span class="number">0x3f3f3f3f</span>)<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="string">"-1\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/23/problem-hearthrock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/23/problem-hearthrock/" class="post-title-link" itemprop="url">[CCPC2017杭州] Heathrock</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-23 19:13:24 / 修改时间：19:22:11" itemprop="dateCreated datePublished" datetime="2019-10-23T19:13:24+08:00">2019-10-23</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这题意太长了，我懒得复制。</p>
<h2 id="分析">分析</h2>
<p>额……其实就是爆搜模拟。但是状态比较多，需要记双方生命值，3个随从的生命，当前场数，魔力，体力，以及一些玄学优化。</p>
<ul>
<li>自选目标的牌一定会放在回合的较后出，因为其不会累加魔力。</li>
<li>如果剩下的牌全踢脸也踢不死，直接返回。</li>
</ul>
<p>之后就能跑得飞快。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/10/23/problem-hearthrock/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/21/problem-master-of-sequence/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/21/problem-master-of-sequence/" class="post-title-link" itemprop="url">[CCPC 2017] Master of Sequence</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-21 15:37:40 / 修改时间：15:56:18" itemprop="dateCreated datePublished" datetime="2019-10-21T15:37:40+08:00">2019-10-21</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>给出2个数列，<span class="math inline">\(\{a_i\},\{b_i\}\)</span>.要求支持以下操作</p>
<ol type="1">
<li>修改数列a的第i个为x</li>
<li>修改数列b的第i个为x</li>
<li>给出k，求最小的t，满足<span class="math inline">\(\sum \lfloor \frac {t-b_i}{a_i} \rfloor \ge k\)</span></li>
</ol>
<p>操作数不多于100000，操作3不多于1000；数列长度不多于10000，<strong>a的值域不大于1000</strong>。</p>
<h2 id="分析">分析</h2>
<p>将<span class="math inline">\(\lfloor \frac {t-b_i}{a_i} \rfloor\)</span>拆开，观察前后可能出现的差。</p>
<p><span class="math display">\[
\lfloor \frac {t}{a_i} \rfloor - \lfloor \frac {b_i}{a_i} \rfloor
\]</span></p>
<p>设<span class="math inline">\(t=k_1a_i+c_1,b_i=k_2a_i+c_2\)</span>，代入观察。</p>
<p><span class="math display">\[
\begin{aligned}
\lfloor \frac {t-b_i}{a_i} \rfloor&amp;=\lfloor \frac {(k_1-k_2)a_i+c_1-c_2}{a_i} \rfloor \\
\end{aligned}
\]</span></p>
<p>可以发现，当把式子拆开时，有2种情况。</p>
<ul>
<li><span class="math inline">\(c_1 &gt; c_2\)</span>，啥事没有。</li>
<li><span class="math inline">\(c_1 &lt; c_2\)</span>，拆开后会多统计一个1。</li>
</ul>
<p>事先统计<span class="math inline">\(\{b_i\}\)</span>模<span class="math inline">\(a\)</span>的余数，那么有<span class="math inline">\(t\)</span>后就能快速数出第2种情况的数量。</p>
<h2 id="代码">代码</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> ll=<span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXA=<span class="number">1010</span>,MAXB=<span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nlen,mlen;</span><br><span class="line"><span class="keyword">int</span> a[MAXB],acnt[MAXA];</span><br><span class="line"><span class="keyword">int</span> b[MAXB];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fts[MAXA][MAXA];</span><br><span class="line"><span class="keyword">int</span> pre[MAXA][MAXA];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">force</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">	pre[i][<span class="number">0</span>]=fts[i][<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;MAXA;j++)&#123;</span><br><span class="line">		pre[i][j]=pre[i][j<span class="number">-1</span>]+fts[i][j];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll base=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(ll k,ll t)</span></span>&#123;</span><br><span class="line">	ll res=-base;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++)&#123;</span><br><span class="line">		res+=(t/i)*acnt[i];</span><br><span class="line">		<span class="keyword">int</span> c=t%i;</span><br><span class="line">		ll offset=pre[i][<span class="number">1000</span>]-pre[i][c];</span><br><span class="line">		res-=offset;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res&gt;=k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">	<span class="built_in">cin</span>.tie(<span class="number">0</span>);<span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> kase;<span class="built_in">cin</span>&gt;&gt;kase;</span><br><span class="line">	<span class="keyword">while</span>(kase--)&#123;</span><br><span class="line">		<span class="built_in">memset</span>(acnt,<span class="number">0</span>,<span class="keyword">sizeof</span>(acnt));</span><br><span class="line">		<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">		base=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">memset</span>(fts,<span class="number">0</span>,<span class="keyword">sizeof</span>(fts));</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;nlen&gt;&gt;mlen;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=nlen;i++)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">			acnt[a[i]]+=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=nlen;i++)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;b[i];</span><br><span class="line">			fts[a[i]][b[i]%a[i]]++;</span><br><span class="line">			base+=b[i]/a[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++)&#123;</span><br><span class="line">			force(i);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mlen;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> opt;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;opt;</span><br><span class="line">			<span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> x,y;</span><br><span class="line">				<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line"></span><br><span class="line">				acnt[a[x]]--;</span><br><span class="line">				fts[a[x]][b[x]%a[x]]--;</span><br><span class="line">				base-=b[x]/a[x];</span><br><span class="line">				force(a[x]);</span><br><span class="line"></span><br><span class="line">				a[x]=y;</span><br><span class="line">				fts[a[x]][b[x]%a[x]]++;</span><br><span class="line">				acnt[a[x]]++;</span><br><span class="line">				base+=b[x]/a[x];</span><br><span class="line">				force(a[x]);</span><br><span class="line"></span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> x,y;</span><br><span class="line">				<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line"></span><br><span class="line">				fts[a[x]][b[x]%a[x]]--;</span><br><span class="line">				base-=b[x]/a[x];</span><br><span class="line">				force(a[x]);</span><br><span class="line"></span><br><span class="line">				b[x]=y;</span><br><span class="line"></span><br><span class="line">				fts[a[x]][b[x]%a[x]]++;</span><br><span class="line">				force(a[x]);</span><br><span class="line">				base+=b[x]/a[x];</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">3</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> qk;<span class="built_in">cin</span>&gt;&gt;qk;</span><br><span class="line">				ll l=<span class="number">0</span>,r=<span class="number">1e13</span>;</span><br><span class="line">				<span class="keyword">while</span>(l+<span class="number">1</span>&lt;r)&#123;</span><br><span class="line">					ll mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">					<span class="keyword">if</span>(check(qk,mid))&#123;</span><br><span class="line">						r=mid;</span><br><span class="line">					&#125;<span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">for</span>(ll i=l;i&lt;=r;i++)&#123;</span><br><span class="line">					<span class="keyword">if</span>(check(qk,i))&#123;</span><br><span class="line">						<span class="built_in">cout</span>&lt;&lt;i&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/14/do-something-with-network-packets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/14/do-something-with-network-packets/" class="post-title-link" itemprop="url">玩一玩网络封包</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-14 17:06:06 / 修改时间：23:23:35" itemprop="dateCreated datePublished" datetime="2019-10-14T17:06:06+08:00">2019-10-14</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/闲扯/" itemprop="url" rel="index"><span itemprop="name">闲扯</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这篇文章是为了在英语课presentation上口胡https准备的。打算在现场演示一次简易的网络攻击，顺便把时间水一水。所以在这时来先简单了解一下网络封包的样子。</p>
<h2 id="osi模型">OSI模型</h2>
<p>标准化的计算机通信模型，试图使各种计算机在世界范围内互连为网络的标准框架。</p>
<p>简单的来说，就是将一次网络通信在不同层级上的抽象，并在不同层上实现功能，完成整个通信系统的构建。虽然看起来虚幻飘渺，我甚至还没学，但接下来的攻击是必须要弄清其是在哪一层面上的，要不然无从下手。</p>
<blockquote>
<p>待补充</p>
</blockquote>
<h2 id="arp-污染">ARP 污染</h2>
<p>这是这次主要开刀的对象，实现较为方便，演示效果也不错。</p>
<p>在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。然而IP协议并不关心MAC地址，所以有必须再有一个底层的协议去将IP和MAC bind起来。ARP协议就是用来做这个的。</p>
<p>当两个节点不在相同局域网时，则需要有网关中转，此时bind的MAC地址为网关MAC。ARP攻击的原理就是将自己伪装成网关，从而劫持整个局域网内的流量。而一旦拿到明文流量后，截取消息、获取密码、修改返回数据，都是可以的。</p>
<h2 id="bettercap">BetterCap</h2>
<p>新一代的“EtterCap”。本来我有点想那scapy来自己写一个工具来着，但是我的重点并不在这，相对现在来说有些耽误时间。</p>
<p>第2个大版本的BetterCap为模块化设计，为了实现我们的目标，需要开启arp，net与proxy模块。arp负责进行投毒，net负责嗅探封包，我们使用proxy来获取修改封包的hook。搭配自己的js脚本就能快速达到目的。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/09/problem-keyboard-purchase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/09/problem-keyboard-purchase/" class="post-title-link" itemprop="url">[CFEDU74 E] Keyboard Purchase</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-09 15:38:43 / 修改时间：23:18:11" itemprop="dateCreated datePublished" datetime="2019-10-09T15:38:43+08:00">2019-10-09</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>当在使用一指禅键入一个字符串的时候，你需要不停的移动手指。比如说输入“af”，手指需要跨过3个键（包括终点）输入“a”和“f”。</p>
<p>针对一个经常输入的字符串，你可以定制一个长条键盘，使得在这个键盘上输入字符串需要移动的距离最短。</p>
<p>给出字符串长度<span class="math inline">\(n\)</span>与字典大小<span class="math inline">\(k\)</span>（小写字母的前<span class="math inline">\(k\)</span>个），给出最优情况下手指需要移动的距离。</p>
<h2 id="分析">分析</h2>
<p>这道题和之前那道marbles很像……或者说状压都挺像的。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/10/09/problem-keyboard-purchase/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/06/problem-coloring-edges/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/06/problem-coloring-edges/" class="post-title-link" itemprop="url">[CF EDU72D] Coloring Edges</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-06 18:49:52 / 修改时间：19:42:09" itemprop="dateCreated datePublished" datetime="2019-10-06T18:49:52+08:00">2019-10-06</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>You are given a directed graph with n vertices and m directed edges without self-loops or multiple edges.</p>
<p>Let's denote the k-coloring of a digraph as following: you color each edge in one of k colors. The k-coloring is good if and only if there no cycle formed by edges of same color.</p>
<p>Find a good k-coloring of given digraph with minimum possible k.</p>
<h2 id="分析">分析</h2>
<p>对我这个菜鸡来说，去染色返祖边的操作并不怎么显然……算了……</p>
<p>没能坚持只有2种颜色的猜想。挂城墙。</p>
<p>没必要挂代码。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/05/problem-marbles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/05/problem-marbles/" class="post-title-link" itemprop="url">[CF585E] Marbles</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-05 22:18:52 / 修改时间：22:34:16" itemprop="dateCreated datePublished" datetime="2019-10-05T22:18:52+08:00">2019-10-05</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Monocarp has arranged n colored marbles in a row. The color of the i-th marble is ai. Monocarp likes ordered things, so he wants to rearrange marbles in such a way that all marbles of the same color form a contiguos segment (and there is only one such segment for each color).</p>
<p>In other words, Monocarp wants to rearrange marbles so that, for every color j, if the leftmost marble of color j is l-th in the row, and the rightmost marble of this color has position r in the row, then every marble from l to r has color j.</p>
<p>To achieve his goal, Monocarp can do the following operation any number of times: choose two neighbouring marbles, and swap them.</p>
<p>You have to calculate the minimum number of operations Monocarp has to perform to rearrange the marbles. Note that the order of segments of marbles having equal color does not matter, it is only required that, for every color, all the marbles of this color form exactly one contiguous segment.</p>
<h2 id="分析">分析</h2>
<p>这道题的翻译就是“重新确定每个颜色的权值，使得逆序对最少”。</p>
<p>然后我就卡了，现在我也不是特别清楚为啥可以dp，只是知道能dp。</p>
<p>选择状态<span class="math inline">\(f(S)\)</span>表示集合<span class="math inline">\(S\)</span>已经全部分配权值时产生的最少逆序对。枚举下一个颜色，给予下一个（较小）权值，并计算代价。</p>
<p><span class="math display">\[
f(S+\{i\})=min\{f(S)+w\}
\]</span></p>
<p>接下来是w的处理。我们需要的是在当前颜色的所有点前的<strong>已经拥有新权值</strong>的点数目，这可以事先预处理。预处理颜色i前颜色j的pair数即可。</p>
<h2 id="代码">代码</h2>
<p>不小心把ptr扔到了里层循环里T了发…</p>
<p>明明第一步完事都很直白了，就是非得被卡一下。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> ll=<span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">400010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXC=<span class="number">21</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> nlen;</span><br><span class="line"><span class="keyword">int</span> num[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pos[MAXC];</span><br><span class="line">ll cnt[MAXC][MAXC];</span><br><span class="line"><span class="keyword">int</span> tick=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> newColor[MAXN];</span><br><span class="line"> </span><br><span class="line">ll dp[<span class="number">1</span>&lt;&lt;MAXC];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;nlen;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nlen;i++)&#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(newColor,<span class="number">-1</span>,<span class="keyword">sizeof</span>(newColor));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nlen;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(newColor[num[i]]==<span class="number">-1</span>)newColor[num[i]]=tick++;</span><br><span class="line">        pos[newColor[num[i]]].push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tick;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;tick;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==j)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> ptr=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;pos[i].size();k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ptr&lt;<span class="number">0</span>)ptr=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(ptr&lt;pos[j].size() &amp;&amp; pos[j][ptr]&lt;pos[i][k])ptr++;</span><br><span class="line">                ptr--;</span><br><span class="line">                <span class="keyword">if</span>(ptr&gt;=<span class="number">0</span> &amp;&amp; pos[j][ptr]&lt;pos[i][k])&#123;</span><br><span class="line">                    cnt[i][j]+=ptr+<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(<span class="number">1</span>&lt;&lt;tick);i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;tick;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>((i&gt;&gt;j)&amp;<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">            ll diff=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;tick;k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>((i&gt;&gt;k)&amp;<span class="number">1</span>)diff+=cnt[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i|(<span class="number">1</span>&lt;&lt;j)]=min(dp[i|(<span class="number">1</span>&lt;&lt;j)],dp[i]+diff);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;dp[(<span class="number">1</span>&lt;&lt;tick)<span class="number">-1</span>]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/05/problem-ticket-game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/05/problem-ticket-game/" class="post-title-link" itemprop="url">[CF585D] Ticket Game</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-05 15:13:27 / 修改时间：16:01:34" itemprop="dateCreated datePublished" datetime="2019-10-05T15:13:27+08:00">2019-10-05</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Monocarp and Bicarp live in Berland, where every bus ticket consists of n digits (n is an even number). During the evening walk Monocarp and Bicarp found a ticket where some of the digits have been erased. The number of digits that have been erased is even.</p>
<p>Monocarp and Bicarp have decided to play a game with this ticket. Monocarp hates happy tickets, while Bicarp collects them. A ticket is considered happy if the sum of the first <span class="math inline">\(\frac n2\)</span> digits of this ticket is equal to the sum of the last <span class="math inline">\(\frac n2\)</span> digits.</p>
<p>Monocarp and Bicarp take turns (and Monocarp performs the first of them). During each turn, the current player must replace any erased digit with any digit from 0 to 9. The game ends when there are no erased digits in the ticket.</p>
<p>If the ticket is happy after all erased digits are replaced with decimal digits, then Bicarp wins. Otherwise, Monocarp wins. You have to determine who will win if both players play optimally.</p>
<h2 id="分析">分析</h2>
<p>在做这道题的时候，我发现了实际上影响答案的只和两边的 已知数的和 以及未知位的数目有关，发现了获胜的根本是前后两部分和的差值大小，发现了先手的目的是<strong>扩大差值</strong>使得后手无法通过某种方式追赶。</p>
<p>但是到这我就卡住了。淦，为什么我这么菜。</p>
<p>接下来要考虑的是<strong>优势</strong>，在这道题里优势就是差值。先手的目的是扩大优势，在大的一边增大会加大优势，而在小的一边置0不会扩大优势；后手要<strong>减小优势</strong>，同样的办法就是在小的一侧置数来追赶另一侧，在大的一侧置0不会更好。</p>
<p>那么，又可以得出先手扩大优势最好的办法是置9（最大）。那么游戏最开始的几步，就是双方在两侧填写9。直到某侧不再有空位。</p>
<p>此时，如果空位在大的一侧，先手必赢。如果空位在小的一侧，继续讨论如下</p>
<p><span class="math display">\[
x_1+x_2+\cdots+x_n=C
\]</span></p>
<p>首先<span class="math inline">\(2|n\)</span>显然。</p>
<p>当C不是9的倍数时，先手总有办法让最终结果偏离。因此该情况只有当<span class="math inline">\(\frac n2 \times 9 = n\)</span>时后手才能获胜。</p>
<h2 id="代码">代码</h2>
<p>嫖了队友的…我瞎xx搞的结论WA23了…</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n/<span class="number">2</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(s[i]==<span class="string">'?'</span>) cnt++;</span><br><span class="line">		<span class="keyword">else</span> sum+=s[i]-<span class="string">'0'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n/<span class="number">2</span>+<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(s[i]==<span class="string">'?'</span>) cnt--;</span><br><span class="line">		<span class="keyword">else</span> sum-=s[i]-<span class="string">'0'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//cout&lt;&lt;cnt&lt;&lt;" "&lt;&lt;sum&lt;&lt;endl;</span></span><br><span class="line">	<span class="keyword">if</span>(sum*<span class="number">2</span>==-cnt*<span class="number">9</span>) <span class="built_in">puts</span>(<span class="string">"Bicarp"</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"Monocarp"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/10/04/suffix-automation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/04/suffix-automation/" class="post-title-link" itemprop="url">后缀自动机</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-04 20:44:05" itemprop="dateCreated datePublished" datetime="2019-10-04T20:44:05+08:00">2019-10-04</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-06 11:33:10" itemprop="dateModified" datetime="2019-10-06T11:33:10+08:00">2019-10-06</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如你所见，后缀自动机。</p>
<blockquote>
<p>然而就nm看不懂，先看不懂它的图是啥，又看不懂它的边是啥，现在还是看不懂它的边是咋找出来的。可是咱不想搞不清楚它是干嘛的就直接用啊靠。</p>
</blockquote>
<p>后缀自动机首先是自动机。一个字符串S的后缀自动机能接受S的所有后缀。基于它的这个性质，它能够做到：</p>
<ul>
<li>查询子串是否出现：这显然跑一次，能在自动机上跑完就是出现过。</li>
<li>统计不同子串的数量：自动机上每条不同的路径对应一个不同的子串。定义<span class="math inline">\(d(x)\)</span>为以x为起点的路径数目，递推即可。</li>
<li>计算所有不同子串的长度总和：得到上面的<span class="math inline">\(d\)</span>。以x为起点，每条路径都会让子串<strong>总</strong>长度增加<strong>路径个</strong>。依然是递推。</li>
<li>字典序第k小子串：当你有路径数了，只需要按照字典序对节点排序，然后像编码一样找。</li>
<li>最小循环移位：指将原字符串首尾相接移位，找到字典序最小的一个。将字符串<span class="math inline">\(S\)</span>断环成链<span class="math inline">\(SS\)</span>，然后建立SAM，贪心找最小直到长度达到<span class="math inline">\(|S|\)</span>即可。</li>
<li>多组子串出现次数：dfs预处理每个节点的终点集合大小。在自动机上查找串<span class="math inline">\(P\)</span>对应的节点,存在则答案为该节点的终点集合大小；不存在答案为<span class="math inline">\(0\)</span>.</li>
<li>所有出现位置：遍历树，一旦发现终点直接输出。</li>
</ul>
<h2 id="建立">建立</h2>
<p>最暴力的方式是建立一个O(n^2)级别的自动机，不过那个复杂度就没什么意义了。后缀自动机需要满足状态数最少，为线性级别，且转移（边）也为线性级别。</p>
<p>然后，我们可以开始折腾了。</p>
<p>定义串S的<span class="math inline">\(endpos(x)\)</span>为一个集合，元素为x在其内出现的所有位置的结尾下标。</p>
<h2 id="资料">资料</h2>
<ul>
<li><a href="https://saisumit.wordpress.com/2016/01/26/suffix-automaton/" target="_blank" rel="noopener">参考资料</a></li>
<li>2015年国家集训队论文</li>
</ul>
<h3 id="子串第一次出现的位置">子串第一次出现的位置</h3>
<p>对SAM中所有状态预处理firstpos（第一次出现该状态的末端位置，也就是endpos集合的最小元素）。</p>
<p>扩展源函数为<code>sam_extend()</code>。创建新状态<code>cur</code>时，令</p>
<p><span class="math display">\[
firstpos(cur)=len(cur)-1
\]</span></p>
<p>当<code>q</code>复制到<code>clone</code>时，令</p>
<p><span class="math display">\[
firstpos(clone)=firstpos(q)
\]</span></p>
<p>需要的答案就是<span class="math inline">\(firstpos(t)-|P|+1\)</span>，<span class="math inline">\(t\)</span>为字符串<span class="math inline">\(P\)</span>的状态。每次查询需要<span class="math inline">\(O(|P|)\)</span></p>
<h3 id="最短未出现字符串">最短未出现字符串</h3>
<p>动态规划。</p>
<p>让<span class="math inline">\(d_v\)</span>为节点<span class="math inline">\(v\)</span>的答案。如果不存在使用字符集中至少一个字符的转移，那么<span class="math inline">\(d_v=1\)</span>，否则</p>
<p><span class="math display">\[
d_v=1+\min_{w:(v,w,c) \in SAM} d_w
\]</span></p>
<p>字符串可以由转移推回去。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://blog.kanari.moe/2019/09/30/problem-primes-and-multiplication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanari">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanari's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/30/problem-primes-and-multiplication/" class="post-title-link" itemprop="url">[CF589C] primes and multiplication</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-30 09:04:52" itemprop="dateCreated datePublished" datetime="2019-09-30T09:04:52+08:00">2019-09-30</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-02 13:23:53" itemprop="dateModified" datetime="2019-10-02T13:23:53+08:00">2019-10-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/coding/" itemprop="url" rel="index"><span itemprop="name">coding</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>设<span class="math inline">\(primes(x)\)</span>为x的质因数的集合。</p>
<p>设<span class="math inline">\(g(x,p)\)</span>表示可以整除x的最大的<span class="math inline">\(p^k\)</span>。</p>
<p>设<span class="math inline">\(f(x,y)\)</span>表示将x作分解后对每个质因子作用到1到y上求<span class="math inline">\(g\)</span>的乘积。</p>
<p>求<span class="math inline">\(f(x,n)\)</span></p>
<h2 id="分析">分析</h2>
<p>……最后你会发现，这题就是求阶乘质因子的乘积。</p>
<h2 id="代码">代码</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">1010</span>;</span><br><span class="line"><span class="keyword">using</span> ll=<span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> ll P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">vector</span>&lt;ll&gt; primes;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unpack</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    ll b=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="built_in">sqrt</span>(b)+<span class="number">1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x%i==<span class="number">0</span>)primes.push_back(i);</span><br><span class="line">        <span class="keyword">while</span>(x%i==<span class="number">0</span>)x/=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">1</span>)primes.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;b;b&gt;&gt;=<span class="number">1</span>,a=a*a%p)&#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)res=res*a%p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">get</span><span class="params">(ll n,ll num)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)&#123;</span><br><span class="line">        res=(res+n/num)%(P<span class="number">-1</span>);</span><br><span class="line">        n/=num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    ll x,n;<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;n;</span><br><span class="line">    unpack(x);</span><br><span class="line"> </span><br><span class="line">    ll ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll item:primes)&#123;</span><br><span class="line">        ans=ans*qpow(item,get(n,item),P)%P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;ans%P&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/uploads/avatar.png"
      alt="Kanari">
  <p class="site-author-name" itemprop="name">Kanari</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kanari</span>
</div>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  

</body>
</html>
