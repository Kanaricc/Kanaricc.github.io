<?xml version="1.0" encoding="utf-8"?>


<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN">
    <title type="text">Kanari&#39;s Blog</title>
    <subtitle type="html">Kanari's blog.</subtitle>
    <updated>2020-04-07T23:17:25+08:00</updated>
    <id>https://blog.kanari.moe/</id>
    <link rel="alternate" type="text/html" href="https://blog.kanari.moe/" />
    <link rel="self" type="application/atom+xml" href="https://blog.kanari.moe/atom.xml" />
    <author>
            <name>Kanari</name>
            <uri>https://blog.kanari.moe/</uri>
            
                <email>secret@a.b</email>
            </author>
    
    <generator uri="https://gohugo.io/" version="0.66.0">Hugo</generator>
        <entry>
            <title type="text">由Tiddywiki说起</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/info-dependence/" />
            <id>https://blog.kanari.moe/gossip/info-dependence/</id>
            <updated>2020-04-07T23:17:21+08:00</updated>
            <published>2020-04-07T21:50:59+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[我再换blog的后端我就是狗。 Tiddlywiki是我在寻找Mediawiki的替代……]]></summary>
            
                <content type="html"><![CDATA[<blockquote>
<p>我再换blog的后端我就是狗。</p>
</blockquote>
<p>Tiddlywiki是我在寻找Mediawiki的替代品时意外发现的东西。起初我还是只惊艳于它的特殊的组织方式和齐全的功能，整个软件只有一个html文件，逻辑、数据全部保存在里面。后来，在我深入这套软件的模板功能时，了解到了它的哲学。</p>
<p>Tiddlywiki从最初就打算为用户准备一个极端<strong>稳定</strong>且<strong>独立</strong>的非线性文字笔记系统。其第一个版本在2004年发布，直到现在仍然在稳定的运行。为了做到上面的要求，wiki才采用了单文件方式，不追求任何时髦技术，尽可能不依赖任何现存的其他软件，尽可能做到兼容，甚至代码也完全基于vanilla和html5。而这么做的原因大概就是要达到一点要求：在提供足够功能的前提下，保证系统的独立和在<em>很长</em>一段时间内的可靠，从而维持数据的独立。</p>
<p>为何这么强调数据的独立？因为数据显然比凭依的记录手段更有价值。试想如果（如果！）有一天OneNote被砍掉了，我觉得不会有用户会先于自己的笔记去担忧巨硬的明天，用户第一考虑的该是如何将自己沉积多年的笔记统统转移出来。这很难，即使转移出来，恐怕也无法获得同样的编辑体验。</p>
<p>在这里，缅怀一下被谷姐砍掉的reader…</p>
<p>数据具有更高的价值，数据应该尽可能避免对特定系统的依赖。</p>
<p>在过去的一段时间里，我又多次看到了这种意见。有人在讨论NAS时持有这种观点，认为要远离不靠谱的网盘，数据和处理数据的工具应该分离；在vnote的issue中看到作者否定使用sqlite保存数据时也如是说，不使用私有格式，要为用户留足转移笔记的空间。</p>
<p>不过，保持数据更高的独立性也并非好事，这一般意味着无法得到更多的功能。想要解决也有点思路，要么把系统稳定性做到极致，别有事没事威胁数据安全，要么把格式做成标准，大家通用，给数据留足后路。</p>
<p>所以扯了这么多废话，结论就是我又回到静态博客了，顺便体验了一遍从数据库转移到文件的痛苦。先把数据库导出json，再拿python转换格式，还要莫名其妙再转义一遍文件里的dos换行符。啧，即使是最通用的文本文件，照样不同平台间移植会有代价。¯\<em>(ツ)</em>/¯</p>
<p>我再也不折腾了，再折腾我就是狗。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">一点点二维傅立叶变换</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/a-little-2d-fft/" />
            <id>https://blog.kanari.moe/gossip/a-little-2d-fft/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-27T21:49:59+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[目前，针对图片，视频，我们有通过在频域上乱搞的方式为其添加不可见水印。这种技术主要依……]]></summary>
            
                <content type="html"><![CDATA[<p>目前，针对图片，视频，我们有通过在频域上乱搞的方式为其添加不可见水印。这种技术主要依靠的就是二维傅立叶变换。</p>
<p>$$
\hat g(f)=\int{g(t)e^{-2\pi i ft}dt}
$$</p>
<p>这个是一维的傅立叶变换。那么，如果现在有一个二维信号$g(t_1,t_2)$，是不是可以简单的把上式改为</p>
<p>$$
\hat g(f_1,f_2)=\int\int{g(t_1,t_2)e^{-2\pi i (f_1t_1+f_2t_2)}dt_1dt_2}
$$</p>
<p>事实上是的。而逆变换为</p>
<p>$$
g(t_1,t_2)=\frac{1}{4 \pi^2}\int\int\hat g(f_1,f_2)e^{2\pi i (t_1f_1+t_2f_2)}df_1df_2
$$</p>
<p>如果写成离散形式，也是一种套路。</p>
<p>$$
\hat g(f_1,f_2)=\sum\sum{g(t_1,t_2)e^{-2\pi i (f_1t_1+f_2t_2)}}
$$</p>
<p>$$
g(t_1,t_2)=\frac{1}{4 \pi^2}\sum\sum\hat g(f_1,f_2)e^{2\pi i (t_1f_1+t_2f_2)}
$$</p>
<p>二维的傅立叶变换仍然是将信号分解为多个成分，只不过这里成了平面意义上的波，而且多了一个方向。这里的方向我们直接把$f_1,f_2$绘制到中心点为$(0,0)$的坐标系上，从而能够形成一张附带全部信息的频域图。</p>
<p>对于二维傅立叶变换的结果，也和一维的结果又类似含义。一个一元函数的高频低频意味着其变化快与慢的成分，一个声音的高频低频意味着其高音和低音部分，而一个二维变换的结果高频低频也意味着该数据变化快与慢的部分。</p>
<p>既然能够从音频频域上摘掉对声音有意义的频率（例如删掉与人声相关的频率），那就也可以在图片频域中叠加对人有意义的频率。所谓图片与视频的隐写术就是将对人眼有意义的频率叠加到频域中再进行逆变换的结果。包括音频也可以这么干，利用短时距傅立叶变换在频域上画一点有意义的图像再逆变换回去，就能当作更高级一点的音频水印。不过实际测试起来，在音频频域上搞得太过头的话听感影响挺大的。</p>
<p>这种技术相比直接打水印有很多好处，利用频率的特性意味着它可以对抗很多一般的攻击方式。不过一旦攻击能够影响频率，例如再次拍摄/录音这种，至少朴素的隐写就基本上gg了。</p>
<p>所以看到有人拿这个玩意去水大创就有点好奇，问了问能否识别我现拍的照片，得到的答复是不行……还以为会有干货，稍微有些失望。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">一点点点分治</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/a-littile-tree-divide/" />
            <id>https://blog.kanari.moe/study/a-littile-tree-divide/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-26T18:40:09+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[今天仍然是被吊起来打的一天。 点分治是一种用于解决树上路径问题的思路。它的关键就是选中……]]></summary>
            
                <content type="html"><![CDATA[<p>今天仍然是被吊起来打的一天。</p>
<p>点分治是一种用于解决树上路径问题的思路。它的关键就是选中一点，统计经过该点的答案后删除点，再递归到两个子树中进行同样的操作。</p>
<p>删除的点连带删除了一些已经计算过的路径。</p>
<p>当每次选择重心作为根时，能保证点分治的复杂度本身为$O(n \log n)$。当然你得保证$O(n)$做完你的事情，<em>同样清数组时也必须只清用到的</em>。</p>
<p>印象里之前有道树上DP的题，自己yy瞎糊的算法写的难看又难调，就有点这种感觉。不过那个是$O(n)$的，大概泛用上不如这个。</p>
<h2 id="聪聪可可">聪聪可可</h2>
<p>聪聪和可可是兄弟俩，他们俩经常为了一些琐事打起来，例如家中只剩下最后一根冰棍而两人都想吃、两个人都想玩儿电脑（可是他们家只有一台电脑）……遇到这种问题，一般情况下石头剪刀布就好了，可是他们已经玩儿腻了这种低智商的游戏。</p>
<p>他们的爸爸快被他们的争吵烦死了，所以他发明了一个新游戏：由爸爸在纸上画 nn 个“点”，并用 n-1n−1 条“边”把这 nn 个“点”恰好连通（其实这就是一棵树）。并且每条“边”上都有一个数。接下来由聪聪和可可分别随即选一个点（当然他们选点时是看不到这棵树的），如果两个点之间所有边上数的和加起来恰好是 33 的倍数，则判聪聪赢，否则可可赢。</p>
<p>聪聪非常爱思考问题，在每次游戏后都会仔细研究这棵树，希望知道对于这张图自己的获胜概率是多少。现请你帮忙求出这个值以验证聪聪的答案是否正确。</p>
<h3 id="分析">分析</h3>
<p>统计路径。但是这题dp的话能转移。</p>
<p>但是还是用点分治。</p>
<p>枚举一个点后，设$f(u,j)$表示到$u$点模3为$j$的路径数有多少。转移很明显，统计也很显然。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">XV</span><span class="o">=</span><span class="mi">20010</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">pii</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">XV</span><span class="p">];</span>


<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">XV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">sz</span><span class="p">[</span><span class="n">XV</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">dfs1</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">]</span><span class="o">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">||</span> <span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">dfs1</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">SZ</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">rt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">XV</span><span class="p">];</span>

<span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ready_to_clear</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">getroot</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">ready_to_clear</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">]</span><span class="o">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">||</span> <span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">getroot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
        <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">SZ</span><span class="o">-</span><span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rt</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">&lt;</span><span class="n">maxsz</span><span class="p">[</span><span class="n">rt</span><span class="p">])</span><span class="n">rt</span><span class="o">=</span><span class="n">u</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">XV</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>

    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">]</span><span class="o">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">||</span> <span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">t</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="n">w</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">t</span><span class="p">[</span><span class="n">w</span><span class="o">%</span><span class="mi">3</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="c1">//由v直接出发
</span><span class="c1"></span>
        <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">==</span><span class="n">rt</span><span class="p">){</span>
            <span class="c1">//从该子树到之前所有的子树
</span><span class="c1"></span>            <span class="n">ans</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">ans</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
            <span class="n">ans</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">==</span><span class="n">rt</span><span class="p">)</span><span class="n">ans</span><span class="o">+=</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">){</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ready_to_clear</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
        <span class="kt">int</span> <span class="n">u</span><span class="o">=</span><span class="n">ready_to_clear</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="n">ready_to_clear</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">//cout&lt;&lt;&#34;after&#34;&lt;&lt;u&lt;&lt;&#34;,ans=&#34;&lt;&lt;ans&lt;&lt;endl;
</span><span class="c1"></span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">]</span><span class="o">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">SZ</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span><span class="n">rt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">getroot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">solve</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">){</span>
    <span class="k">return</span> <span class="o">!</span><span class="n">b</span><span class="o">?</span><span class="nl">a</span><span class="p">:</span><span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">%</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">u</span><span class="o">&gt;&gt;</span><span class="n">v</span><span class="o">&gt;&gt;</span><span class="n">w</span><span class="p">;</span>
        <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">);</span>
        <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">w</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">SZ</span><span class="o">=</span><span class="n">nlen</span><span class="p">;</span>
    <span class="n">rt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">getroot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">solve</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>


    <span class="n">ll</span> <span class="n">win</span><span class="o">=</span><span class="n">ans</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">nlen</span><span class="p">;</span>
    <span class="n">ll</span> <span class="n">all</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">nlen</span><span class="o">*</span><span class="n">nlen</span><span class="p">;</span>

    <span class="n">ll</span> <span class="n">g</span><span class="o">=</span><span class="n">gcd</span><span class="p">(</span><span class="n">win</span><span class="p">,</span><span class="n">all</span><span class="p">);</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">win</span><span class="o">/</span><span class="n">g</span><span class="o">&lt;&lt;</span><span class="s">&#34;/&#34;</span><span class="o">&lt;&lt;</span><span class="n">all</span><span class="o">/</span><span class="n">g</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="hdu6643-yts1999-doesnt-like-this-problem">[HDU6643] yts1999 Doesn't Like This Problem</h2>
<p>Mr. Bread has a tree T with n vertices, labeled by 1,2,…,n. Each vertex of the tree has a positive integer value wi.</p>
<p>The value of a non-empty tree T is equal to w1×w2×⋯×wn. A subtree of T is a connected subgraph of T that is also a tree.</p>
<p>Please write a program to calculate the number of non-empty subtrees of T whose values are not larger than a given number m.</p>
<h3 id="分析-1">分析</h3>
<p>虽然我不知道为什么就显然点分治了，但是他们说是。要DP还是容易看出来的。</p>
<p>点分治能够解决路径问题，这种连通性问题也可以解决。也是枚举一个点后，统计包括这个点的连通块的答案。</p>
<p>选中该点后，进行DP。然后是他们说的非常套路的利用dfs序将树映射到序列上的做法。以$f(i,j)$表示在$i$点处值为$j$的方案数。</p>
<p>选中$i$：</p>
<p>$$f(i,ja)+=f(i+1,a)$$</p>
<p>不选$i$，那么同时要跳过i的整个子树：</p>
<p>$$f(i,j)+=f(i+\text{sz}(i),j)$$</p>
<p>另外是这道题的$j$范围太大。看到一个很骚的写法是存成$j$和$M/j$，然后每个都只有$\sqrt M$这么大…我寻思你再给我一遍这个题我也yy不出来这种存法。</p>
<p>总之有两个东西可以注意一下：</p>
<ul>
<li>对树上涉及依赖关系的DP可以考虑使用dfs序映射。</li>
<li>我不知道这个处理j的办法有没有泛用性。</li>
</ul>
<h3 id="代码">代码</h3>
<blockquote>
<p>代码中的重心、点分治的solve应该形成较为固定的写法。</p>
</blockquote>
<p><a href="https://www.cnblogs.com/hua-dong/p/11320013.html" title="origin">origin</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">/// copied
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">XN</span><span class="o">=</span><span class="mi">2010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">XN</span><span class="p">],</span><span class="n">sz</span><span class="p">[</span><span class="n">XN</span><span class="p">],</span><span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">re</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">vis</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">wage</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">square</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">tick</span><span class="p">;</span>
    <span class="n">re</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">||</span> <span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">SZ</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">XN</span><span class="p">],</span><span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">getroot</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">||</span> <span class="n">v</span> <span class="o">==</span> <span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">getroot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
        <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">SZ</span> <span class="o">-</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">maxsz</span><span class="p">[</span><span class="n">root</span><span class="p">])</span><span class="n">root</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MOD</span><span class="o">=</span><span class="mi">1000000007</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">M</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">%=</span> <span class="n">MOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">f</span><span class="p">[</span><span class="n">XN</span><span class="p">][</span><span class="n">XN</span><span class="p">],</span><span class="n">f2</span><span class="p">[</span><span class="n">XN</span><span class="p">][</span><span class="n">XN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">cal</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//默认选中root
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">tick</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="n">f</span><span class="p">[</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">tick</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">wage</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">min</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">square</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">to</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">j</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">to</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">)</span><span class="n">M</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
            <span class="k">else</span> <span class="n">M</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span> <span class="o">/</span> <span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">M</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">/</span> <span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="c1">//不选j，那么要跳过整个子树
</span><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">M</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">]]][</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">M</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">]]][</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">M</span><span class="p">(</span><span class="n">res</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">square</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">M</span><span class="p">(</span><span class="n">res</span> <span class="o">+=</span> <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
    <span class="c1">//去掉不选root的情况
</span><span class="c1"></span>    <span class="n">res</span><span class="o">--</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">M</span><span class="p">(</span><span class="n">res</span> <span class="o">+=</span> <span class="n">MOD</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">tick</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">dfs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">M</span><span class="p">(</span><span class="n">ans</span> <span class="o">+=</span> <span class="n">cal</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">SZ</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
        <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">getroot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">solve</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">m</span><span class="p">;</span>
        <span class="n">square</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
        <span class="n">tick</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">wage</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">u</span> <span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">;</span>
            <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">SZ</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">getroot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">solve</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">一点点决策单调性</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/juece-dandiao/" />
            <id>https://blog.kanari.moe/study/juece-dandiao/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-23T18:19:48+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[艹了天天都被不知道的知识点教育，知道的又做不出来。 :lei: 在动态规划中，决策单调性指对于$……]]></summary>
            
                <content type="html"><![CDATA[<p>艹了天天都被不知道的知识点教育，知道的又做不出来。 :lei:</p>
<p>在动态规划中，决策单调性指对于$j &lt; j'$，$f(j')$的最佳转移$f(i')$位置$i'$一定不小于$f(j)$的$i$。</p>
<p>假设</p>
<p>$$f(r)=\min{f(k-1)+w(k,r)}$$</p>
<p>为了证明这一点，首先假设</p>
<p>$$f(r)=f(k-1)+w(k,r)$$</p>
<p>此时我们有$\forall i &lt; k$，</p>
<p>$$f(k-1)+w(k,r) &lt; f(i-1)+w(i,r)$$</p>
<p>此后，将r后挪1。我们必须要证明$\forall i &lt; k$，</p>
<p>$$f(k-1)+w(k,r+1) &lt; f(i-1)+w(i,r+1)$$</p>
<p>也就是证明对于两边的两个增量$\Delta$有</p>
<p>$$w(k,r+1) - w(k,r) &lt; w(i,r+1) - w(i,r)$$</p>
<h2 id="使用分治">使用分治</h2>
<p>一旦有决策单调性了，我们就可以通过优于$n^2$的总复杂度完成规划。</p>
<p>例如使用分治。当我们找到区间$[ l, r ]$的中点$m$的决策点$p$时，那么$[l, m-1]$区间只能从不晚于$p$转移，$[m+1, r]$只能从不早于$p$转移。</p>
<p>l和r是当前要决策的区间，L和R是转移位置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">L</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span><span class="n">R</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//这里的下标写法要和方程配套
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">]</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="n">mid</span><span class="p">]){</span>
            <span class="n">f</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">];</span>
            <span class="n">p</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
    <span class="n">solve</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">R</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="cf868fyts1999-doing-minimization">【CF868F】yts1999 Doing Minimization</h2>
<p>You are given an array of n integers a1... an. The cost of a subsegment is the number of unordered pairs of distinct indices within the subsegment that contain equal elements. Split the given array into k non-intersecting non-empty subsegments so that the sum of their costs is minimum possible. Each element should be present in exactly one subsegment.</p>
<h3 id="分析">分析</h3>
<p>设$f(i,j)$表示前j个分i段。</p>
<p>这个题目就满足决策单调。一个更长的区间+1之后只有可能比短的区间增加更多的代价。</p>
<p>接下来的问题是怎么算这道题里的$w(i,j)$。$n^2$显然不行。看到有人整了个类似莫队的东西，不过我还没太弄明白这个复杂度是怎么算的，看起来是和分治的内层循环一致所以就对复杂度没有更多的贡献了。</p>
<p>一共进行k轮分治，$O(kn\log n)$</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">XN</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="mi">30</span><span class="p">][</span><span class="n">XN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">wage</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">cl</span><span class="p">,</span><span class="n">cr</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">cnt</span><span class="p">[</span><span class="n">XN</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">jump</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cl</span><span class="o">&lt;</span><span class="n">l</span><span class="p">){</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cl</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
        <span class="n">wage</span><span class="o">-=</span><span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cl</span><span class="p">]];</span>
        <span class="n">cl</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">cl</span><span class="p">){</span>
        <span class="n">cl</span><span class="o">--</span><span class="p">;</span>
        <span class="n">wage</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cl</span><span class="p">]];</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cl</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="n">cr</span><span class="p">){</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cr</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
        <span class="n">wage</span><span class="o">-=</span><span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cr</span><span class="p">]];</span>
        <span class="n">cr</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cr</span><span class="o">&lt;</span><span class="n">r</span><span class="p">){</span>
        <span class="n">cr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">wage</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cr</span><span class="p">]];</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">cr</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">L</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span><span class="n">R</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">jump</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">wage</span><span class="o">&lt;</span><span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mid</span><span class="p">]){</span>
            <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mid</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">wage</span><span class="p">;</span>
            <span class="n">p</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
    <span class="n">solve</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">kk</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">kk</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">f</span><span class="p">)</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">wage</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">wage</span><span class="p">;</span>
    <span class="p">}</span>
<span class="c1">//    for(int i=1;i&lt;=n;i++){
</span><span class="c1">//        cout&lt;&lt;f[1][i]&lt;&lt;&amp;#039; &amp;#039;;
</span><span class="c1">//    }
</span><span class="c1">//    cout&lt;&lt;endl;
</span><span class="c1"></span>    <span class="n">wage</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">cl</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">cr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">kk</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">solve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">f</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[HDU 6363] bookshelf</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/hdu-6363-bookshelf/" />
            <id>https://blog.kanari.moe/code/hdu-6363-bookshelf/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-21T18:48:16+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Patrick Star bought a bookshelf, he named it ZYG !! Patrick Star has N book . The ZYG has K layers (count from 1 to K) and there is no limit on the capacity of each layer ! Now Patrick want to……]]></summary>
            
                <content type="html"><![CDATA[<p>Patrick Star bought a bookshelf, he named it ZYG !!</p>
<p>Patrick Star has N book .</p>
<p>The ZYG has K layers (count from 1 to K) and there is no limit on the capacity of each layer !</p>
<p>Now Patrick want to put all N books on ZYG :</p>
<ol>
<li>
<p>Assume that the i-th layer has cnti(0≤cnti≤N) books finally.</p>
</li>
<li>
<p>Assume that f[i] is the i-th fibonacci number (f[0]=0,f[1]=1,f[2]=1,f[i]=f[i−2]+f[i−1]).</p>
</li>
<li>
<p>Define the stable value of i-th layers stablei=f[cnti].</p>
</li>
<li>
<p>Define the beauty value of i-th layers beautyi=2stablei−1.</p>
</li>
<li>
<p>Define the whole beauty value of ZYG score=gcd(beauty1,beauty2,...,beautyk)(Note: gcd(0,x)=x).</p>
</li>
</ol>
<p>Patrick Star wants to know the expected value of score if Patrick choose a distribute method randomly !</p>
<h2 id="分析">分析</h2>
<p>我tm这辈子学不会数论了。</p>
<p>先是两个【——】结论</p>
<ul>
<li>$\gcd(2^a-1,2^b-1)=2^{\gcd(a,b)}-1$</li>
<li>$\gcd(\text{fib}(a),\text{fib}(b))=\text{fib}(\gcd(a),\gcd(b))$</li>
</ul>
<p>然后原题的score就变成</p>
<p>$$2^{\text{fib}(\gcd(a_1,a_2,\cdots))}-1$$</p>
<p>接下来才有机会瞎搞。枚举gcd，$d|n$，$a$的分配方式有$C^{n/d+k-1}<em>{k-1}$种。这种分配包括了d'是d的倍数的所有情况的可能。令$F(d)=C^{n/d+k-1}</em>{k-1}$，$f(d)$为真正的数目，于是有</p>
<p>$$F(d)=\sum_{d|d'}f(d')$$</p>
<p>依照莫比乌斯反演，有</p>
<p>$$f(d)=\sum_{d|d'}\mu(\frac{d'}{d})F(d')$$</p>
<p>于是原题得以解决。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">一点点拉格朗日插值</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/lagrange-polynomial/" />
            <id>https://blog.kanari.moe/study/lagrange-polynomial/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-19T18:18:21+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[抄起我的混凝土数学，复习了会上升下降积分，看了看斯特林数和伯努利数。结果误把伯努利数……]]></summary>
            
                <content type="html"><![CDATA[<p>抄起我的混凝土数学，复习了会上升下降积分，看了看斯特林数和伯努利数。结果误把伯努利数的递推式看成了$O(n)$的，改了半天一到3次方以上就翻车，这才反应过来。</p>
<p>8会啊…找了很长时间才知道是拉格朗日插值。</p>
<p>有这么一条定理。</p>
<blockquote>
<p>平面上的n+1个点可以确定一个n次多项式。</p>
</blockquote>
<p>而$\sum i^p$是一个$p+1$次多项式，况且在$p \leq 1000000$的前提下很容易找到前$p+1$个点。如果我们找到一种方式去构造这样一个多项式问题就解决了。</p>
<p><del>拉格朗</del>提出了这么一种方法。</p>
<h2 id="构造">构造</h2>
<p>设函数</p>
<p>$$\ell_j(x)=\prod_{k \neq j} \frac{x-x_k}{x_j-x_k}$$</p>
<p>注意其特性</p>
<ul>
<li>$x_j$被带入时，其为$1$</li>
<li>其他任何$x$被带入时，会出现$0$项。</li>
</ul>
<p>因此这个东西就可以为任何一个点对创建在多项式中的单元$y_j \ell_j(x_j)$。剩下的问题是如何快速求解。</p>
<p>当我们只求单点（率先带入点），且整数x连续取值时，观察到分母和分子都变为阶乘形式，且分式的构成元素在前后两项之间具有递推的关系。</p>
<p>$$
\ell_j(x)=\frac{(x-1)(x-2)\cdots (x-(j-1))(x-(j+1))\cdots (x-n)}{(j-1)(j-2) \cdots (j-(j-1))(j-(j+1)) \cdots (j-n))}
$$</p>
<p>可以看到，分子和分母项都能够拆分为左右两个部分。分别维护前缀后缀与阶乘逆元即可。</p>
<p><em>阶乘并不需要全部的</em>，仅仅是左侧和右侧的一小部分。</p>
<h2 id="板子">板子</h2>
<p>嫖的，自己的写爆了而且巨丑。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">lagrange</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">f</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
            <span class="n">g</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">upd</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="mi">1LL</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">inv</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">lagrange</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">suf</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="mi">1LL</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">suf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="n">a</span><span class="o">=</span><span class="n">mod</span><span class="o">-</span><span class="n">a</span><span class="p">;</span>
        <span class="n">upd</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="mi">1LL</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="错误的代码">错误的代码</h2>
<p>这份看错了伯努利数的递推复杂度</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1000010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">mod</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>


<span class="n">ll</span> <span class="n">inv</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">double</span> <span class="n">B</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">double</span> <span class="n">C</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="c1">//niyuan
</span><span class="c1"></span>    <span class="n">inv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">mod</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">mod</span> <span class="o">-</span> <span class="n">mod</span> <span class="o">/</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//C
</span><span class="c1"></span>    <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="c1">//        C[i]=C[i-1]*(n+1-i+1)%mod*inv[i]%mod;
</span><span class="c1"></span>        <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    
    
    <span class="c1">//WRONG
</span><span class="c1"></span>    <span class="c1">//伯努利数的递推是n^2级别的，理解式子上出现了失误。
</span><span class="c1"></span>    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">s</span><span class="o">=</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="c1">//        B[i]=-inv[i+1]*s%mod;
</span><span class="c1">//        s=(s+B[i]*C[i]%mod)%mod;
</span><span class="c1"></span>        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=-</span><span class="n">s</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">s</span><span class="o">=</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">n2</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ll</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>

    <span class="n">init</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">n2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">n2</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">n2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="c1">//        ans=(ans+C[i]*B[i]%mod*n2[m+1-i]%mod)%mod;
</span><span class="c1"></span>        <span class="n">ans</span><span class="o">=</span><span class="p">(</span><span class="n">ans</span><span class="o">+</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">n2</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="c1">//    (ans*=inv[m+1])%=mod;
</span><span class="c1"></span>    <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>


<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这份自己yy的拉格朗日插值在阶乘的求法上有问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1000010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">mod</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">fac</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">facinv</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">inv</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="o">=</span><span class="n">mod</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">get_inv</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="o">=</span><span class="n">mod</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">Fac</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">bool</span> <span class="n">pos</span><span class="o">=</span><span class="nb">true</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">flg</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">pos</span> <span class="o">&amp;&amp;</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">flg</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">fac</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">flg</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">Invfac</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">bool</span> <span class="n">pos</span><span class="o">=</span><span class="nb">true</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">flg</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">pos</span> <span class="o">&amp;&amp;</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">flg</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">facinv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">flg</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">fac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">fac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">fac</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="n">facinv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">get_inv</span><span class="p">(</span><span class="n">fac</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
        <span class="n">facinv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">facinv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">facinv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">inv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">mod</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">mod</span><span class="o">-</span><span class="n">mod</span><span class="o">/</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">yy</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">M</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">init</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">M</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">M</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">qpow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">m</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">M</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">M</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="n">M</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">M</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">ll</span> <span class="n">cell</span><span class="o">=</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Fac</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">Invfac</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cell</span><span class="o">*=</span><span class="n">Invfac</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%=</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cell</span><span class="o">*=</span><span class="n">Invfac</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">M</span><span class="p">),</span><span class="nb">false</span><span class="p">))</span><span class="o">%=</span><span class="n">mod</span><span class="p">;</span>
        <span class="p">(</span><span class="n">ans</span><span class="o">+=</span><span class="n">cell</span><span class="p">)</span><span class="o">%=</span><span class="n">mod</span><span class="p">;</span>
<span class="c1">//        ll cell=yy[i]*Fac(n-1)/Fac(n-M-1)/(n-i);
</span><span class="c1">//        cell/=Fac(i-1);
</span><span class="c1">//        cell/=Fac(abs(i-M),false);
</span><span class="c1">//        ans+=cell;
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ans</span><span class="o">+</span><span class="n">mod</span><span class="p">)</span><span class="o">%</span><span class="n">mod</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Spring Training 3</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/spring-training-3/" />
            <id>https://blog.kanari.moe/code/spring-training-3/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-19T09:38:52+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[HDU6319 Ascending Rating Before the start of contest, there are n ICPC contestants waiting in a long queue. They are labeled by 1 to n from left to right. It can be easily found that the i-th contestant's QodeForces rating is ai.……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="hdu6319-ascending-rating">HDU6319 Ascending Rating</h2>
<p>Before the start of contest, there are n ICPC contestants waiting in a long queue. They are labeled by 1 to n from left to right. It can be easily found that the i-th contestant's QodeForces rating is ai.
Little Q, the coach of Quailty Normal University, is bored to just watch them waiting in the queue. He starts to compare the rating of the contestants. He will pick a continous interval with length m, say [l,l+m−1], and then inspect each contestant from left to right. Initially, he will write down two numbers maxrating=−1 and count=0. Everytime he meets a contestant k with strictly higher rating than maxrating, he will change maxrating to ak and count to count+1.
Little T is also a coach waiting for the contest. He knows Little Q is not good at counting, so he is wondering what are the correct final value of maxrating and count. Please write a program to figure out the answer.</p>
<h3 id="分析">分析</h3>
<p>一开始想着从左到右滑动窗口维护一个单调队列，结果发现没法统计count。</p>
<p>反向滑动就好了，我还没太反应过来为啥。唯一捉住的一点想法是“数据无用”的时刻。在正向维护时，后想加入但是未被加入的元素可能因为前者pop掉而漏掉，但是反向维护时只会弹出已经使用的无用元素，任何时候新元素都会被加入。</p>
<h2 id="hdu6331-walking-plan">HDU6331 Walking Plan</h2>
<p>There are n intersections in Bytetown, connected with m one way streets. Little Q likes sport walking very much, he plans to walk for q days. On the i-th day, Little Q plans to start walking at the si-th intersection, walk through at least ki streets and finally return to the ti-th intersection.
Little Q's smart phone will record his walking route. Compared to stay healthy, Little Q cares the statistics more. So he wants to minimize the total walking length of each day. Please write a program to help him find the best route.</p>
<h3 id="分析-1">分析</h3>
<p>……果然还是菜，别人过得像飞一样。先是读错了题，把ki streets理解成了路径权的限制，就翻了车。后发现是k条之后，猜了发是不是倍增，又争执了很久到底最短路能不能蹦。最后结论是大概可以蹦。（既然过了那就也是了）</p>
<p>结果发现倍增的话答案没法统计。大哥们说分块，才终于看到了一点希望。wa了数发才过。</p>
<h2 id="hdu6325-interstellar-travel">HDU6325 Interstellar Travel</h2>
<p>After trying hard for many years, Little Q has finally received an astronaut license. To celebrate the fact, he intends to buy himself a spaceship and make an interstellar travel.
Little Q knows the position of n planets in space, labeled by 1 to n. To his surprise, these planets are all coplanar. So to simplify, Little Q put these n planets on a plane coordinate system, and calculated the coordinate of each planet (xi,yi).
Little Q plans to start his journey at the 1-th planet, and end at the n-th planet. When he is at the i-th planet, he can next fly to the j-th planet only if xi&lt;xj, which will cost his spaceship xi×yj−xj×yi units of energy. Note that this cost can be negative, it means the flight will supply his spaceship.
Please write a program to help Little Q find the best route with minimum total cost.</p>
<h3 id="分析-2">分析</h3>
<p>这题如果你在a和b两点之间找第三点，然后计算代价差，就会发现最终的代价里出现了a到b的直线方程。代价变成了该直线上第三点的值和真实值的差， <del>可是见鬼了这是怎么发现的。</del></p>
<p>结论是一个点在直线之上，就要进行中转。所以最终答案大方向是求一个凸包。</p>
<h2 id="hdu6321-dynamic-graph-matching">HDU6321 Dynamic Graph Matching</h2>
<p>In the mathematical discipline of graph theory, a matching in a graph is a set of edges without common vertices.
You are given an undirected graph with n vertices, labeled by 1,2,...,n. Initially the graph has no edges.
There are 2 kinds of operations :</p>
<ul>
<li>u v, add an edge (u,v) into the graph, multiple edges between same pair of vertices are allowed.</li>
</ul>
<ul>
<li>u v, remove an edge (u,v), it is guaranteed that there are at least one such edge in the graph.
Your task is to compute the number of matchings with exactly k edges after each operation for k=1,2,3,...,n2. Note that multiple edges between same pair of vertices are considered different.</li>
</ul>
<h3 id="分析-3">分析</h3>
<p>数据范围能够状压。</p>
<p>用$f(i,state)$表示此次操作完后，已经选择的点有state所能构成的方案数。对于加边uv，就有如下转移。表示在未选择uv的已匹配状态里再选上uv构成新state。</p>
<p>$$f(i,s)=\sum f(i-1,s-{u,v})$$</p>
<p>表示在删除uv时，从方案中再次扣去这些状态。</p>
<p>$$f(i,s)-=f(i,s-{u,v})$$</p>
<p>把第一维滚动掉，这两个公式对转移顺序没有要求，每次更新都不会更新被用来转移的状态，瞎掰写。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[???] Builds Sequences</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/builds-sequences/" />
            <id>https://blog.kanari.moe/code/builds-sequences/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-18T11:56:43+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Alice 想要得到一个长度为 n 的序列，序列中的数都是不超过 m 的正整数，而且这 n 个数的和是 p 的……]]></summary>
            
                <content type="html"><![CDATA[<p>Alice 想要得到一个长度为 n 的序列，序列中的数都是不超过 m 的正整数，而且这 n 个数的和是 p 的倍数。</p>
<p>Alice 还希望，这 n 个数中，至少有一个数是质数。</p>
<p>Alice 想知道，有多少个序列满足她的要求。</p>
<p>$$1 \leq n \leq 10 ^ 9, 1 \leq m \leq 2 \times 10 ^ 7, 1 \leq p \leq 100$$</p>
<h2 id="分析">分析</h2>
<p>这题做得很爽…</p>
<p>首先是一个套路，维护倍数可以转为维护当前和的模。因此如果递推的话，只需要100个状态，看起来是可做的。但是这个n的范围实在是有点，先列一下再说。</p>
<p>把2e7个数字全部模完，它们对答案的贡献只和剩余类有关。这样我们就能知道在和的模为a时有多少种方案能够凑到b了。得出递推方程</p>
<p>$$
f(i,j)=\sum_{0 \leq k &lt; p} f(i-1,(j-k) \mod 3)c(k)
$$</p>
<p>其中$c(k)$是模为k的数有多少个。</p>
<p>至少有一个质数的条件转为无质数，从所有的c中扣去质数后再算一遍方案数，二者相减。</p>
<p>最后，关于n，这个公式能够用快速幂加速。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">110</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXM</span><span class="o">=</span><span class="mi">20000010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MOD</span><span class="o">=</span><span class="mi">20170408</span><span class="p">;</span>

<span class="kt">bool</span> <span class="n">isnp</span><span class="p">[</span><span class="n">MAXM</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">isnp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isnp</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
            <span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">primes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">isnp</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">Mat</span><span class="p">{</span>
    <span class="n">ll</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

    <span class="n">Mat</span><span class="p">(){</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">Mat</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">){</span>
        <span class="n">Mat</span> <span class="n">res</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
                    <span class="n">res</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">%</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">debug</span><span class="p">(){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">normalize</span><span class="p">(){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">Mat</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">Mat</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
    <span class="n">Mat</span> <span class="n">res</span><span class="p">;</span>
    <span class="n">res</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Mat</span> <span class="n">base</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">pool</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">nopool</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">Mat</span> <span class="n">incprime</span><span class="p">,</span><span class="n">noprime</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">pool</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="n">p</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">nopool</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="n">p</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">init</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">it</span><span class="p">:</span><span class="n">primes</span><span class="p">){</span>
        <span class="n">nopool</span><span class="p">[</span><span class="n">it</span><span class="o">%</span><span class="n">p</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>

<span class="c1">//    for(auto it:nopool){
</span><span class="c1">//        cout&lt;&lt;it&lt;&lt;&#34; &#34;;
</span><span class="c1">//    }
</span><span class="c1">//    cout&lt;&lt;endl;
</span><span class="c1"></span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">p</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">p</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="c1">//cout&lt;&lt;((i-1-(j-1))%p+p)%p&lt;&lt;endl;
</span><span class="c1"></span>            <span class="n">incprime</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">pool</span><span class="p">[((</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">p</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">];</span>
            <span class="n">noprime</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">nopool</span><span class="p">[((</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">p</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">base</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">incprime</span><span class="o">=</span><span class="n">base</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">incprime</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="c1">//    incprime.debug();
</span><span class="c1"></span>    <span class="n">noprime</span><span class="o">=</span><span class="n">base</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">noprime</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="c1">//    noprime.debug();
</span><span class="c1"></span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="p">((</span><span class="n">incprime</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">noprime</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1322C] Instant Noodles</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1322c-instant-noodles/" />
            <id>https://blog.kanari.moe/code/cf-1322c-instant-noodles/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-08T16:32:30+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Wu got hungry after an intense training session, and came to a nearby store to buy his favourite instant noodles. After Wu paid for his purchase, the cashier gave him an interesting task. You are given a bipartite graph with positive integers……]]></summary>
            
                <content type="html"><![CDATA[<p>Wu got hungry after an intense training session, and came to a nearby store to buy his favourite instant noodles. After Wu paid for his purchase, the cashier gave him an interesting task.</p>
<p>You are given a bipartite graph with positive integers in all vertices of the right half. For a subset 𝑆 of vertices of the left half we define 𝑁(𝑆) as the set of all vertices of the right half adjacent to at least one vertex in 𝑆, and 𝑓(𝑆) as the sum of all numbers in vertices of 𝑁(𝑆). Find the greatest common divisor of 𝑓(𝑆) for all possible non-empty subsets 𝑆 (assume that GCD of empty set is 0).</p>
<p>Wu is too tired after his training to solve this problem. Help him!</p>
<h2 id="分析">分析</h2>
<p>这道题的范围有500000之大，所以实在是无法从子集本身入手，只能考虑一下gcd是否存在性质。</p>
<p>假设现在有一个子集$a$，当我们为其加上一个$\Delta$后，这两个结果都会参与gcd的计算，更相减损后表现为$\Delta$参与gcd计算。</p>
<p>这个$\Delta$的增量直接贡献答案的特性可能是重要的一环。比赛时因为时间也好，别的也罢，被卡在这自闭不会了。</p>
<p>接下来确定增量是什么。</p>
<p>是否是单独的一个元素：对于一个右节点$v$，是否存在添加一个左节点后只增加其一个的情况。干脆把全部的左节点全部选中，然后删掉包含$v$的。接下来，观察是否存在一个左节点只增加$v$。这显然会有不存在的情况。</p>
<p>在不存在的情况时，我们有这些结论。假设这个捣乱的节点是$v'$</p>
<ul>
<li>$v'$由于删除所有包含$v$的节点而被共同删除。</li>
<li>$v'$无法被不包含$v$的其他节点增加，那么能增加$v'$的节点定包含$v$。</li>
</ul>
<p>此时有两种情况。</p>
<ul>
<li>所有添加v的节点均包含$v'$。那么二者共进退，表现为捆绑在一起的一个节点。</li>
<li>并不是所有添加v的节点均包含$v'$。那么，我们就能通过添加别的节点率先加上v，从而能够单独添加v'，从而能够单独添加v。
所以，这个增量不是单个元素，而是这么一个东西：邻域相同的元素。</li>
</ul>
<p>可以做了？……太菜，搞不明白这怎么在比赛期间短期折腾出来。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1320C] World of Darkraft: Battle for Azathoth</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1320c-world-of-darkraft-battle-for-azathoth/" />
            <id>https://blog.kanari.moe/code/cf-1320c-world-of-darkraft-battle-for-azathoth/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-08T12:58:45+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Roma is playing a new expansion for his favorite game World of Darkraft. He made a new character and is going for his first grind. Roma has a choice to buy exactly one of 𝑛 different weapons and exactly one of 𝑚……]]></summary>
            
                <content type="html"><![CDATA[<p>Roma is playing a new expansion for his favorite game World of Darkraft. He made a new character and is going for his first grind.</p>
<p>Roma has a choice to buy exactly one of 𝑛 different weapons and exactly one of 𝑚 different armor sets. Weapon 𝑖 has attack modifier 𝑎𝑖 and is worth 𝑐𝑎𝑖 coins, and armor set 𝑗 has defense modifier 𝑏𝑗 and is worth 𝑐𝑏𝑗 coins.</p>
<p>After choosing his equipment Roma can proceed to defeat some monsters. There are 𝑝 monsters he can try to defeat. Monster 𝑘 has defense 𝑥𝑘, attack 𝑦𝑘 and possesses 𝑧𝑘 coins. Roma can defeat a monster if his weapon's attack modifier is larger than the monster's defense, and his armor set's defense modifier is larger than the monster's attack. That is, a monster 𝑘 can be defeated with a weapon 𝑖 and an armor set 𝑗 if 𝑎𝑖&gt;𝑥𝑘 and 𝑏𝑗&gt;𝑦𝑘. After defeating the monster, Roma takes all the coins from them. During the grind, Roma can defeat as many monsters as he likes. Monsters do not respawn, thus each monster can be defeated at most one.</p>
<p>Thanks to Roma's excessive donations, we can assume that he has an infinite amount of in-game currency and can afford any of the weapons and armor sets. Still, he wants to maximize the profit of the grind. The profit is defined as the total coins obtained from all defeated monsters minus the cost of his equipment. Note that Roma must purchase a weapon and an armor set even if he can not cover their cost with obtained coins.</p>
<p>Help Roma find the maximum profit of the grind.</p>
<h2 id="分析">分析</h2>
<p>这题代表了一类基本的思路。枚举其中一维，用数据结构维护另一维。</p>
<p>假设我们枚举武器攻击力，首先能够挑出所有被击杀的怪物。当我们的防具为k时，所有攻击力小于k的都可以计算收益。反过来说，对于攻击力为k的怪物，只要我们的防具大于k，就可以计算收益。</p>
<p>所以每枚举一个主角攻击力，我们把怪物按照其攻击力为下标作收益前缀和，就可以获取到当主角防具为k时所能得到的收益。为了计算入防具的花费，预处理每个防具等级k所需要的最少的钱，预先在相应下标扣除。此时还需要一个结构来求去所有前缀和中最大。这些操作都可以用线段树完成。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;limits&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1000100</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">award</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">cost</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">flag</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">wlen</span><span class="p">,</span><span class="n">alen</span><span class="p">,</span><span class="n">mlen</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Weapon</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">rnk</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Weapon</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="c1">//if (rnk == b.rnk)return cost &lt; b.cost;实际没用
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">rnk</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">rnk</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">weapons</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="k">struct</span> <span class="nc">Armor</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">rnk</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Armor</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rnk</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">rnk</span><span class="p">)</span><span class="k">return</span> <span class="n">cost</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">cost</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">rnk</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">rnk</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">armors</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">award</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">award</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span><span class="n">award</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]){</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">award</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">award</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//枚举武器，维护防具
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">init</span><span class="o">=-</span><span class="mh">0x3f3f3f3f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span> <span class="o">=</span> <span class="o">++</span><span class="n">idx</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">award</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=-</span><span class="n">cost</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span><span class="n">init</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span><span class="n">init</span><span class="p">);</span>
    <span class="n">collect</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">award</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">R</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>

    <span class="n">collect</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">query</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">award</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">award</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="n">ll</span> <span class="n">res</span><span class="o">=-</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">Monster</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">att</span><span class="p">,</span><span class="n">de</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cost</span><span class="p">;</span>
<span class="p">}</span> <span class="n">monsters</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">debug</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">root</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">wlen</span> <span class="o">&gt;&gt;</span> <span class="n">alen</span> <span class="o">&gt;&gt;</span> <span class="n">mlen</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">vallim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">wlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">weapons</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span> <span class="o">&gt;&gt;</span> <span class="n">weapons</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">alen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span><span class="o">&gt;&gt;</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">mlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">monsters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">de</span><span class="o">&gt;&gt;</span><span class="n">monsters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">att</span><span class="o">&gt;&gt;</span><span class="n">monsters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="p">;</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">weapons</span><span class="p">,</span><span class="n">weapons</span><span class="o">+</span><span class="n">wlen</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">monsters</span><span class="p">,</span><span class="n">monsters</span><span class="o">+</span><span class="n">mlen</span><span class="p">,[](</span><span class="k">auto</span> <span class="n">a</span><span class="p">,</span><span class="k">auto</span> <span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">de</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">de</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">fill</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span><span class="n">cost</span><span class="o">+</span><span class="n">MAXN</span><span class="p">,</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">maxarm</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">alen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">cost</span><span class="p">[</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">cost</span><span class="p">[</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span><span class="p">],</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="p">);</span>
        <span class="n">maxarm</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxarm</span><span class="p">,</span><span class="n">armors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">maxarm</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
        <span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxarm</span><span class="p">);</span>
    <span class="c1">//debug(maxarm);
</span><span class="c1"></span>
    <span class="n">ll</span> <span class="n">ans</span><span class="o">=-</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">wlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">mlen</span> <span class="o">&amp;&amp;</span> <span class="n">monsters</span><span class="p">[</span><span class="n">ptr</span><span class="p">].</span><span class="n">de</span><span class="o">&lt;</span><span class="n">weapons</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rnk</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">monsters</span><span class="p">[</span><span class="n">ptr</span><span class="p">].</span><span class="n">att</span><span class="o">&lt;</span><span class="n">maxarm</span><span class="p">){</span>
                <span class="n">modify</span><span class="p">(</span><span class="n">monsters</span><span class="p">[</span><span class="n">ptr</span><span class="p">].</span><span class="n">cost</span><span class="p">,</span><span class="n">monsters</span><span class="p">[</span><span class="n">ptr</span><span class="p">].</span><span class="n">att</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maxarm</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxarm</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query</span><span class="p">()</span><span class="o">-</span><span class="n">weapons</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1321C] Remove Adjacent 拓展</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1321c-remove-adjacent/" />
            <id>https://blog.kanari.moe/code/cf-1321c-remove-adjacent/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-03-02T10:41:30+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[没注意到数据范围是100。 You are given a string 𝑠 consisting of lowercase Latin letters. Let the length of 𝑠 be |𝑠|. You may perform several operations on this string.……]]></summary>
            
                <content type="html"><![CDATA[<p>没注意到数据范围是100。</p>
<p>You are given a string 𝑠 consisting of lowercase Latin letters. Let the length of 𝑠 be |𝑠|. You may perform several operations on this string.</p>
<p>In one operation, you can choose some index 𝑖 and remove the 𝑖-th character of 𝑠 (𝑠𝑖) if at least one of its adjacent characters is the previous letter in the Latin alphabet for 𝑠𝑖. For example, the previous letter for b is a, the previous letter for s is r, the letter a has no previous letters. Note that after each removal the length of the string decreases by one. So, the index 𝑖 should satisfy the condition 1≤𝑖≤|𝑠| during each operation.</p>
<p>For the character 𝑠𝑖 adjacent characters are 𝑠𝑖−1 and 𝑠𝑖+1. The first and the last characters of 𝑠 both have only one adjacent character (unless |𝑠|=1).</p>
<p>Consider the following example. Let 𝑠= bacabcab.</p>
<p>During the first move, you can remove the first character 𝑠1= b because 𝑠2= a. Then the string becomes 𝑠= acabcab.
During the second move, you can remove the fifth character 𝑠5= c because 𝑠4= b. Then the string becomes 𝑠= acabab.
During the third move, you can remove the sixth character 𝑠6='b' because 𝑠5= a. Then the string becomes 𝑠= acaba.
During the fourth move, the only character you can remove is 𝑠4= b, because 𝑠3= a (or 𝑠5= a). The string becomes 𝑠= acaa and you cannot do anything with it.
Your task is to find the maximum possible number of characters you can remove if you choose the sequence of operations optimally.</p>
<h2 id="分析">分析</h2>
<p>换个视角来看消除，当有b时，我们就能保证所有能接触到这个b的c被消除。</p>
<p>所以从大往小了做，枚举每一个字母$s$，然后枚举s的位置去查询它左右是否有能够碰到它的$s+1$。</p>
<p>接下来是如何维护信息。当上一个字母使得上上个字母能够被消除后，就有可能使得原本无法接触到本次字母的上一个字母转而能够接触到该字母。使用并查集来做这种事情，并查集维护连续消除的区间l和r，以及这个区间存在字母（int状压即可）。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">UT</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">fa</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">dat</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

    <span class="n">UT</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAXN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">fa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAXN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="nf">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span> <span class="o">?</span> <span class="nl">u</span> <span class="p">:</span> <span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">con</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">uf</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">vf</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
        <span class="n">dat</span><span class="p">[</span><span class="n">vf</span><span class="p">]</span> <span class="o">|=</span> <span class="n">dat</span><span class="p">[</span><span class="n">uf</span><span class="p">];</span>
        <span class="n">l</span><span class="p">[</span><span class="n">vf</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">vf</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="n">uf</span><span class="p">]);</span>
        <span class="n">r</span><span class="p">[</span><span class="n">vf</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">vf</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">uf</span><span class="p">]);</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span> <span class="o">=</span> <span class="n">vf</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">isc</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="n">string</span> <span class="n">inp</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pos</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
<span class="n">UT</span> <span class="n">ut</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">nlen</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">inp</span><span class="p">;</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="n">inp</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">pos</span><span class="p">[</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;].</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">p</span><span class="p">:</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">ut</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">ut</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="n">ut</span><span class="p">.</span><span class="n">con</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">inp</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">ut</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">ut</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="n">ut</span><span class="p">.</span><span class="n">con</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">uf</span> <span class="o">=</span> <span class="n">ut</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">vis</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">minn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ut</span><span class="p">.</span><span class="n">dat</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">minn</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="kt">int</span> <span class="n">off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ut</span><span class="p">.</span><span class="n">l</span><span class="p">[</span><span class="n">uf</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ut</span><span class="p">.</span><span class="n">r</span><span class="p">[</span><span class="n">uf</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">off</span> <span class="o">+=</span> <span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span> <span class="o">+</span> <span class="n">minn</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">ans</span> <span class="o">+=</span> <span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ut</span><span class="p">.</span><span class="n">r</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span> <span class="o">-</span> <span class="n">ut</span><span class="p">.</span><span class="n">l</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">off</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="extra">Extra</h2>
<p>这场比赛的B题挺好玩的…要求选出的数字满足</p>
<p>$$c_i-c_{i+1}=p_{c_i}-p_{c_{i+1}}$$</p>
<p>…一上来傻了不知道咋做，其实只要把公式左右交换一下就完事了。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1295E] Permutation Separation</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1295e-permutation-separation/" />
            <id>https://blog.kanari.moe/code/cf-1295e-permutation-separation/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-02-28T17:47:47+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[You are given a permutation 𝑝1,𝑝2,…,𝑝𝑛 (an array where each integer from 1 to 𝑛 appears exactly once). The weight of the 𝑖-th element of this permutation is 𝑎𝑖……]]></summary>
            
                <content type="html"><![CDATA[<p>You are given a permutation 𝑝1,𝑝2,…,𝑝𝑛 (an array where each integer from 1 to 𝑛 appears exactly once). The weight of the 𝑖-th element of this permutation is 𝑎𝑖.</p>
<p>At first, you separate your permutation into two non-empty sets — prefix and suffix. More formally, the first set contains elements 𝑝1,𝑝2,…,𝑝𝑘, the second — 𝑝𝑘+1,𝑝𝑘+2,…,𝑝𝑛, where 1≤𝑘&lt;𝑛.</p>
<p>After that, you may move elements between sets. The operation you are allowed to do is to choose some element of the first set and move it to the second set, or vice versa (move from the second set to the first). You have to pay 𝑎𝑖 dollars to move the element 𝑝𝑖.</p>
<p>Your goal is to make it so that each element of the first set is less than each element of the second set. Note that if one of the sets is empty, this condition is met.</p>
<p>For example, if 𝑝=[3,1,2] and 𝑎=[7,1,4], then the optimal strategy is: separate 𝑝 into two parts [3,1] and [2] and then move the 2-element into first set (it costs 4). And if 𝑝=[3,5,1,6,2,4], 𝑎=[9,1,9,9,1,9], then the optimal strategy is: separate 𝑝 into two parts [3,5,1] and [6,2,4], and then move the 2-element into first set (it costs 1), and 5-element into second set (it also costs 1).</p>
<p>Calculate the minimum number of dollars you have to spend.</p>
<h2 id="分析">分析</h2>
<p>首先要解决的问题是如何断开。枚举排列的某个位置断开，似乎没有什么好办法转移，枚举数值上断开的位置显得更可靠一些。不过断开数值后，仍然没有什么好办法去直接求得从排列的何处断开。</p>
<p>考虑再次枚举排列的断开位置。当确定排列的一个断点后，由于已经知道两个子集所包含的数，可以$O(N)$算出到达目标状态需要的代价，在此以左侧小右侧大为准。当向右移动断点后，注意到左侧原有的需要移动数字<strong>仍然需要移动</strong>。于是，针对一个子集的分割，能够用通过线段树$O(n\lg n)$来求出在排列任何一个位置断开的代价。</p>
<p>接下来考虑数值上的断点移动后是否能够维护代价变化。当一个新的数字$a$被从大集合划归到小集合后，在排列中，以该数字$a$位置，左侧所有的断点都需要付出额外的代价将该数挪到左侧，而右侧所有的断点都不再需要支付代价来将该数挪到右侧。于是，这个代价也是可以维护的。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;limits&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">200010</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">flag</span><span class="p">[</span><span class="n">MAXN</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span><span class="n">dmin</span><span class="p">[</span><span class="n">MAXN</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">dmin</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="k">return</span><span class="p">;</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">dmin</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">dmin</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">dmin</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dmin</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span><span class="n">dmin</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="n">dmin</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="n">collect</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="n">ll</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">dmin</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">permu</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">wage</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">pos</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
 
 
    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">permu</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">pos</span><span class="p">[</span><span class="n">permu</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">wage</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span><span class="n">nlen</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//init
</span><span class="c1"></span>    <span class="c1">//以第i位切割，前i个为一个集合
</span><span class="c1"></span>    <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">modify</span><span class="p">(</span><span class="n">wage</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">,</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">){</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">root</span><span class="p">));</span>
        <span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">modify</span><span class="p">(</span><span class="n">wage</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">]],</span><span class="mi">1</span><span class="p">,</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">modify</span><span class="p">(</span><span class="o">-</span><span class="n">wage</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">]],</span><span class="n">pos</span><span class="p">[</span><span class="n">ptr</span><span class="p">],</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
 
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">C&#43;&#43;新标准特性初探</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/new-standard-of-cpp/" />
            <id>https://blog.kanari.moe/study/new-standard-of-cpp/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-02-23T21:24:40+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[说实话,这一套东西东拼西凑到处取经,不过有些还挺香的. 目前对于14,17的特性,GC……]]></summary>
            
                <content type="html"><![CDATA[<p>说实话,这一套东西东拼西凑到处取经,不过有些还挺香的.</p>
<p>目前对于14,17的特性,GCC和Clang都完成了很好的适配.在C++20上,下面提到的特性都在<strong>最新的</strong>版本里完成了绝大多数.</p>
<p>标准定得爽,到了实现就凉凉.</p>
<h2 id="auto">auto</h2>
<p>这个关键字...是真的...相信不久之后c++只需要下面一个参数.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="nf">auto</span><span class="p">(</span><span class="k">auto</span><span class="p">...){</span>
	<span class="k">return</span> <span class="k">auto</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这个东西,就是把变量类型交给编译器来考虑.这个特性实际上早该有了,因为c++编译器原本就会检查右值和左值的类型是否匹配,那么顺便填一个左值的类型也不会累着它.</p>
<p>这个也挺常用的.<code>for(auto it=vec.begin();...</code>这种写法省了很大工夫.</p>
<p>和它配合很好的是新引入的语法糖<code>for(auto item:var)</code>,写起来很爽.这玩意也支持引用.另外一个值得注意的是在C++17后,由模式绑定加成,这玩意能进一步写成<code>for(const auto&amp; [key,value] : map)</code>.</p>
<p>还有一个东西是<strong>auto用在函数签名的返回值时需要尾随返回值类型</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="o">???</span><span class="p">{</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在C++14里不需要再尾随返回值类型了.不过另外还有一种写法<code>decltype(auto)</code>,这两个的区别在于后者能够保留引用的类型信息.这个尾随返回值的用处就剩下在lambda表达式里用了.不过,尝试在签名里原本的返回类型位置写<code>auto</code>,转而把真实的返回类型尾随,这种写法越发像现代语言了.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">f</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="lambda-表达式">Lambda 表达式</h2>
<p>好用的东西.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">sort</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">(),[](</span><span class="k">const</span> <span class="n">Student</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="k">const</span> <span class="n">Student</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
	<span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">age</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">age</span><span class="p">;</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>再也不需要<code>cmp_1</code>,<code>cmp_2</code>了.</p>
<p>lambda表达式作为一个闭包,需要考虑其对于环境变量的捕捉类型.</p>
<ul>
<li>按值捕获</li>
<li>按引用捕获</li>
</ul>
<p>就如它们字面上的意思.实际实现时,将其写在<code>[]</code>内.例如<code>[=],[&amp;],[foo,&amp;bar]</code>.一个要注意的问题是,按值捕获时,捕获的变量均为const,不能修改,后缀<code>[]()mutable{}</code>后可以修改,不过这种修改不会影响环境变量.</p>
<p>在C++14中可以借助auto实现lambda多态.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="n">func</span><span class="o">=</span><span class="p">[](</span><span class="k">auto</span> <span class="n">a</span><span class="p">){</span><span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">a</span><span class="p">;};</span>
</code></pre></td></tr></table>
</div>
</div><p>然后这个func可以直接传很多参数.</p>
<p>另一个是在捕获时进行环境变量初始化,例如<code>[x=0]</code>.不过这玩意是否有额外的考虑...大概能去看看RFC?</p>
<p>在C++20中,lambda可以携带模板<code>[]&lt;typename T&gt;(){}</code>.</p>
<h2 id="using">using</h2>
<p>以前,我们定义<code>ll</code>有这么两派.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#define ll long long
</span><span class="cp"></span><span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>现在,新的一派加入了战场.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>这几种办法如果非要分出个高低,那大概要从下面几个方面说</p>
<ul>
<li>define是一种替换.它相对于另外两种来说,有些过于强大和随性,可能会带来问题.</li>
<li>typedef是C风格的.</li>
<li>using是C++风格的.另外using在内部的实现是基于模板的.这一点是否会带来好处我还没弄明白.</li>
</ul>
<h2 id="nullptr">nullptr</h2>
<p>赋值给空指针的新值,用来取代<code>NULL</code>.这个关键字对于工程的用处更高.它用于处理和重载,泛型编程有关的问题.</p>
<p>一个空指针在C风格中定义为宏<code>NULL</code>,这个东西,它是<code>0</code>的别名.那么,一个泛型函数到底该把它看作<code>int</code>还是指针?这也是不推荐用define定义新类型的一个理由.说不定什么时候就踩进坑.</p>
<h2 id="decltype">decltype</h2>
<p>对类型的运算,用于在编译时获取某个值的类型.算是个和<code>auto</code>配套的东西.因为<code>auto</code>了,你也不知道它到底是个什么,此时就可以</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="n">a</span><span class="o">=</span><span class="cm">/*something weired*/</span><span class="p">;</span>
<span class="k">decltype</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>怎么说呢...有了一种动态语言的调调.</p>
<hr>
<h2 id="用以上这些东西就能写出这种代码">用以上这些东西,就能写出这种代码.</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//当然这段代码是没啥意义的,只是用一下新的特性
</span><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">func</span><span class="p">(</span><span class="n">string</span> <span class="n">type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">)</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="o">==</span><span class="s">&#34;add&#34;</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">[](</span><span class="k">auto</span> <span class="n">x</span><span class="p">,</span><span class="k">auto</span> <span class="n">y</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="p">[](</span><span class="k">auto</span> <span class="n">x</span><span class="p">,</span><span class="k">auto</span> <span class="n">y</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//可变参数
</span><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">reduce</span><span class="p">(</span><span class="k">auto</span> <span class="n">f</span><span class="p">,</span><span class="k">const</span> <span class="n">T</span><span class="p">...</span> <span class="n">args</span><span class="p">){</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">vec</span><span class="o">=</span><span class="p">{</span><span class="n">args</span><span class="p">...};</span>
    <span class="k">auto</span> <span class="n">res</span><span class="o">=*</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">ne</span><span class="o">=</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">ne</span><span class="o">!=</span><span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="n">ne</span><span class="o">++</span><span class="p">){</span>
        <span class="n">res</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="o">*</span><span class="n">ne</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">reduce</span><span class="p">(</span><span class="n">func</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;add&#34;</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="constexpr">constexpr</h2>
<p>好了,现在对于</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>我们有了新的写法.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>实际上,下面的写法才是对的.上面的写法按照标准应该是无法通过编译的,只不过它太常用,编译器知道你想干嘛,所以默默完成了操作,没有人抱怨,可喜可贺.</p>
<p><code>constexpr</code>用于在<strong>编译阶段</strong>进行求值.也可以用在函数.以往有些人在模板上玩花,在编译阶段就让编译器率先完成类似于打表之类的操作,以至于评测器陆续全部完善了编译时限制时间.现在再想玩这些操作,可以直接使用<code>constexpr</code>了.不过可惜的是它还C++11里比较菜,不能完成复杂运算.直到在C++14里,<code>constexpr</code>能够支持<code>if</code>甚至递归了.</p>
<p>在C++14里,<code>constexpr</code>能够和<code>template</code>配合实现对不同类型常量的初始化.这一点基本上就把<code>#define PI 3.1415926535897932385</code>打爆.推荐使用<code>#define</code>定义<code>PI</code>的原因就在于它的替换行为能够免去在常量定义过程中被类型精度影响.</p>
<h2 id="右值引用">右值引用</h2>
<p>这玩意的存在意义主要是消除不必要拷贝，并给泛型编程带来便利。</p>
<p>一般来讲，当我们执行如下的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Student</span> <span class="n">student</span><span class="p">;</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">Tiansuo</span> <span class="n">Li</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;,</span><span class="mi">24</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>第二行的赋值过程中发生了内存的复制和销毁。对……这个学生的信息并没有直接给student。</p>
<blockquote>
<p>据说现代编译器能够针对这种情况进行优化了。</p>
</blockquote>
<p>右值有这么一个特性，<strong>只能被使用一次</strong>。这是非常重要的一个特性，例如字符串、常量，这些东西除了在作为右值赋值给左值的一瞬间，其他时候再无用处。那么在这种情况下，仍然对此类右值执行复制就显得很累赘。右值引用就是用于解决此类问题的。</p>
<p>右值引用使用<code>&amp;&amp;</code>标注。</p>
<p>为Student实现以下右值引用语义</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Student</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Student</span> <span class="o">&amp;&amp;</span><span class="n">stu</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="k">this</span> <span class="o">!=&amp;</span><span class="n">str</span><span class="p">){</span>
		<span class="n">name</span><span class="o">=</span><span class="n">stu</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
		<span class="n">age</span><span class="o">=</span><span class="n">stu</span><span class="p">.</span><span class="n">age</span><span class="p">;</span>
		
		<span class="n">stu</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">;</span>
		<span class="n">stu</span><span class="p">.</span><span class="n">age</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>当然复制一个名字什么的还没有这么大区别。</p>
<p><code>std::move</code>这个关键字和上面的右值引用有点关系。它指明对象的赋值带有资源的转移，也就是强制进行右值引用和资源移动（比如上例中学生名字的移动）。</p>
<p>这种感觉是不是和rust有点相似？不过很可惜这不是一种东西。至少它在最初设计上不是。但是当和一些智能指针例如<code>unique_ptr</code>一同使用时，确实达到了一种所有权移动的感觉。</p>
<p>大家想的都是差不多的嘛。</p>
<p>另外<code>std::forward</code>也是基于引用给出的工具。用来<strong>把数据按原样返回</strong>。左值引用归左值引用，右值的归右值。</p>
<h2 id="智能指针">智能指针</h2>
<p>这个对我来说不是很常用.</p>
<p><code>std::unique_ptr</code>是无法复制但是可以移动的智能指针,刚才已经说了.</p>
<p><code>std::shared_ptr</code>是可以在不同代码或者线程间共享的指针,是和上面的相对而言的.不过它不保证其内部保管的对象也可以线程安全...这让我想起来rust的<code>Arc&lt;Mutex&lt;...&gt;&gt;</code>.</p>
<p>与shared_ptr配套使用的还有make_shared.</p>
<h2 id="内存模型">内存模型</h2>
<p>说实话,这个大概才是重点,不过对我来说不常用.</p>
<p>这意味着c++标准库将提供无关平台的一系列线程操作,包括线程,锁,原子操作,异步等.</p>
<ul>
<li>std::thread 来自标准库的线程</li>
<li>std::async c++也从c#那里搬来了async和await那套异步编程模型</li>
</ul>
<h2 id="可变参数">可变参数</h2>
<p>也不常用...</p>
<p>想知道在没有可变参数的时候,printf是怎么实现的吗?那个模板嵌套是真的恐怖.直到今天C++也有可变参数了.其语法上是<code>...</code></p>
<p>这玩意是用在模板里的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pattern</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="p">...</span> <span class="n">args</span><span class="p">){</span>
	<span class="c1">//bula bula
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>既然有了可变参数,就能有元组.与其同时而来的还有<code>std::tie</code>,用于解构元组.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">tie</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">=</span><span class="n">make_tuple</span><span class="p">(</span><span class="s">&#34;Tiansuo Li&#34;</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>C++17里,这种解构被进一步提升为结构绑定.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">const</span> <span class="k">auto</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">make_tuple</span><span class="p">(</span><span class="s">&#34;Tiansuo Li&#34;</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="和面向对象有关的">和面向对象有关的</h2>
<p>目前又是不常用的东西.</p>
<p>显式方法重载.这个是面向对象里的概念.具体就是在重写虚函数时在函数签名最后注明<code>override</code>,编译器就会根据实际情况给出更多的提示和帮助.</p>
<p><code>final</code>封闭方法.这个也是面向对象概念.用于将一个虚函数封闭,不再让子类重写.</p>
<p><code>=default</code>默认方法.这个仍然是面向对象概念.显式的写明使用默认实现.</p>
<p><code>=delete</code>删除方法....还是.显式的注明从类中删除某个方法(例如默认方法),防止他人调用.</p>
<p>允许非静态成员变量自行初始化.</p>
<p>方法重载能够注明左右值的区分.</p>
<h2 id="array">array</h2>
<p>不可变长的数组,需要在声明时就给出大小.这玩意很常用所以也搞出来.</p>
<p>与此相关的信息是vector的空间占用,这个东西的行为有如下两个特点</p>
<ul>
<li>当需要新空间时,将重新申请原来两倍的空间.</li>
<li>将数据复制到新空间.</li>
</ul>
<p>如果确定数据的大小,array显然是个更好的选择.</p>
<h2 id="stdoptional">std::optional</h2>
<p>天 下 大 同.</p>
<p>这玩意和rust的<code>Option</code>是一个东西.你家C++也要变成<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>了.</p>
<h2 id="concepts">Concepts</h2>
<p>天 下 大 同 x 2.</p>
<p>这玩意用于<strong>限定</strong>模板中的类型.类似于rust内的<code>+</code>描述.</p>
<h2 id="其他信息">其他信息</h2>
<ul>
<li>std::chrono 来自标准库的时间计算</li>
<li>unordered_xxx 基于哈希的无序容器,这个已经很常用了吧</li>
<li>std::begin/end ...这个算是填坑?虽然各个容器都提供了类似的API,不过在泛型编程时,还是需要一个这种东西.</li>
<li>允许模板嵌套时右侧尖括号紧靠.这个其实很好.以及也要注意这个特性是在C++11里修订的.</li>
<li>noexcept 放在函数签名里表示不抛异常</li>
<li>attribute 用<code>[[]]</code>来标注属性(注解),有点像rust的<code>#[[]]</code>一类的东西.在C++20里,有一个比较有趣的注解<code>likely</code>可以向编译器建议分支的预测结果,这个和CSAPP课程相关性很强.</li>
<li>二进制表示,在C++14中,这没啥可说的,<code>0b010101</code>.</li>
<li>带初始化的<code>if</code>.在C++17中,能够用类似于golang中的带初始化<code>if</code>了.</li>
<li>带初始化的range<code>for</code>.在C++20中,<code>for(:)</code>的玩意能够自带初始化语句了.</li>
<li><strong>utf-8支持</strong>.在C++17中,字符前缀<code>u8</code>能够获得utf-8的字符了.在C++20中,存在<code>char8_t</code>用于支持字符串.</li>
</ul>
<h2 id="可能关注的其他东西">可能关注的其他东西</h2>
<p><code>popcount</code>.C++20提供的函数,可以数二进制数中1的个数.另外还有一些操作,位于<code>&lt;bit&gt;</code>中.</p>
<p>数学常数.例如<code>std::numbers::pi</code>.不过这个倒无所谓...应该都知道<code>acos(-1)</code>.</p>
<h2 id="c走在现代化的路上">C++走在现代化的路上</h2>
<p>先提一个问题.GCC和Clang二者最新版本的编译器的安装可能会给你带来麻烦,尤其是Windows用户.MinGW,MinGW-w64,TDM-GCC<strong>都没有</strong>更新到最新版本.如果希望使用20标准,似乎最简单的办法是安装<code>msys2</code>.</p>
<p>其实在翻看完这些新标准后,我越发觉得我原来学的C++和现在的C++是不同的语言.你可以把C++当C来写,也可以停在11之前的标准来写,也可以大踏步来到20.三种风格写出来的代码完全不是一个东西.</p>
<p>另外,我一直没有注意智能指针,右值引用和<code>移动</code>概念,在了解Rust之后才意识到它们的重要性.除了没有Rust与生俱来的生命周期以及所有权的静态检查,C++把其他该有的似乎全有了.倒不如说Rust也从C++这里借鉴了大量东西,比如智能指针.</p>
<p>说实话,在此时我有点更倾向于使用C++了.</p>
<blockquote>
<p>C++的编译器也能在移动语义上进行较为宽松的静态检查,such as 已经move的变量再次使用会被warning.</p>
</blockquote>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">使用Python分析数据</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/python-in-data-processing/" />
            <id>https://blog.kanari.moe/code/python-in-data-processing/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-02-22T11:45:06+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[本来这不是我现在该想的东西，被迫因为建模比赛看了一点。所学东西太过杂乱。 为什么不用M……]]></summary>
            
                <content type="html"><![CDATA[<p>本来这不是我现在该想的东西，被迫因为建模比赛看了一点。所学东西太过杂乱。</p>
<h2 id="为什么不用matlabmathematica">为什么不用Matlab、Mathematica</h2>
<p>因为Mathematica被我卸了，Matlab没学过，也不喜欢。这只是一个排除法，我不知道该怎么从优势上比较。</p>
<p>R语言没学过，Julia也没有，所以回归工具齐全的Python。</p>
<h2 id="python-数据分析套装">Python 数据分析套装</h2>
<p>建议目标就是分析数据的人直接安装<code>anaconda</code>，使用jupyter lab，不折腾。</p>
<ul>
<li>对于数据读入和清洗：<code>Pandas</code></li>
<li>对于矩阵等向量运算：<code>numpy</code></li>
<li>对于计算机代数计算：<code>sympy</code></li>
</ul>
<h3 id="绘图">绘图</h3>
<p>绘图的库就很多了。Matplotlib，Plotly，Seaborn，Altair这几个还不错。第一个比较底层，是直接参照Matlab的API设计的，Seaborn是在其基础上设计的更高层的绘图包,所以使用、配色、排版什么的都不错。Plotly和Altair都是具有一定交互能力的绘图包，在lab里是需要前端js配合绘图的（所以一旦图片数据太多，会卡得浏览器痛不欲生）。</p>
<p>我就胡乱选了个Plotly。不过现在看来大概是个错误的决定。</p>
<h3 id="plotly在国内配置的坑">Plotly在国内配置的坑</h3>
<p>看着npm和yarn这两个字眼就害怕现在。js那一堆乱七八糟的工具链，支持度各不相同的标准，这里可以import，那里又会ce必须用require，又let又var，到现在也整不清楚的this和that，有的包要求传正确的lambda表达式，有的又必须用function，还有一堆坑……看着就想躲着走，然而这plotly的构建是需要npm和yarn的。</p>
<p>……为什么这破语言能用到现在。</p>
<p>在安装Plotly向Jupyter lab的支持库时，切勿在<code>npm</code>和<code>yarn</code>中使用镜像。镜像和源之间有一定的更新延迟并且存在同步错误而跳过某些包的问题。我就正好卡在了被跳过的包上，因为这个问题死活编译不过去浪费了很长时间。</p>
<p>其次，使用Plotly输出<code>.pdf</code>等格式的图片文件时，需要安装<code>ocra</code>，在服务器上配置时还需要安装<code>xvfb</code>，这些都在其文档中有写，不过视系统不同仍然需要自己补齐很多支持库。从这个角度上来说，似乎还是选择Seaborn+Matplotlab比较好，除非你有工具人，否则不要把时间浪费在莫名其妙的地方。</p>
<h2 id="基本操作">基本操作</h2>
<p>numpy和pandas都有快速入门教程，花20分钟读一读，然后剩下的随用随查就好了。</p>
<p>这里记几个常用但是不太好找的东西。</p>
<h3 id="如何遍历数据帧的所有行">如何遍历数据帧的所有行</h3>
<p>标准操作是<code>apply</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#039;pass&amp;#039;]=df.apply(lambda a:a[&amp;#039;grade&amp;#039;]&gt;=60,axis=1)</span>
</code></pre></td></tr></table>
</div>
</div><p>但是，这玩意的坑在于传给它的函数内部是只能get不能set的。即使set也没有作用。不过一般修改单列数据也没有问题，可以像上面一行一样。</p>
<p>另外时刻记住，筛选的数据帧结果<strong>也是不能set的</strong>。虽然不知道为什么，但是我在踩这个坑的时候，有些时候不但不会修改而且连错误也不会报。</p>
<p>不过如果是修改多行数据呢，上面的命令是不能简单推广的。当然可以用一些很丑陋的做法，比如<code>for i in range(df.shape[0])</code>（可能有稍微好看一点的写法）然后<code>iloc</code>一个个的改掉。不过实际上，仍然有使用<code>apply</code>的余地。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#039;计算机导♂论&amp;#039;])*10,math.sqrt(row[&amp;#039;高等♂数学&amp;#039;])*10</span>

<span class="n">df</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#039;计算机导♂论&amp;#039;],df[&amp;#039;高等♂数学&amp;#039;]=zip(*df.apply(fn,axis=1))</span>
</code></pre></td></tr></table>
</div>
</div><p>开方乘十，标准的捞人方法要不要了解一下。</p>
<p>这种方案可读性较差，不过实测是快于手动遍历的。听说python不想让人管复杂度，事实却不大行啊。</p>
<h3 id="plotly的整体设计">Plotly的整体设计</h3>
<p>Plotly的官方文档写得很好，看完概览后费点功夫就能找到自己想要的图的画法。再想自定义就去翻API。</p>
<p>总体来看，<code>graph_object</code>（好像是这么拼？）是最基础的绘图对象，设置好图例后加入到<code>Figure</code>里，就可以作为最终结果输出。<code>express</code>是一个更高层的工厂，能够满足一般情况常用的图的快速绘制。所以，先去<code>express</code>，满足不了再往下找。</p>
<p>如果看完概览了之后还能发现一个很重要的信息。设置图例属性时可能会遇到嵌套多层对象的那种参数，这时候可以直接使用<code>_</code>连接参数名，不需要一层层构造。</p>
<p>知道这些之后随便画就是了。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">换个主题</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/change-theme/" />
            <id>https://blog.kanari.moe/gossip/change-theme/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-02-21T17:43:17+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[[music autoplay=&quot;0&quot;]40915181[/music] 上面这个改编的交响乐还不错，顺便测试一下音乐盒 这个主题还可以，有一些比较比较有趣……]]></summary>
            
                <content type="html"><![CDATA[<p>[music autoplay=&quot;0&quot;]40915181[/music]</p>
<blockquote>
<p>上面这个改编的交响乐还不错，顺便测试一下音乐盒</p>
</blockquote>
<p>这个主题还可以，有一些比较比较有趣的东西。</p>
<p>其实是连系统都换了……不想折腾了，还是这样算了。</p>
<h2 id="修改的地方">修改的地方</h2>
<ul>
<li>在head部分添加了浏览统计。</li>
<li>在pjax调用的jquery封装插件处添加了mathjax的重新渲染。</li>
<li>进一步启用了cdn严格模式的SSL/TLS。</li>
<li>关闭了主题自带的代码高亮，启用了Prism高亮，并且配置在pjax的重新渲染。(修改设计pjax.js和主题自身js,共两处;另外css内样式未去除)</li>
<li>修改了归档页面的部分语句……还有404页面的部分语句……（希望没有漏网的</li>
</ul>
<p>如果你看到浏览器仍然提示不安全，是因为网站内仍然有一些图片使用了http，什么时候闲得没事再来修。另外图片加载这么慢我也没什么办法，毕竟世界上的互联网分为两部分。</p>
<p>服务器对中文url的支持貌似也有些问题。</p>
<h2 id="假期将过">假期将过</h2>
<p>假期就这么没了。头秃。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">树链剖分</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/heavy-light-decomposition/" />
            <id>https://blog.kanari.moe/study/heavy-light-decomposition/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-02-18T16:11:56+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[树链剖分可以用来维护树上路径的信息。把树上的节点拆成不超过$O(\log n)$段连续……]]></summary>
            
                <content type="html"><![CDATA[<p>树链剖分可以用来维护树上路径的信息。把树上的节点拆成不超过$O(\log n)$段连续的路径（链），以映射到线段树或者什么的构来维护数据。</p>
<p>依照子树的大小，将最大子树作为重边，其他子树作为轻边，从而在树上拆分出多条链。为同一条链上的节点连续编号，完成剖分。至于剩下的，依照编号一条链可以连续的映射到数据结构的某个取间内，用类似于倍增LCA的方法在树上得到每一个询问所覆盖的链的起始与结尾然后继续其他操作就可以了。</p>
<h2 id="通常策略">通常策略</h2>
<ul>
<li>对于子树的大小统计，dfs即可。</li>
<li>之后节点编号使用先序的dfs序，并且<strong>优先进入重边</strong>，以保证链上节点的编号连续。</li>
<li>为了在链上快速跳转，还需要记录每个节点所在链的头。</li>
</ul>
<p>具体的代码可以看下面两个题目。<del>其实我也是从别处抄了板子</del></p>
<h2 id="hdu-3966-aragorns-story">HDU 3966 Aragorn's Story</h2>
<p>题目要求区间修改某条路径上所有节点的权值，查询某个点的权值。</p>
<p>就剖，剖完线段树还是树状数组区间修改单点查询。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">50010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">vlen</span><span class="p">,</span><span class="n">elen</span><span class="p">,</span><span class="n">qlen</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">fa</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">sz</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">dep</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">son</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">top</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rnk</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">dfs1</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">){</span>
	<span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
	<span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">dep</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">==</span><span class="n">f</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
		<span class="n">dfs1</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
		<span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">&gt;</span><span class="n">sz</span><span class="p">[</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]]){</span>
			<span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dfs2</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">){</span>
	<span class="n">top</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
	<span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=++</span><span class="n">tick</span><span class="p">;</span>
	<span class="n">rnk</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
	<span class="n">dfs2</span><span class="p">(</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">f</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">!=</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="o">!=</span><span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="n">dfs2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">FTN</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">MAXN</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft</span><span class="p">[</span><span class="n">FTN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">lowbit</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
	<span class="k">return</span> <span class="n">x</span><span class="o">&amp;-</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">ftadd</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(;</span><span class="n">pos</span><span class="o">&lt;</span><span class="n">FTN</span><span class="p">;</span><span class="n">pos</span><span class="o">+=</span><span class="n">lowbit</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span><span class="n">ft</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">ftget</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(;</span><span class="n">pos</span><span class="p">;</span><span class="n">pos</span><span class="o">-=</span><span class="n">lowbit</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span><span class="n">res</span><span class="o">+=</span><span class="n">ft</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
	<span class="k">return</span> <span class="n">ftget</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">pos</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
	<span class="n">ftadd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
	<span class="n">ftadd</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">delta</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">fx</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">fy</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
	
	<span class="k">while</span><span class="p">(</span><span class="n">fx</span><span class="o">!=</span><span class="n">fy</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">fx</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dep</span><span class="p">[</span><span class="n">fy</span><span class="p">])</span><span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">fx</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">delta</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">fx</span><span class="p">];</span>
		<span class="k">else</span> <span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">fy</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">delta</span><span class="p">),</span><span class="n">y</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">fy</span><span class="p">];</span>

		<span class="n">fx</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
		<span class="n">fy</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">!=</span><span class="n">y</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dfn</span><span class="p">[</span><span class="n">y</span><span class="p">])</span><span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">delta</span><span class="p">);</span>
		<span class="k">else</span> <span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">delta</span><span class="p">);</span>
	<span class="p">}</span><span class="k">else</span> <span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">delta</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>

	<span class="k">while</span><span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">vlen</span><span class="p">,</span><span class="o">&amp;</span><span class="n">elen</span><span class="p">,</span><span class="o">&amp;</span><span class="n">qlen</span><span class="p">)){</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">vlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">ft</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ft</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fa</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sz</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dep</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">son</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">son</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">top</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">top</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dfn</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">rnk</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">rnk</span><span class="p">));</span>
		<span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">vlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="n">num</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">elen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
			<span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
			<span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">dfs1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
		<span class="n">dfs2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/*
</span><span class="cm">		for(int i=1;i&lt;=vlen;i++)
</span><span class="cm">			cout&lt;&lt;dfn[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">		cout&lt;&lt;endl;
</span><span class="cm">		*/</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">vlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">modify</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="cm">/*
</span><span class="cm">		for(int i=1;i&lt;=vlen;i++){
</span><span class="cm">			cout&lt;&lt;query(i)&lt;&lt;&#34; &#34;;
</span><span class="cm">		}
</span><span class="cm">		cout&lt;&lt;endl;
</span><span class="cm">		*/</span>

		<span class="k">while</span><span class="p">(</span><span class="n">qlen</span><span class="o">--</span><span class="p">){</span>
			<span class="kt">char</span> <span class="n">opt</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">opt</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">&#39;I&#39;</span> <span class="o">||</span> <span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">&#39;D&#39;</span><span class="p">){</span>
				<span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">;</span>
				<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">&#39;D&#39;</span><span class="p">)</span><span class="n">x</span><span class="o">=-</span><span class="n">x</span><span class="p">;</span>
				<span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
			<span class="p">}</span><span class="k">else</span><span class="p">{</span>
				<span class="kt">int</span> <span class="n">u</span><span class="p">;</span>
				<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">);</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>	


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="cf343d-water-tree">CF343D Water Tree</h2>
<p>稍微有点不一样。修改1要求为点的整个子树打标记，修改2要求取消节点到根节点上的标记。</p>
<p>按照dfs序的编号方式，为每一个节点记录进入时间和离开时间，就能得到该节点子树映射后的连续区间。那么浇水就可以套一个线段树直接改了。清空水往根节点跳然后修改一路上经过的链。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">500010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">vlen</span><span class="p">,</span><span class="n">elen</span><span class="p">,</span><span class="n">qlen</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">fa</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">sz</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">dep</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">son</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">top</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">outdfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">dfs1</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">){</span>
	<span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
	<span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">dep</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">==</span><span class="n">f</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
		<span class="n">dfs1</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
		<span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">&gt;</span><span class="n">sz</span><span class="p">[</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]]){</span>
			<span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dfs2</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">){</span>
	<span class="n">top</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
	<span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=++</span><span class="n">tick</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
		<span class="n">outdfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=++</span><span class="n">tick</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dfs2</span><span class="p">(</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">f</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">!=</span><span class="n">son</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="o">!=</span><span class="n">fa</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="n">dfs2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">outdfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=++</span><span class="n">tick</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">FTN</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">MAXN</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">dat</span><span class="p">[</span><span class="n">FTN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">FTN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">FTN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">r</span><span class="p">){</span>
		<span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
	<span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
	<span class="n">dat</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">=</span><span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
	<span class="n">dat</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">=</span><span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
	<span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">fill_water</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
		<span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">fill_water</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">fill_water</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">f</span><span class="o">**</span><span class="nf">k_water</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
		<span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">f</span><span class="o">**</span><span class="n">k_water</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">f</span><span class="o">**</span><span class="n">k_water</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">F</span><span class="o">**</span><span class="nf">K_WATER</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">){</span>
	<span class="k">while</span><span class="p">(</span><span class="n">u</span><span class="o">!=</span><span class="mi">0</span><span class="p">){</span>
		<span class="c1">//cout&lt;&lt;&#34;clear &#34;&lt;&lt;dfn[u]&lt;&lt;endl;
</span><span class="c1"></span>		<span class="n">f</span><span class="o">**</span><span class="n">k_water</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">top</span><span class="p">[</span><span class="n">u</span><span class="p">]],</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">tick</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
		<span class="n">u</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">top</span><span class="p">[</span><span class="n">u</span><span class="p">]];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="c1">//1有水
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="o">==</span><span class="n">pos</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">==</span><span class="n">pos</span><span class="p">)</span><span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
	<span class="k">else</span> <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

	<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">vlen</span><span class="p">;</span>
	<span class="n">elen</span><span class="o">=</span><span class="n">vlen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">elen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">u</span><span class="o">&gt;&gt;</span><span class="n">v</span><span class="p">;</span>
		<span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
		<span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">dfs1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dfs2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tick</span><span class="p">);</span>
	<span class="cm">/*
</span><span class="cm">	for(int i=1;i&lt;=vlen;i++){
</span><span class="cm">		cout&lt;&lt;dfn[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">	}
</span><span class="cm">	cout&lt;&lt;endl;
</span><span class="cm">	for(int i=1;i&lt;=vlen;i++){
</span><span class="cm">		cout&lt;&lt;outdfn[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">	}
</span><span class="cm">	cout&lt;&lt;endl;
</span><span class="cm">	*/</span>

	<span class="kt">int</span> <span class="n">qlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">qlen</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">qlen</span><span class="o">--</span><span class="p">){</span>
		<span class="kt">int</span> <span class="n">opt</span><span class="p">,</span><span class="n">u</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">opt</span><span class="o">&gt;&gt;</span><span class="n">u</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
			<span class="n">fill_water</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">outdfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tick</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
			<span class="c1">//cout&lt;&lt;&#34;add &#34;&lt;&lt;dfn[u]&lt;&lt;&#34;-&#34;&lt;&lt;outdfn[u]&lt;&lt;endl;
</span><span class="c1"></span>		<span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
			<span class="n">F</span><span class="o">**</span><span class="n">K_WATER</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="p">}</span><span class="k">else</span><span class="p">{</span>
			<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">query</span><span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">tick</span><span class="p">,</span><span class="n">root</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1165F2]Microtransactions</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1165f2microtransactions/" />
            <id>https://blog.kanari.moe/code/cf-1165f2microtransactions/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-21T15:11:56+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>Ivan plays a computer game that contains some microtransactions to make characters look cooler. Since Ivan wants his character to be really cool, he wants to use some of these microtransactions — and he won't start playing until he gets all of them.</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>Ivan plays a computer game that contains some microtransactions to make characters look cooler. Since Ivan wants his character to be really cool, he wants to use some of these microtransactions — and he won't start playing until he gets all of them.</p>
<p>Each day (during the morning) Ivan earns exactly one burle.</p>
<p>There are n types of microtransactions in the game. Each microtransaction costs 2 burles usually and 1 burle if it is on sale. Ivan has to order exactly ki microtransactions of the i-th type (he orders microtransactions during the evening).</p>
<p>Ivan can order any (possibly zero) number of microtransactions of any types during any day (of course, if he has enough money to do it). If the microtransaction he wants to order is on sale then he can buy it for 1 burle and otherwise he can buy it for 2 burles.</p>
<p>There are also m special offers in the game shop. The j-th offer (dj,tj) means that microtransactions of the tj-th type are on sale during the dj-th day.</p>
<p>Ivan wants to order all microtransactions as soon as possible. Your task is to calculate the minimum day when he can buy all microtransactions he want and actually start playing.</p>
<h2 id="分析">分析</h2>
<p>首先，不关注到底买了哪个商品，因为每种商品的价格都一样，记$i$种商品需要$k_i$，全体商品总数$K$。</p>
<p>首先，如果没有任何优惠，需要$2K$天。在有优惠时，我们需要尽可能在优惠<strong>当天</strong>买齐需要的商品。我们放开的天数越多，钱越多，同时也越有可能遇到优惠（花的钱减少）。以此，题目具有单调性。</p>
<p>二分时间$t$。得出哪种商品有优惠，并从$2K$元内抵消优惠部分。尽量将买商品的决策拖到该商品最后一次优惠进行，若商品有优惠，买比不买好，我们要尽可能将手中积攒的钱扔出去。唯一的问题是越靠后的商品我们能够用之后的钱去买，但是更靠前的优惠可能会因为买了前述那种商品而没有更多钱购买。因此将每种商品购买时机拖得越晚越好，这样我们顶多会遇到没钱买下一个优惠的问题，不过二者贡献一样，这对最终答案没有影响。因为这玩意wa了一发..</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">400010</span><span class="p">;</span>

<span class="c1">// 商品数目 打折次数
</span><span class="c1"></span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">wanted</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">bwanted</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">offs</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">goodoff</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span><span class="c1">//第i种商品最后的打折时机
</span><span class="c1"></span><span class="kt">int</span> <span class="n">maxday</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">summ</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="kt">bool</span> <span class="nf">check</span><span class="p">(</span><span class="n">ll</span> <span class="n">day</span><span class="p">){</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">goodoff</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">goodoff</span><span class="p">));</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">wanted</span><span class="p">,</span><span class="n">bwanted</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">wanted</span><span class="p">));</span>

	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">((</span><span class="n">ll</span><span class="p">)</span><span class="n">maxday</span><span class="p">,</span><span class="n">day</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">t</span><span class="p">:</span><span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
			<span class="n">goodoff</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="cm">/*
</span><span class="cm">	cout&lt;&lt;&#34;end at &#34;&lt;&lt;day&lt;&lt;endl;
</span><span class="cm">	for(int i=1;i&lt;=n;i++){
</span><span class="cm">		cout&lt;&lt;goodoff[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">	}
</span><span class="cm">	cout&lt;&lt;endl;
</span><span class="cm">	*/</span>
	<span class="n">ll</span> <span class="n">cost</span><span class="o">=</span><span class="n">summ</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">free</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">((</span><span class="n">ll</span><span class="p">)</span><span class="n">maxday</span><span class="p">,</span><span class="n">day</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">free</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">t</span><span class="p">:</span><span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
			<span class="k">if</span><span class="p">(</span><span class="n">goodoff</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">!=</span><span class="n">i</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">free</span><span class="o">&gt;</span><span class="n">wanted</span><span class="p">[</span><span class="n">t</span><span class="p">]){</span>
				<span class="n">free</span><span class="o">-=</span><span class="n">wanted</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
				<span class="n">cost</span><span class="o">-=</span><span class="n">wanted</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
				<span class="n">wanted</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span><span class="k">else</span><span class="p">{</span>
				<span class="n">wanted</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-=</span><span class="n">free</span><span class="p">;</span>
				<span class="n">cost</span><span class="o">-=</span><span class="n">free</span><span class="p">;</span>
				<span class="n">free</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cost</span><span class="o">&lt;=</span><span class="n">day</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

	
	<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">wanted</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">summ</span><span class="o">+=</span><span class="n">wanted</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">bwanted</span><span class="p">,</span><span class="n">wanted</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">bwanted</span><span class="p">));</span>

	
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="kt">int</span> <span class="n">d</span><span class="p">,</span><span class="n">t</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">d</span><span class="o">&gt;&gt;</span><span class="n">t</span><span class="p">;</span>
		<span class="n">maxday</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxday</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
		<span class="n">offs</span><span class="p">[</span><span class="n">d</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">ll</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mf">5e5</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
		<span class="n">ll</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">mid</span><span class="p">)){</span>
			<span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
		<span class="p">}</span><span class="k">else</span> <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">r</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1156F]Card Bag</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1156fcard-bag/" />
            <id>https://blog.kanari.moe/code/cf-1156fcard-bag/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-21T15:11:18+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>You have a bag which contains n cards. There is a number written on each card; the number on i-th card is ai.</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>You have a bag which contains n cards. There is a number written on each card; the number on i-th card is ai.</p>
<p>You are playing the following game. During each turn, you choose and remove a random card from the bag (all cards that are still left inside the bag are chosen equiprobably). Nothing else happens during the first turn — but during the next turns, after removing a card (let the number on it be x), you compare it with the card that was removed during the previous turn (let the number on it be y). Possible outcomes are:</p>
<p>if x &lt; y, the game ends and you lose;
if x = y, the game ends and you win;
if x &gt; y, the game continues.
If there are no cards left in the bag, you lose. Cards are not returned into the bag after you remove them.</p>
<p>You have to calculate the probability of winning in this game. It can be shown that it is in the form of PQ where P and Q are non-negative integers and Q≠0, P≤Q. Output the value of P⋅Q−1 (mod  998244353).</p>
<h2 id="分析">分析</h2>
<p>数据范围足够通过累积每轮游戏中的胜率来算。先想办法算游戏运行到第$i$轮的概率。</p>
<p>定义$f(i,j)$为第i次抽卡抽出$j$且游戏将继续的概率，发现</p>
<ul>
<li>$f(i,j)$只能从$f(i,0 \to j-1)$转移。否则游戏结束。</li>
<li>由上条，第$i$次抽出$j$的概率也可知，因为前面抽卡没有抽过$j$。</li>
</ul>
<p>记牌总数$n$，牌面为$i$的牌有$c(i)$张，有转移</p>
<p>$$
\begin{aligned}
f(i,j)=\frac{c(j)}{n-i+1}\sum_{0 \leq k \leq j-1}f(i-1,k)
\end{aligned}
$$</p>
<p>有答案</p>
<p>$$
\text{ans}=\sum_{1 \leq i,j \leq n} f(i,j)\frac{c(j)-1}{n-i+1}
$$</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">5010</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">MOD</span><span class="o">=</span><span class="mi">998244353</span><span class="p">;</span>

<span class="c1">// 游戏进行到第i轮,抽出j且没有结束的概率
</span><span class="c1"></span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">card</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">inv</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
	<span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">get_inv</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
	<span class="k">return</span> <span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">init_inv</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">inv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">get_inv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">MOD</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>


	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="n">init_inv</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="kt">int</span> <span class="n">x</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">;</span>
		<span class="n">card</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">ll</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>

		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
			<span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">cnt</span><span class="o">*</span><span class="n">card</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
			<span class="c1">//cout&lt;&lt;&#34;f(&#34;&lt;&lt;i&lt;&lt;&#34;,&#34;&lt;&lt;j&lt;&lt;&#34;)&#34;&lt;&lt;f[i][j]&lt;&lt;endl;
</span><span class="c1"></span>			<span class="n">cnt</span><span class="o">=</span><span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
			<span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">+</span><span class="p">((</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">card</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">inv</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
			<span class="n">ans</span><span class="o">%=</span><span class="n">MOD</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF 1156D] 0-1 Tree</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-1156d-0-1-tree/" />
            <id>https://blog.kanari.moe/code/cf-1156d-0-1-tree/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-21T15:10:42+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>You are given a tree</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>You are given a tree</p>
<p>(an undirected connected acyclic graph) consisting of n vertices and n−1 edges. A number is written on each edge, each number is either 0 (let's call such edges 0-edges) or 1 (those are 1-edges).</p>
<p>Let's call an ordered pair of vertices (x,y) (x≠y) valid if, while traversing the simple path from x to y, we never go through a 0-edge after going through a 1-edge. Your task is to calculate the number of valid pairs in the tree.</p>
<h2 id="分析">分析</h2>
<p>当经过一条<code>1</code>，就不能再经过<code>0</code>。所以路径只会有（称<code>1</code>为黑，<code>0</code>为白）</p>
<ul>
<li>全<code>0</code></li>
<li>全<code>1</code></li>
<li>从某处划分后一半为<code>1</code>一半为<code>0</code></li>
</ul>
<p>维护从点<code>u</code>到其子树任意节点的白色路径，黑色路径总数。那么答案就可以统计了。</p>
<ol>
<li>从子树到自己的黑，白路径</li>
<li>子树到子树的黑，白路径</li>
<li>以<code>u</code>为分界点的黑白路径。包括子树到子树，子树到非子树。</li>
</ol>
<p>子树到非子树的黑白节点已经包括在第1，2部分。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span><span class="o">=</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span><span class="o">=</span><span class="mi">200010</span><span class="p">,</span><span class="n">MAXE</span><span class="o">=</span><span class="mi">400020</span><span class="p">;</span>


<span class="k">struct</span> <span class="nc">Edge</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">v</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">;</span>
<span class="p">}</span><span class="n">edges</span><span class="p">[</span><span class="n">MAXE</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">],</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">adde</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span><span class="kt">int</span> <span class="n">c</span><span class="p">){</span>
	<span class="n">edges</span><span class="p">[</span><span class="o">++</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
	<span class="n">edges</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">n</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
	<span class="n">edges</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">;</span>
	<span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//从子树到本节点为白色路径或黑色路径的总数.
</span><span class="c1">//不包括自己.
</span><span class="c1"></span><span class="n">ll</span> <span class="n">white</span><span class="p">[</span><span class="n">MAXV</span><span class="p">],</span><span class="n">black</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">dfsCal</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ei</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">ei</span><span class="p">;</span><span class="n">ei</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">].</span><span class="n">n</span><span class="p">){</span>
		<span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
		<span class="n">dfsCal</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>

		<span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">;</span>
		<span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">white</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">black</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">,</span><span class="n">ll</span> <span class="n">w</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">){</span>
	<span class="c1">//子树到我
</span><span class="c1"></span>	<span class="n">ans</span><span class="o">+=</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">ans</span><span class="o">+=</span><span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
	<span class="c1">//子树到子树
</span><span class="c1"></span>	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ei</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">ei</span><span class="p">;</span><span class="n">ei</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">].</span><span class="n">n</span><span class="p">){</span>
		<span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
			<span class="n">ans</span><span class="o">+=</span><span class="p">(</span><span class="n">black</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">black</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
			<span class="n">ans</span><span class="o">+=</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span>

		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
			<span class="n">ans</span><span class="o">+=</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
		<span class="p">}</span>

		
	<span class="p">}</span>
	<span class="c1">//跨过我
</span><span class="c1"></span>	<span class="n">ans</span><span class="o">+=</span><span class="n">b</span><span class="o">*</span><span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
	<span class="n">ans</span><span class="o">+=</span><span class="n">w</span><span class="o">*</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>

	<span class="c1">//cout&lt;&lt;&#34;arrive at &#34;&lt;&lt;u&lt;&lt;&#34; and collect &#34;&lt;&lt;ans&lt;&lt;endl;
</span><span class="c1"></span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ei</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">ei</span><span class="p">;</span><span class="n">ei</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">].</span><span class="n">n</span><span class="p">){</span>
		<span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">];</span>
		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
			<span class="n">solve</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="o">+</span><span class="p">(</span><span class="n">black</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">black</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span><span class="k">else</span><span class="p">{</span>
			<span class="n">solve</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">w</span><span class="o">+</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">white</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">c</span><span class="p">;</span>
		<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">u</span><span class="o">&gt;&gt;</span><span class="n">v</span><span class="o">&gt;&gt;</span><span class="n">c</span><span class="p">;</span>
		<span class="n">adde</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
		<span class="n">adde</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">dfsCal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="c1">//cout&lt;&lt;white[i]&lt;&lt;&#34; &#34;&lt;&lt;black[i]&lt;&lt;endl;
</span><span class="c1"></span>	<span class="p">}</span>

	<span class="n">solve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>


	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">与Rust玩耍</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/have-fun-with-rust/" />
            <id>https://blog.kanari.moe/study/have-fun-with-rust/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-18T20:39:20+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p><img src="https://blog.kanari.moe/wp-content/uploads/2020/02/unsafe_badge-300x300.jpg" alt="">
把先前信息低的两篇blog给拆了,这样好点.</p>……]]></summary>
            
                <content type="html"><![CDATA[<p><img src="https://blog.kanari.moe/wp-content/uploads/2020/02/unsafe_badge-300x300.jpg" alt="">
把先前信息低的两篇blog给拆了,这样好点.</p>
<h2 id="一点小插曲-如何在windows上的rust使用gnu工具链">一点小插曲: 如何在windows上的rust使用gnu工具链</h2>
<p>众所周知windows对编程的体验不如*nix和osx,rust甚至在Windows上的配置都麻烦一点.比如说,为了装个rust,可能需要另外准备vs2019.这两个东西的空间占用差了不止一点半点.</p>
<p>折腾了一天.如果能仔细阅读官方的rustup文档的话,说不定就不用这么头秃了.</p>
<p>主要的选项在于选好host和version.在rustup执行安装时,修改为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">x86_64-pc-windows-gnu
stable-gnu
</code></pre></td></tr></table>
</div>
</div><p>这样安装的版本才会使用gnu工具链.但是如此做的后果,我还不太清楚.</p>
<h2 id="以c对撞rust">以C对撞Rust</h2>
<p>自己主要还是C系语言用户,所以实际学习时,总是会相比较着进行.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="kd">let</span><span class="w"> </span><span class="n">x</span>:<span class="kt">i32</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>首先,rust也使用分号.每个变量的声明开头使用let,并且将变量类型跟随名称后面.</p>
<p>随着时间发展,现代语言几乎都抛弃了变量类型在左侧的声明方式.这大概是一个实践上的经验.左侧的类型声明会在复杂状况下造成极大的理解障碍.比如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">signal</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)(</span><span class="kt">int</span><span class="p">)))(</span><span class="kt">int</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>阅读此类东西,总会是让人头疼.你会发现,为了理解它在干嘛,这种声明方式使得阅读顺序必须是顺时针的螺旋式,显得很不自然和明确.一旦调整类型到右侧时,这个问题似乎就不存在了.</p>
<p>所以不但变量的声明类型位于名称左侧,包括函数参数类型和返回值也都是位于右侧.</p>
<p>剩下的..</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">//rust中的变量**默认为不可更改**.必须添加`mut`关键字才作为一般意义上的变量考虑.
</span><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">y</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// this is not allowed.
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">//do something
</span><span class="c1"></span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">//do what
</span><span class="c1"></span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">//yeah?
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">//特殊的死循环
</span><span class="c1"></span><span class="k">loop</span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">while</span><span class="w"> </span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">//由于Rust的零代价抽象,迭代器的使用没有性能折扣.
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="c1">//这个是右闭区间
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">..</span><span class="o">=</span><span class="mi">9</span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">//所有控制流都是表达式,能够返回值;所以我们也没有三元运算符了.
</span><span class="c1">//对于循环,可以使用break.
</span><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="n">flag</span><span class="o">=</span><span class="k">if</span><span class="w"> </span><span class="n">a</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="c1">//最后一行不写引号,代表返回该值.没记错的话应该是从别的语言那借鉴的.
</span><span class="c1"></span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w">
</span><span class="w"></span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span>:<span class="kt">i32</span><span class="p">,</span><span class="n">b</span>:<span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="包管理">包管理</h2>
<p>rust发展太快了,各种文章各说各话.这里主要是一个<code>crate</code>(一个包)内的结构.</p>
<p>rust使用<code>mod</code>来明确的标注一个模块.关键字默认为私有,使用<code>pub</code>来标注一个对外公开的关键字.在2018标准,目录也会作为一个模块路径,文件名作为模块名,文件内关键字同样默认私有.在这种情况,使用<code>mod</code>关键字来显式的引入某个模块.对于第三方模块,2018不再需要显式标注引入<code>extern crate</code>.(但是仍然需要<code>use</code>)</p>
<p>在一个包里,允许有多个crate.如果硬要说,类似于vs studio里的解决方案和项目之间的关系.但是,rust还有一些不那么显然的限制</p>
<ul>
<li>最多有一个lib crate</li>
<li>可以有多个binary crate</li>
</ul>
<h2 id="一个最小的http服务器">一个最小(?)的HTTP服务器</h2>
<p>实现这个服务器的过程中,会遭遇到很多Rust内的问题.假设我们已经对比C++掌握其基本语法了.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">thread</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">mpsc</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">Arc</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">Mutex</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">ThreadPool</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">workers</span>:<span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Worker</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">sender</span>: <span class="nc">mpsc</span>::<span class="n">Sender</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">type</span> <span class="nc">Job</span><span class="o">=</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">()</span><span class="o">+</span><span class="nb">Send</span><span class="o">+</span><span class="nb">&#39;static</span><span class="o">&gt;</span><span class="p">;</span><span class="c1">//?
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Message</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">NewJob</span><span class="p">(</span><span class="n">Job</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">Terminate</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">ThreadPool</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Create thread pool
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// 
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// The number of threads in pool
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// 
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// # Paincs
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// 
</span><span class="sd"></span><span class="w">    </span><span class="sd">/// `new` will panic when size is not great than 0.
</span><span class="sd"></span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">size</span>:<span class="kt">usize</span><span class="p">)</span>-&gt;<span class="nc">ThreadPool</span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="n">receiver</span><span class="p">)</span><span class="o">=</span><span class="n">mpsc</span>::<span class="n">channel</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">receiver</span><span class="o">=</span><span class="n">Arc</span>::<span class="n">new</span><span class="p">(</span><span class="n">Mutex</span>::<span class="n">new</span><span class="p">(</span><span class="n">receiver</span><span class="p">));</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">workers</span><span class="o">=</span><span class="nb">Vec</span>::<span class="n">with_capacity</span><span class="p">(</span><span class="n">size</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="n">size</span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">workers</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Worker</span>::<span class="n">new</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">receiver</span><span class="p">.</span><span class="n">clone</span><span class="p">()));</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="n">ThreadPool</span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">workers</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">sender</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">execute</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span>:<span class="nc">F</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">F</span>:<span class="nb">FnOnce</span><span class="p">()</span><span class="o">+</span><span class="nb">Send</span><span class="o">+</span><span class="nb">&#39;static</span><span class="w">
</span><span class="w">    </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">job</span><span class="o">=</span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">Message</span>::<span class="n">NewJob</span><span class="p">(</span><span class="n">job</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ThreadPool</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">){</span><span class="w">
</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">workers</span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">Message</span>::<span class="n">Terminate</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">workers</span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;shutting down worker {}&#34;</span><span class="p">,</span><span class="n">worker</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span><span class="o">=</span><span class="n">worker</span><span class="p">.</span><span class="n">thread</span><span class="p">.</span><span class="n">take</span><span class="p">(){</span><span class="w">
</span><span class="w">                </span><span class="n">thread</span><span class="p">.</span><span class="n">join</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">            </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Worker</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">id</span>: <span class="kt">usize</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">thread</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">thread</span>::<span class="n">JoinHandle</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Worker</span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">id</span>:<span class="kt">usize</span><span class="p">,</span><span class="n">receiver</span>: <span class="nc">Arc</span><span class="o">&lt;</span><span class="n">Mutex</span><span class="o">&lt;</span><span class="n">mpsc</span>::<span class="n">Receiver</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span>-&gt;<span class="nc">Worker</span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">thread</span><span class="o">=</span><span class="n">thread</span>::<span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="k">loop</span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">message</span><span class="o">=</span><span class="n">receiver</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">recv</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">                </span><span class="k">match</span><span class="w"> </span><span class="n">message</span><span class="p">{</span><span class="w">
</span><span class="w">                    </span><span class="n">Message</span>::<span class="n">NewJob</span><span class="p">(</span><span class="n">job</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span><span class="w">
</span><span class="w">                        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Worker {} got job.&#34;</span><span class="p">,</span><span class="n">id</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w">                        </span><span class="n">job</span><span class="p">();</span><span class="w">
</span><span class="w">                    </span><span class="p">},</span><span class="w">
</span><span class="w">                    </span><span class="n">Message</span>::<span class="n">Terminate</span><span class="o">=&gt;</span><span class="p">{</span><span class="w">
</span><span class="w">                        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Worker {} is terminating.&#34;</span><span class="p">,</span><span class="n">id</span><span class="p">);</span><span class="w">
</span><span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w">
</span><span class="w">                    </span><span class="p">}</span><span class="w">
</span><span class="w">                </span><span class="p">}</span><span class="w">
</span><span class="w">                
</span><span class="w">            </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="p">});</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="n">Worker</span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">id</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">thread</span>: <span class="nb">Some</span><span class="p">(</span><span class="n">thread</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">net</span>::<span class="p">{</span><span class="n">TcpListener</span><span class="p">,</span><span class="n">TcpStream</span><span class="p">};</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">thread</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">automan</span>::<span class="n">ThreadPool</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">listener</span><span class="o">=</span><span class="n">TcpListener</span>::<span class="n">bind</span><span class="p">(</span><span class="s">&#34;127.0.0.1:7878&#34;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ThreadPool</span>::<span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">incoming</span><span class="p">(){</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="n">pool</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">handler</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="p">});</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">handler</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">stream</span>: <span class="nc">TcpStream</span><span class="p">){</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">512</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="n">stream</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">b&#34;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s">&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">b&#34;GET /sleep HTTP/1.1</span><span class="se">\r\n</span><span class="s">&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">status_line</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="n">get</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="s">&#34;HTTP/1.1 200 OK\r\n\r\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello.html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">thread</span>::<span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span>::<span class="n">from_secs</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="s">&#34;HTTP/1.1 200 OK\r\n\r\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello.html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="s">&#34;HTTP/1.1 404 NOT FOUND\r\n\r\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;404.html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">status_line</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">stream</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">stream</span><span class="p">.</span><span class="n">flush</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="fnonce">FnOnce</h2>
<p>在C++里,我们能够用Lambda表达式创建闭包,当需要保存一个闭包时,标准库提供了叫<code>function</code>的东西.在Rust里,我们也有闭包,而描述一个闭包类型的玩意,就是<code>Fn***</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">type</span> <span class="nc">Job</span><span class="o">=</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">()</span><span class="o">+</span><span class="nb">Send</span><span class="o">+&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="k">static</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>得益于rust的内存模型,诞生出这个奇葩玩意.反正还是和变量的所有权有关系.<code>FnOnce</code>的闭包会获取其捕获变量的所有权.另外<code>FnMut</code>的闭包获得其捕获变量的可变借用,<code>Fn</code>获得不可变借用.勉强可以对比C++里的<code>[],[&amp;]</code>.</p>
<p>至于到底什么闭包会实现哪一个,是由编译器根据实际情况判断的.想要强制将变量挪进闭包时,可以前缀<code>move</code>,就像<code>Worker</code>的<code>run</code>里的代码一样.因为当<code>run</code>执行完,receiver将会被丢弃,从而影响到闭包里的引用.</p>
<p>其他的几个<code>+</code>号和<code>Send</code>,<code>'static</code>什么的.<code>+</code>就是<code>+</code>,要求该类型必须同时实现这三种<code>trait</code>.Send是个<code>trait</code>(Types that can be transferred across thread boundaries).<code>'static</code>等时间周期实际上也是<code>trait</code>.</p>
<h2 id="box和dyn">Box和dyn</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">type</span> <span class="nc">Job</span><span class="o">=</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">()</span><span class="o">+</span><span class="nb">Send</span><span class="o">+&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="k">static</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>......没完..前面那个<code>dyn</code>玩意也是挺奇怪,需要和<code>impl</code>关键字对比理解.</p>
<p>Rust的一大特点就是零代价抽象.例如对于泛型,一种实现0抽象的方法就是在编译阶段单例化.C++也是如此处理.</p>
<p>不过有一种情况目测C++无法实现零抽象:在C++中,如果存在父类<code>A</code>有虚方法<code>f</code>,而子类<code>B</code>重写了<code>f</code>,又有一个函数<code>g(A a)</code>会调用<code>f</code>.当把<code>B</code>作为参数传给<code>g</code>时,C++通过一种叫<code>虚函数表</code>的方式实现调用<code>B</code>写的<code>f</code>.这种行为是发生在运行时的.</p>
<p>对于Rust来讲,虽然没有类与继承,这种操作实际等价于<code>trait</code>.上面的情况对等于存在<code>trait A</code>,它定义了一个<code>f</code>,<code>B</code>实现了<code>A</code>,<code>g</code>同上.Rust<strong>能够在编译阶段</strong>就确定传给<code>g</code>的是谁,并且优化掉它.不过这种优化也是有限度的.如果把一堆实现<code>A</code>的结构的指针存到数组或者其他内存结构里,那Rust也是无能为力的,只能在运行时动态分发.</p>
<p>再回来看<code>impl</code>和<code>dyn</code>.它们分别对应了能够优化(静态分发)和动态分发的情景.</p>
<p>另外,采用动态分发的结构也不能在编译时确定大小,所以必须外包<code>Box</code>.这一点还是有点特殊的,C++似乎并不会抱怨这个问题.</p>
<h2 id="arc和mutex">Arc和Mutex</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">id</span>:<span class="kt">usize</span><span class="p">,</span><span class="n">receiver</span>: <span class="nc">Arc</span><span class="o">&lt;</span><span class="n">Mutex</span><span class="o">&lt;</span><span class="n">mpsc</span>::<span class="n">Receiver</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span>-&gt;<span class="nc">Worker</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>说真的,看到<code>Worker</code>的这个函数签名,当时就像吐.Rust这玩意,动不动就会嵌套上好几层的<code>&lt;&gt;</code>.</p>
<p>首先关于<code>Arc</code>...先<code>Rc</code>.一般情况下,一个变量的所有权是可以在编译阶段就确定下来的.但是总会有不如意的时候,当有多个结构同时享有某个变量的所有权(例如一棵树),就不太好确定其实际的销毁时机,而且Rust也不会给你机会共享所有权.<code>Rc</code>是一个引用计数指针,变量所有权由它保管,而它能够提供多份只读借用.</p>
<p>然而<code>Rc</code>线程不安全,<code>Arc</code>线程安全.不过<code>Arc</code>性能弱于<code>Rc</code>.</p>
<p>其次是<code>Mutex</code>...就是个锁...</p>
<p>至于为啥用锁,先看<code>mpsc</code>,Multi-producer, single-consumer FIFO queue communication primitives.</p>
<p>一头雾水的缩写...简而言之,这个东西的设定类似于go里<code>channel</code>,同时是多生产者,<strong>单消费者</strong>模式.本身使用没什么绕的地方.绕的地方在于多线程共享和单消费者模式的冲突,所以引入了锁,保证同时只有一个线程能够消费消息.</p>
<p>顺便吐槽一句这代码写的...</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-rust" data-lang="rust"><span class="kd">let</span><span class="w"> </span><span class="n">message</span><span class="o">=</span><span class="n">receiver</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">recv</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>其实涉及到<code>Rc</code>时,还有另外一个外部可变,内部可变的麻烦事.这里没有提到.</p>
<h2 id="还有">还有</h2>
<p><code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>,<code>unwrap</code>...</p>
<p>当然它们本来会被替代成更复杂的错误处理.</p>
<h2 id="小结">小结</h2>
<p>用Rust写的程序,和自己脑袋斗智斗勇几回合,再和编译器斗智斗勇(单方面挨揍)几百回合,最后是真的难以出现bug,毕竟一切都被管的死死的.我还看到Rust里一个很有意思的玩意叫错误驱动,说是先把代码大概模样瞎糊上,然后让编译器check一遍,再一步步改掉编译器的报错<del>顺便写代码</del>,最后就能在编译器的吐槽下完美实现程序,再加点测试就齐全了...</p>
<p>虽然整个语法看起来复杂啰嗦,不过无法否认这些语句对于工程来讲实际上都是必要的.所以这玩意的气质决定它不太适合作为打比赛时用的语言.翻了翻CF好几场比赛,零星有几个Rust的代码也都没有涉及任何数据结构,本来还想瞻仰一下他们会怎么处理生命周期一类的问题.</p>
<p>如果有机会,拿Rust写课设应该可以玩一玩(大概会被强行用C系语言).至于原本想拿Rust写个本地评测器,还是算了,有空再说吧.</p>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Codeforces Round #612 (Div. 2)</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/codeforces-round-612-div-2/" />
            <id>https://blog.kanari.moe/code/codeforces-round-612-div-2/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-14T14:12:13+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[C 无脑DP.设状态$f(i,j,0/1)$表示已经设置了$i$位,用了$j$个偶数,……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="c">C</h2>
<p>无脑DP.设状态$f(i,j,0/1)$表示已经设置了$i$位,用了$j$个偶数,第$i$位是偶数/奇数.然后</p>
<p>$$
\begin{aligned}
f(i,j,0)&amp;=\min{f(i-1,j-1,0),f(i-1,j-1,1)+1} \<br>
f(i,j,1)&amp;=\min{f(i-1,j,0)+1,f(i-1,j,1)}
\end{aligned}
$$</p>
<p>以$i=1$作为开始,因为第1位不能算代价.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// missing?
</span></code></pre></td></tr></table>
</div>
</div><h2 id="d">D</h2>
<p>一个事实是,两棵子🌳的间大小关系不会影响其内部节点的既定关系.</p>
<p>以此,直接dfs,从底层向上构造相对大小顺序.合并时子树间的相对大小没有影响,所以直接前后接在一起就好,再把当前节点插到合适的位置使其满足c的条件.
全部完成后再对节点统一标号.</p>
<p>最开始先标了号,然后越写越麻烦,生气.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">2010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span><span class="n">MAXE</span><span class="o">=</span><span class="mi">4020</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
 
<span class="k">struct</span> <span class="nc">Edge</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span><span class="n">edges</span><span class="p">[</span><span class="n">MAXE</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">sz</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">adde</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">v</span><span class="p">){</span>
    <span class="n">edges</span><span class="p">[</span><span class="o">++</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
    <span class="n">edges</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">n</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">name</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">cur</span><span class="p">[</span><span class="n">MAXV</span><span class="p">][</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">dfs0</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ei</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">ei</span><span class="p">;</span><span class="n">ei</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">].</span><span class="n">n</span><span class="p">){</span>
        <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+=</span><span class="n">dfs0</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">name</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="n">tick</span><span class="p">;</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">tick</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">tick</span><span class="o">+=</span><span class="mi">2000</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">target</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">ok</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ei</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">ei</span><span class="p">;</span><span class="n">ei</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">].</span><span class="n">n</span><span class="p">){</span>
        <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">ei</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cur</span><span class="o">=</span><span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">it</span><span class="o">=</span><span class="n">cur</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">it</span><span class="o">!=</span><span class="n">cur</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="n">it</span><span class="o">++</span><span class="p">){</span>
            <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">&gt;</span><span class="n">res</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="n">ok</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="n">res</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="n">target</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">u</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">vlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">vlen</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">vlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">fa</span><span class="p">;</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">fa</span><span class="o">&gt;&gt;</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fa</span><span class="o">!=</span><span class="mi">0</span><span class="p">){</span>
            <span class="n">adde</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="n">root</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">res</span><span class="o">=</span><span class="n">dfs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ok</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;YES&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">res</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">name</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">vlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;NO&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CF1285D Dr.Evil Underscores</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf1285d-dr-evil-underscores/" />
            <id>https://blog.kanari.moe/code/cf1285d-dr-evil-underscores/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2020-01-13T17:27:25+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>Today, as a friendship gift, Bakry gave Badawy n integers a1,a2,…,an and challenged him to choose an integer X such that the value max1≤i≤n(ai⊕X) is minimum possible, where ⊕ denotes the bitwise XOR operation.</p>
<p>As always, Badawy is too lazy, so you decided to help him and find the minimum possible value of max1≤i≤n(ai⊕X).</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>Today, as a friendship gift, Bakry gave Badawy n integers a1,a2,…,an and challenged him to choose an integer X such that the value max1≤i≤n(ai⊕X) is minimum possible, where ⊕ denotes the bitwise XOR operation.</p>
<p>As always, Badawy is too lazy, so you decided to help him and find the minimum possible value of max1≤i≤n(ai⊕X).</p>
<h2 id="分析">分析</h2>
<p>将输入按照二进制位从高位开始建树,就能看出来,一旦确定了高位$i$填1还是0后,只会有一棵子树影响答案.另一棵子树的所有数字都因为$i$位上的异或结果为0而定小于另一个子树.</p>
<p>树不用真的建出来,这样就可以做了.</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;limits&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">LMAX</span><span class="o">=</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>
 
<span class="c1">//int nlen;
</span><span class="c1">//int num[MAXN];
</span><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">num</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">,</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vec</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">one</span><span class="p">,</span><span class="n">zero</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">i</span><span class="p">:</span><span class="n">vec</span><span class="p">){</span>
        <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">ptr</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">one</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">zero</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*
</span><span class="cm">    cout&lt;&lt;&#34;====vec====&#34;&lt;&lt;endl;
</span><span class="cm">    for(auto i:one)cout&lt;&lt;i&lt;&lt;&#34;,&#34;;
</span><span class="cm">    cout&lt;&lt;endl;
</span><span class="cm">    for(auto i:zero)cout&lt;&lt;i&lt;&lt;&#34;,&#34;;
</span><span class="cm">    cout&lt;&lt;endl;
</span><span class="cm">    cout&lt;&lt;&#34;===========&#34;&lt;&lt;endl;
</span><span class="cm">    */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">one</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">zero</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">zero</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">one</span><span class="p">);</span>
    <span class="c1">//cout&lt;&lt;&#34;add&#34;&lt;&lt;(1&lt;&lt;ptr)&lt;&lt;endl;
</span><span class="c1"></span> 
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ptr</span><span class="p">)</span><span class="o">+</span><span class="n">min</span><span class="p">(</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">zero</span><span class="p">),</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">one</span><span class="p">));</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
 
    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">;</span>
        <span class="n">num</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">dfs</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="n">num</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">康康新教务</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/look-new-jw/" />
            <id>https://blog.kanari.moe/gossip/look-new-jw/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-12-27T09:08:05+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>学校换教务了?突如其来的惊喜,结果第一天教务出了个锅.</p>
<p>扒扒代码看看开发这个教务的公司水平,彻底失望.</p>
<p>这个教务系统的问题远不止时区,最大的问题是它表面上相比先前的系统...似乎...没啥...长进?</p>
<h2 id="首页">首页</h2>
<h3 id="编码方式">编码方式</h3>
<p>首先,来看这教务如何处理登录信息.</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>学校换教务了?突如其来的惊喜,结果第一天教务出了个锅.</p>
<p>扒扒代码看看开发这个教务的公司水平,彻底失望.</p>
<p>这个教务系统的问题远不止时区,最大的问题是它表面上相比先前的系统...似乎...没啥...长进?</p>
<h2 id="首页">首页</h2>
<h3 id="编码方式">编码方式</h3>
<p>首先,来看这教务如何处理登录信息.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">submitForm1</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xh</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;userAccount&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">pwd</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;userPassword&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xh</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;用户名不能为空！&#34;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pwd</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;密码不能为空！&#34;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">encodeInp</span><span class="p">(</span><span class="nx">xh</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">passwd</span> <span class="o">=</span> <span class="nx">encodeInp</span><span class="p">(</span><span class="nx">pwd</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="nx">account</span> <span class="o">+</span> <span class="s2">&#34;%%%&#34;</span> <span class="o">+</span> <span class="nx">passwd</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;encoded&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">encoded</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">jzmmid</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;Form1&#34;</span><span class="p">).</span><span class="nx">jzmmid</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;userPassword&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码用了一种非常规的登录方式.将账号和密码编码后用<code>%%%</code>连接,作为真正的登录请求发到服务器</p>
<p>%%%(???)来看看这<code>encodeInp</code>是啥玩意.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">eval</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">k</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">a</span><span class="o">?</span><span class="s2">&#34;&#34;</span><span class="o">:</span><span class="nx">e</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="o">/</span><span class="nx">a</span><span class="p">)))</span><span class="o">+</span><span class="p">((</span><span class="nx">c</span><span class="o">=</span><span class="nx">c</span><span class="o">%</span><span class="nx">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">35</span><span class="o">?</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">c</span><span class="o">+</span><span class="mi">29</span><span class="p">)</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">))};</span><span class="k">if</span><span class="p">(</span><span class="o">!&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/</span><span class="p">,</span><span class="nb">String</span><span class="p">)){</span><span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">--</span><span class="p">)</span><span class="nx">d</span><span class="p">[</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">)]</span><span class="o">=</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span><span class="o">||</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="nx">k</span><span class="o">=</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="p">[</span><span class="nx">e</span><span class="p">]}];</span><span class="nx">e</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="err">\\</span><span class="nx">w</span><span class="o">+&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;};</span><span class="nx">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span><span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">--</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span><span class="nx">p</span><span class="o">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="err">\\</span><span class="nx">b</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="o">+</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="o">+&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="err">\\</span><span class="nx">b</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;,</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="nx">g</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;),</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">]);</span><span class="k">return</span> <span class="nx">p</span><span class="p">;}(</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="nx">b</span> <span class="mi">9</span><span class="o">=</span><span class="s2">&#34;o+/=&#34;</span><span class="p">;</span><span class="nx">p</span> <span class="nx">q</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">b</span> <span class="nx">e</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span><span class="nx">b</span> <span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span><span class="nx">b</span> <span class="nx">f</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="mi">1</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span><span class="nx">b</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">m</span><span class="p">{</span><span class="mi">8</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span><span class="mi">5</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span><span class="mi">7</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span><span class="nx">f</span><span class="o">=</span><span class="mi">8</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="p">((</span><span class="mi">8</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">5</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span><span class="nx">c</span><span class="o">=</span><span class="p">((</span><span class="mi">5</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">7</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">);</span><span class="mi">1</span><span class="o">=</span><span class="mi">7</span><span class="o">&amp;</span><span class="nx">t</span><span class="p">;</span><span class="nx">k</span><span class="p">(</span><span class="nx">j</span><span class="p">(</span><span class="mi">5</span><span class="p">)){</span><span class="nx">c</span><span class="o">=</span><span class="mi">1</span><span class="o">=</span><span class="nx">l</span><span class="p">}</span><span class="nx">v</span> <span class="nx">k</span><span class="p">(</span><span class="nx">j</span><span class="p">(</span><span class="mi">7</span><span class="p">)){</span><span class="mi">1</span><span class="o">=</span><span class="nx">l</span><span class="p">}</span><span class="nx">e</span><span class="o">=</span><span class="nx">e</span><span class="o">+</span><span class="mf">9.</span><span class="nx">d</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="o">+</span><span class="mf">9.</span><span class="nx">d</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="mf">9.</span><span class="nx">d</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="o">+</span><span class="mf">9.</span><span class="nx">d</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="mi">8</span><span class="o">=</span><span class="mi">5</span><span class="o">=</span><span class="mi">7</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span><span class="nx">f</span><span class="o">=</span><span class="nx">g</span><span class="o">=</span><span class="nx">c</span><span class="o">=</span><span class="mi">1</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">}</span><span class="nx">u</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">n</span><span class="p">);</span><span class="nx">r</span> <span class="nx">e</span><span class="p">}</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;,</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="o">|</span><span class="nx">enc4</span><span class="o">||||</span><span class="nx">chr2</span><span class="o">||</span><span class="nx">chr3</span><span class="o">|</span><span class="nx">chr1</span><span class="o">|</span><span class="nx">keyStr</span><span class="o">|</span><span class="nx">input</span><span class="o">|</span><span class="kd">var</span><span class="o">|</span><span class="nx">enc3</span><span class="o">|</span><span class="nx">charAt</span><span class="o">|</span><span class="nx">output</span><span class="o">|</span><span class="nx">enc1</span><span class="o">|</span><span class="nx">enc2</span><span class="o">|</span><span class="nx">charCodeAt</span><span class="o">||</span><span class="nb">isNaN</span><span class="o">|</span><span class="k">if</span><span class="o">|</span><span class="mi">64</span><span class="o">|</span><span class="k">do</span><span class="o">|</span><span class="nx">length</span><span class="o">|</span><span class="nx">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span class="o">|</span><span class="kd">function</span><span class="o">|</span><span class="nx">encodeInp</span><span class="o">|</span><span class="k">return</span><span class="o">|</span><span class="mi">15</span><span class="o">|</span><span class="mi">63</span><span class="o">|</span><span class="k">while</span><span class="o">|</span><span class="k">else</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;.</span><span class="nx">split</span><span class="p">(</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;</span><span class="o">|&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;),</span><span class="mi">0</span><span class="p">,{}))</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码是混淆过的base64算法.<strong>这公司开发的教务系统的登录信息居然用可逆编码,脑子呢?</strong></p>
<h3 id="前端负载平衡">前端负载平衡</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">selectServer</span><span class="p">(</span><span class="nx">uName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">enableServers</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span><span class="c1">//是否启用多服务器 true/false
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">serversArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span><span class="c1">//服务器列表
</span><span class="c1"></span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].10:8080/jsxsd1/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].11:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].12:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].13:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].14:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].15:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].16:8080/jsxsd/&#34;</span><span class="p">;</span>

    <span class="nx">serversArray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;http://[DELETED].17:8080/jsxsd/&#34;</span><span class="p">;</span>


    <span class="kd">var</span> <span class="nx">loginUrl</span> <span class="o">=</span> <span class="s2">&#34;xk/LoginToXk&#34;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">enableServers</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[^\d]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">uName</span><span class="p">))</span> <span class="p">{</span><span class="c1">//必须为数字
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">modVal</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">uName</span> <span class="o">%</span> <span class="nx">serversArray</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="nx">loginUrl</span> <span class="o">=</span> <span class="nx">serversArray</span><span class="p">[</span><span class="nx">modVal</span><span class="p">]</span> <span class="o">+</span> <span class="nx">loginUrl</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">loginUrl</span> <span class="o">=</span> <span class="nx">serversArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">loginUrl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">loginUrl</span> <span class="o">=</span> <span class="s2">&#34;/jsxsd&#34;</span> <span class="o">+</span> <span class="nx">loginUrl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">loginUrl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>教务在前端作负载平衡</strong></p>
<p>这段代码是完全面向需求编写的.</p>
<ol>
<li>需要负载只在选课时,学生学号分布均匀.</li>
<li>大家都是正常使用系统,不会有人来搞我.</li>
</ol>
<p>如果有任何一条不满足,就白瞎了.</p>
<p>不过这个<code>else</code>是什么?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[^\d]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">uName</span><span class="p">))</span> <span class="p">{</span><span class="c1">//必须为数字
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">modVal</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">uName</span> <span class="o">%</span> <span class="nx">serversArray</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="nx">loginUrl</span> <span class="o">=</span> <span class="nx">serversArray</span><span class="p">[</span><span class="nx">modVal</span><span class="p">]</span> <span class="o">+</span> <span class="nx">loginUrl</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">loginUrl</span> <span class="o">=</span> <span class="nx">serversArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">loginUrl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="后台首页">后台首页</h2>
<p>后台是一个框架嵌套的模式.另外新教务网页元素的长宽是写死的.</p>
<h3 id="大量拼写错误">大量拼写错误</h3>
<p>{% asset_img loadkb.png 课表请求 %}</p>
<p>教务的中英文混血命名法<code>加载课表</code>.</p>
<p>{% asset_img panle.png 拼写错误 %}</p>
<p>看来该公司确实适合用拼音,这个拼写错误出现了无数次.</p>
<h3 id="后台密码加密">后台密码加密</h3>
<p>好吧,我承认,当我打开登录后的首页后,我确实看到了这家公司的努力.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">opengld</span><span class="p">(){</span>
    <span class="c1">//...
</span><span class="c1"></span>	<span class="c1">//取得userid
</span><span class="c1"></span>	<span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;[</span><span class="nx">DELETED</span><span class="p">]</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;;</span>
	<span class="kd">var</span> <span class="nx">userpsw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;[</span><span class="nx">DELETED</span><span class="p">]</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">039</span><span class="p">;;</span>
	<span class="c1">//取得userid
</span><span class="c1"></span>	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;ticket&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">userid</span><span class="o">+</span><span class="s2">&#34;#&#34;</span><span class="o">+</span><span class="nx">userpsw</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>后端使用的加密方式为<strong>没有任何加盐的MD5摘要</strong>.</p>
<p><strong>这个是极其幼稚且严重的安全隐患</strong>.</p>
<p>另外,还能看出来这套系统在开发时没有任何约定,随性写.前面登录用<code>%%%</code>,这里用<code>#</code>.</p>
<h3 id="数据提交方式">数据提交方式</h3>
<p>整个后台提交数据的方式,全是隐藏表单+js赋值提交.</p>
<h2 id="响应数据">响应数据</h2>
<h3 id="时间">时间</h3>
<p>其HTTP服务仍然是完美的格林尼治时间,到文章发布时也没改.我不知道改下时间对于该公司运维来说难度有多大.</p>
<h3 id="cookie">Cookie</h3>
<p>可以发现Cookie同样是MD5加密了什么玩意东西.</p>
<blockquote>
<p>未完待续</p>
</blockquote>
<h2 id="新教务-旧思维">新教务 旧思维</h2>
<p>结论,<strong>这不该是一个现代教务该有的水平</strong>,从头到尾都透漏着不专业的表现,随便抓几个本科生多学点html和jquery和java的水平.连css和英语都不用学,毕竟这css和命名写的都是什么垃圾.</p>
<p>无法完全接触到后端,因此不知道后端的技术架构如何,不过看前端都写不好,大可猜测后端架构也不会怎样.单凭前端都是无论如何都是说不过去的.首先是硬伤:</p>
<ul>
<li><strong>安全意识淡薄</strong>.这是最严重的问题.前端base64,后端md5连盐都不加,等撞库?</li>
</ul>
<p>其他的诸如开发人员英语都没学好、命名拼音英语混合一把梭，前后端交互数据格式胡乱拼接一把梭，无移动端适配，运行维护人员不太靠谱之类的，如果说停留在系统能用就好的层面上，也不是不能接受。</p>
<p>其次是构建方式完全是互联网刚刚兴起时的方法。html拼接，代码vanilla一把梭，硬编码，和那个哭笑不得的负载平衡……就好像活在上个世纪。</p>
<p>整套系统来看,也许最大的升级是多了好几台明面上的&quot;服务器&quot;。</p>
<p>在实际选课时,新教务仍然无法承受压力,不过这有可能是带宽的锅。</p>
<p>如果今后发现好玩的玩意,我还会继续补充.</p>
<h2 id="一点好玩的">一点好玩的</h2>
<p>不用&quot;怀疑&quot;了,这个公司风评不错啊看来.</p>
<p><a href="https://www.zhihu.com/question/294293977">来看看知乎上的评价</a></p>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">8年了，春物终于迎来了结局</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/eight-years-for-chunwu/" />
            <id>https://blog.kanari.moe/gossip/eight-years-for-chunwu/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-11-19T10:45:45+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[我觉得这件需要发一篇来庆祝一下。虽然从头到尾我就没怀疑过最终会是雪乃，（雪乃!）但是……]]></summary>
            
                <content type="html"><![CDATA[<p>我觉得这件需要发一篇来庆祝一下。虽然从头到尾我就没怀疑过最终会是雪乃，（雪乃!）但是结局一出，还是非常欣慰。</p>
<p>真好啊.jpg。</p>
<p>是时候再买一套来收藏了。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">数位DP</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/digital-dp/" />
            <id>https://blog.kanari.moe/study/digital-dp/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-11-06T19:46:23+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<h2 id="例题-4-hdu2089-不要62">例题-4 HDU2089 不要62</h2>
<p>统计数位中没有出现4和62的数字个数。</p>
<h3 id="分析">分析</h3>
<p>不要4，可以在4时直接不转移。对于62，可以维护一个上一个数字填了啥，就可以像4一样判断了。</p>……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="例题-4-hdu2089-不要62">例题-4 HDU2089 不要62</h2>
<p>统计数位中没有出现4和62的数字个数。</p>
<h3 id="分析">分析</h3>
<p>不要4，可以在4时直接不转移。对于62，可以维护一个上一个数字填了啥，就可以像4一样判断了。</p>
<h3 id="代码">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">cache</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">digits</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">last</span><span class="p">,</span><span class="kt">int</span> <span class="n">lim</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">])</span><span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">maxd</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span><span class="n">maxd</span><span class="o">=</span><span class="n">digits</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxd</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="o">==</span><span class="mi">62</span> <span class="o">||</span> <span class="n">i</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">res</span><span class="o">+=</span><span class="n">solve</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxd</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">SOLVE</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
        <span class="n">digits</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
        <span class="n">x</span><span class="o">/=</span><span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">solve</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ll</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">cache</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">SOLVE</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="n">SOLVE</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题-3-hdu3555">例题-3 HDU3555</h2>
<p>统计所有出现过49的数字的个数。</p>
<h3 id="分析-1">分析</h3>
<p>统计所有没出现过49的数字，就和上一道一样了。</p>
<h3 id="代码-1">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">50</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">digits</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">last</span><span class="p">,</span><span class="kt">int</span> <span class="n">lim</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">])</span><span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">maxd</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span><span class="n">maxd</span><span class="o">=</span><span class="n">digits</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxd</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="o">==</span><span class="mi">49</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">res</span><span class="o">+=</span><span class="n">solve</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxd</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">last</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">SOLVE</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
        <span class="n">digits</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
        <span class="n">x</span><span class="o">/=</span><span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">solve</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="n">ll</span> <span class="n">r</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">r</span><span class="o">-</span><span class="n">SOLVE</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题-2-poj3252">例题-2 POJ3252</h2>
<p>The cows, as you know, have no fingers or thumbs and thus are unable to play Scissors, Paper, Stone� (also known as �Rock, Paper, Scissors�, �Ro, Sham, Bo�, and a host of other names) in order to make arbitrary decisions such as who gets to be milked first. They can�t even flip a coin because it�s so hard to toss using hooves.</p>
<p>They have thus resorted to &quot;round number&quot; matching. The first cow picks an integer less than two billion. The second cow does the same. If the numbers are both &quot;round numbers&quot;, the first cow wins,
otherwise the second cow wins.</p>
<p>A positive integer N is said to be a &quot;round number&quot; if the binary representation of N has as many or more zeroes than it has ones. For example, the integer 9, when written in binary form, is 1001. 1001 has two zeroes and two ones; thus, 9 is a round number. The integer 26 is 11010 in binary; since it has two zeroes and three ones, it is not a round number.</p>
<p>Obviously, it takes cows a while to convert numbers to binary, so the winner takes a while to determine. Bessie wants to cheat and thinks she can do that if she knows how many &quot;round numbers&quot; are in a given range.</p>
<p>Help her by writing a program that tells how many round numbers appear in the inclusive range given by the input (1 ≤ Start &lt; Finish ≤ 2,000,000,000).</p>
<h3 id="分析-2">分析</h3>
<p>这道题目将上界拆解为二进制数位。</p>
<h3 id="代码-2">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">50</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">digits</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">one</span><span class="p">,</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lim</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
        <span class="c1">//cout&lt;&lt;first&lt;&lt;&#34; &#34;&lt;&lt;one&lt;&lt;endl;
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">first</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">first</span><span class="o">-</span><span class="n">one</span><span class="o">&gt;=</span><span class="n">one</span><span class="p">)</span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">one</span><span class="p">][</span><span class="n">first</span><span class="p">])</span><span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">one</span><span class="p">][</span><span class="n">first</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">maxd</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span><span class="n">maxd</span><span class="o">=</span><span class="n">digits</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxd</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">res</span><span class="o">+=</span><span class="n">solve</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">one</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">),(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">first</span><span class="o">?</span> <span class="nl">pos</span> <span class="p">:</span> <span class="n">first</span><span class="p">),</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxd</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">one</span><span class="p">][</span><span class="n">first</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">SOLVE</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
        <span class="n">digits</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">x</span><span class="o">/=</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">solve</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
    <span class="n">ll</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">SOLVE</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="n">SOLVE</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题-1-hdu3652">例题-1 HDU3652</h2>
<p>A wqb-number, or B-number for short, is a non-negative integer whose decimal form contains the sub- string &quot;13&quot; and can be divided by 13. For example, 130 and 2613 are wqb-numbers, but 143 and 2639 are not. Your task is to calculate how many wqb-numbers from 1 to n for a given integer n.</p>
<h3 id="分析-3">分析</h3>
<p>维护额外2个状态，一个状态记录模13的余数，另一个进行编码：1为上一位为1，3为已经出现过13，0为其他。之后将转移条件描述清楚就可以了。</p>
<h3 id="代码-3">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="mi">20</span><span class="p">];</span>
<span class="n">ll</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">last</span><span class="p">,</span><span class="kt">int</span> <span class="n">mod</span><span class="p">,</span><span class="kt">bool</span> <span class="n">lim</span><span class="p">){</span>
	<span class="c1">//cout&lt;&lt;&#34;arrive&#34;&lt;&lt;ptr&lt;&lt;&#34; &#34;&lt;&lt;last&lt;&lt;&#34; &#34;&lt;&lt;mod&lt;&lt;&#34; &#34;&lt;&lt;lim&lt;&lt;endl;
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="o">==</span><span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">mod</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">last</span><span class="p">][</span><span class="n">mod</span><span class="p">])</span><span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">last</span><span class="p">][</span><span class="n">mod</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">maxx</span><span class="o">=</span><span class="n">lim</span><span class="o">?</span><span class="n">num</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxx</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="n">res</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,(</span><span class="n">mod</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="o">==</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="n">res</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,(</span><span class="n">mod</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="n">mod</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span><span class="n">lim</span><span class="o">&amp;&amp;</span><span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">);</span>
		<span class="k">else</span> <span class="n">res</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">mod</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span><span class="n">lim</span><span class="o">&amp;&amp;</span><span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">last</span><span class="p">][</span><span class="n">mod</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="n">ll</span> <span class="n">r</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="p">){</span>
		<span class="n">num</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
		<span class="n">r</span><span class="o">/=</span><span class="mi">10</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
	<span class="n">ll</span> <span class="n">r</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">){</span>
		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">solve</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题0-hdu3709">例题0 HDU3709</h2>
<p>A balanced number is a non-negative integer that can be balanced if a pivot is placed at some digit. More specifically, imagine each digit as a box with weight indicated by the digit. When a pivot is placed at some digit of the number, the distance from a digit to the pivot is the offset between it and the pivot. Then the torques of left part and right part can be calculated. It is balanced if they are the same. A balanced number must be balanced with the pivot at some of its digits. For example, 4139 is a balanced number with pivot fixed at 3. The torqueses are 4<em>2 + 1</em>1 = 9 and 9*1 = 9, for left part and right part, respectively. It�s your job to calculate the number of balanced numbers in a given range [x, y].</p>
<h3 id="分析-4">分析</h3>
<p>这题有点麻烦……</p>
<p>将杠杆在哪与题目分离出来，枚举杠杆定在何处。再维护是否平衡。平衡与否还是挺好考虑的，以杠杆为0，左右各赋值正与负的权值，当到达边接后全杆重量为0时即为平衡。</p>
<blockquote>
<p>有一个小坑，就是0。如果这个数字全tm填0的时候，不管杠杆定在哪，它都平衡……你当然可以维护一个前导零标志，将所有0都去掉最后再加上。还有一种办法就是最后再将重复的0减去，相比起来更加简单。</p>
</blockquote>
<h3 id="代码-4">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="mi">20</span><span class="p">][</span><span class="mi">2010</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">,</span><span class="kt">bool</span> <span class="n">lim</span><span class="p">,</span><span class="kt">int</span> <span class="n">piv</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="n">l</span><span class="o">==</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">piv</span><span class="p">][</span><span class="n">l</span><span class="p">])</span><span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">piv</span><span class="p">][</span><span class="n">l</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">maxx</span><span class="o">=</span><span class="n">lim</span><span class="o">?</span><span class="n">num</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>

	<span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxx</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">res</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">,</span><span class="n">piv</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="n">piv</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">piv</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="n">ll</span> <span class="n">r</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="p">){</span>
		<span class="n">num</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
		<span class="n">r</span><span class="o">/=</span><span class="mi">10</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">ptr</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">ans</span><span class="o">+=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="o">-</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">;</span>
		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">solve</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">l</span><span class="o">?-</span><span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题1-cf55d">例题1 CF55D</h2>
<p>Volodya is an odd boy and his taste is strange as well. It seems to him that a positive integer number is beautiful if and only if it is divisible by each of its nonzero digits. We will not argue with this and just count the quantity of beautiful numbers in given ranges.</p>
<h3 id="分析-5">分析</h3>
<p>维护数字对0-9每个数字的模，但是这样还需要维护某些数字是否出现，继续考虑。当数字能同时被$a$和$b$整除，等价为其能够被它俩的最小公倍数整除。</p>
<p>那么我们的问题可以稍微简化一下了。维护已经填写的数位的最小公倍数，并维护数字和。到达边界时，只有满足条件才计数。</p>
<blockquote>
<p>这道题还有一点麻烦，就是内存它不够用。按照分析，至少需要开$2520\times 2520$，还要再加上个数位长度。内存就炸了。实际上，最小公倍数仅有了了几个，可以事先求出并先编码，就能降低一维状态。</p>
</blockquote>
<h3 id="代码-5">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">2620</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_LCM</span> <span class="o">=</span> <span class="mi">2520</span><span class="p">;</span>
<span class="c1">//pos位数余rest模·10·的方案
</span><span class="c1"></span><span class="n">ll</span> <span class="n">cache</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">50</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">digits</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">lcmref</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="n">b</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">lcm</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">init_lcm</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">lcm</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lcmref</span><span class="p">[</span><span class="n">temp</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="c1">//cout &lt;&lt; temp &lt;&lt; endl;
</span><span class="c1"></span>            <span class="n">lcmref</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rest</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">lim</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rest</span> <span class="o">%</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">rest</span><span class="p">][</span><span class="n">lcmref</span><span class="p">[</span><span class="n">l</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">rest</span><span class="p">][</span><span class="n">lcmref</span><span class="p">[</span><span class="n">l</span><span class="p">]];</span>

    <span class="n">ll</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">maxd</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lim</span><span class="p">)</span>
        <span class="n">maxd</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">maxd</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">solve</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">rest</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">MAX_LCM</span><span class="p">,</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">l</span> <span class="p">:</span> <span class="n">lcm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">maxd</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">rest</span><span class="p">][</span><span class="n">lcmref</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">SOLVE</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">digits</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">solve</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">init_lcm</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">kase</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cache</span><span class="p">));</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">l</span> <span class="o">&gt;&gt;</span> <span class="n">r</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">SOLVE</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">SOLVE</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="例题2">例题2</h2>
<p>求$[l,r]$区间内的所有满足以下要求的数的平方和。</p>
<ol>
<li>数位上没有$7$</li>
<li>不是$7$的倍数</li>
<li>数位和不是$7$的倍数</li>
</ol>
<p>区间为$10^{18}$级别，请对答案取模$10^{9}+7$。</p>
<h3 id="分析-6">分析</h3>
<p>这题挺狠的……首先看如何判断上面的3个条件。</p>
<ul>
<li>数位上没有$7$，可以直接在枚举填数时跳过$7$。</li>
<li>非 * 的倍数，可以维护已填数字的取模。取模为$0$则为倍数。</li>
<li>数位和，仍然可以直接维护。</li>
</ul>
<p>这样就可以正确的判断某个数是不是满足条件。接下来是平方和。</p>
<p>当以数位来考虑平方和时，问题就稍微变得复杂了。假设我们已经知道了下一个状态的平方和为$x_n$，如何得到当前位$x$的平方和。</p>
<p>假设当前位$ptr$填了$i$。其数位所表达的意义是$10^{p}i$，那么以该位与下一状态的平方和，需要下一状态的<strong>和</strong>，定为$s_n$。可以得到</p>
<p>$$
(10^p i+s_n)^2=10^{2p}i^2+2 \cdot 10^pis_n+s_n^2
$$</p>
<p>另外，当前位的出现次数在实际计算时需要考虑进去。那么，还需要维护下一状态的<strong>个数</strong>，记$cnt$。那么，上式需要修改</p>
<p>$$
10^{2p}i^2 \cdot cnt_n+2 \cdot 10^pis_n+s_n^2
$$</p>
<p>后两项不乘以$cnt$是因为它们本身就已经是包括了下一状态的所有计数。这样，我们就得到了以数位为角度的平方和维护办法。</p>
<h3 id="代码-6">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">22</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">MOD</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Status</span><span class="p">{</span>
	<span class="n">ll</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">sum</span><span class="p">,</span><span class="n">sqsum</span><span class="p">;</span>
	<span class="n">Status</span><span class="p">(</span><span class="n">ll</span> <span class="n">cnt</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">ll</span> <span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ll</span> <span class="n">sqsum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="n">cnt</span><span class="p">(</span><span class="n">cnt</span><span class="p">),</span><span class="n">sum</span><span class="p">(</span><span class="n">sum</span><span class="p">),</span><span class="n">sqsum</span><span class="p">(</span><span class="n">sqsum</span><span class="p">){}</span>
<span class="p">}</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">9</span><span class="o">*</span><span class="mi">20</span><span class="p">][</span><span class="mi">10</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">){</span>
	<span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">MOD</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Status</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">sum</span><span class="p">,</span><span class="kt">int</span> <span class="n">mod</span><span class="p">,</span><span class="kt">bool</span> <span class="n">lim</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">){</span>
		<span class="k">return</span> <span class="n">Status</span><span class="p">(</span><span class="n">sum</span><span class="o">%</span><span class="mi">7</span><span class="o">!=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">mod</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">sum</span><span class="p">][</span><span class="n">mod</span><span class="p">].</span><span class="n">cnt</span><span class="p">)</span><span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">sum</span><span class="p">][</span><span class="n">mod</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">maxx</span><span class="o">=</span><span class="n">lim</span><span class="o">?</span><span class="n">num</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
	<span class="n">Status</span> <span class="n">res</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">maxx</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
		<span class="n">Status</span> <span class="n">nex</span><span class="o">=</span><span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sum</span><span class="o">+</span><span class="n">i</span><span class="p">,(</span><span class="n">mod</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">7</span><span class="p">,</span><span class="n">lim</span><span class="o">&amp;&amp;</span><span class="n">i</span><span class="o">==</span><span class="n">maxx</span><span class="p">);</span>
		<span class="n">res</span><span class="p">.</span><span class="n">cnt</span><span class="o">+=</span><span class="n">nex</span><span class="p">.</span><span class="n">cnt</span><span class="p">;</span>
		<span class="n">res</span><span class="p">.</span><span class="n">cnt</span><span class="o">%=</span><span class="n">MOD</span><span class="p">;</span>
		<span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="n">qpow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">nex</span><span class="p">.</span><span class="n">cnt</span><span class="o">%</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
		<span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="o">+</span><span class="n">nex</span><span class="p">.</span><span class="n">sum</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
		<span class="n">res</span><span class="p">.</span><span class="n">sqsum</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">sqsum</span><span class="o">+</span><span class="n">nex</span><span class="p">.</span><span class="n">cnt</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
		<span class="n">res</span><span class="p">.</span><span class="n">sqsum</span><span class="o">=</span><span class="p">((</span><span class="n">res</span><span class="p">.</span><span class="n">sqsum</span><span class="o">+</span><span class="n">nex</span><span class="p">.</span><span class="n">sqsum</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">MOD</span><span class="o">*</span><span class="n">nex</span><span class="p">.</span><span class="n">sum</span><span class="o">%</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lim</span><span class="p">)</span><span class="n">f</span><span class="p">[</span><span class="n">ptr</span><span class="p">][</span><span class="n">sum</span><span class="p">][</span><span class="n">mod</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">ll</span> <span class="nf">solve</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="p">){</span>
		<span class="n">num</span><span class="p">[</span><span class="o">++</span><span class="n">ptr</span><span class="p">]</span><span class="o">=</span><span class="n">n</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
		<span class="n">n</span><span class="o">/=</span><span class="mi">10</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="n">sqsum</span><span class="o">%</span><span class="n">MOD</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="n">r</span><span class="p">;</span>
		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="p">((</span><span class="n">solve</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">?</span><span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="mi">0</span><span class="p">))</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="数位dp">数位DP</h2>
<p>上面这道题目大概算是暴露了数位DP中需要考虑的事情。数位DP能够主要能够统计某2个数字区间内满足某些条件的数字的信息，比如个数、和、平方和……</p>
<p>首先数位DP不是单独考虑每一个数字，而是以数位为单位的考虑。这样在考虑条件满足和各类信息的维护时，就需要转一转。</p>
<p>先来看记忆化搜索。比较直观（</p>
<h3 id="计数基础">计数基础</h3>
<p>初始化的值从何而来。当数位DP到达了边界，就是要考虑初始化的位置。一般为满足条件置$1$。</p>
<h3 id="满足条件">满足条件</h3>
<p>这是我们需要考虑的状态。例如上面提到的。</p>
<ul>
<li>数位没有某数：直接不转移。</li>
<li>数位和：直接维护一维数位和。</li>
<li>倍数关系：以递推方式维护取模。</li>
<li>数字出现次数：使用状压来对次数编码。例如，对每一种数字维护空间为3的状态（0，奇数，偶数）。</li>
</ul>
<p>其实还可能有很多，主要考虑的问题是该状态经过编码后能不能保存下来，两个状态之间能不能递推过去。</p>
<h3 id="计数">计数</h3>
<p>必须考虑$n-1$到$n$<strong>位</strong>之间的转移关系。首先一定会维护满足性质的数字个数，之后每一个位的计算都需要考虑下一状态的个数。</p>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Liaoning Ship’s Voyage</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/liaoning-ships-voyage/" />
            <id>https://blog.kanari.moe/code/liaoning-ships-voyage/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-27T14:13:44+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>Liaoning ship, which named after a province of China, is the first aircraft carrier commissioned into the People's Liberation Army Navy. It was bought from Ukraine as a stripped hulk and was rebuilt by China as an important part of China’s blue water Navy plan. Liaoning ship has sailed far into the Pacific Ocean for serval times, which shows the power and resolve of China to defend her integrity of territory.</p>
<p>Now Liaoning ship is on a new voyage to the Atlantic Ocean for a maneuver! The vast maneuver region on the ocean can be seen as an n×n grid which has n×n crosspoints. Each crosspoint stands for a check point of the maneuver region. Liaoning starts from the bottom-left check point whose coordinate is (0,0), and its destination is the upper-right checkpoint whose coordinate is (n-1,n-1). The positive side of the x axis points to the right, and the positive side of the y axis points up. All check points’ coordinates are integral. During each move, Liaoning can go from one check point to its adjacent 8 check points along a straight line, and each move takes Liaoning one day. Some check points are not available to go due to the bad weather. And, as you know, on the Atlantic Ocean, there is a Bermuda Triangle in which many ships and planes were missing. Liaoning can’t take risk to go into that triangle. Of course, Liaoning can’t go outside the maneuver region. Please figure out a route for Liaoning to reach its destination as soon as possible.</p>
<h2 id="分析">分析</h2>
<p>实际上本体是个Dijkstra，但是两点是否相连需要使用到计算几何的东西。重点就在于如何判断行进过程是否穿过了百慕大三角。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>Liaoning ship, which named after a province of China, is the first aircraft carrier commissioned into the People's Liberation Army Navy. It was bought from Ukraine as a stripped hulk and was rebuilt by China as an important part of China’s blue water Navy plan. Liaoning ship has sailed far into the Pacific Ocean for serval times, which shows the power and resolve of China to defend her integrity of territory.</p>
<p>Now Liaoning ship is on a new voyage to the Atlantic Ocean for a maneuver! The vast maneuver region on the ocean can be seen as an n×n grid which has n×n crosspoints. Each crosspoint stands for a check point of the maneuver region. Liaoning starts from the bottom-left check point whose coordinate is (0,0), and its destination is the upper-right checkpoint whose coordinate is (n-1,n-1). The positive side of the x axis points to the right, and the positive side of the y axis points up. All check points’ coordinates are integral. During each move, Liaoning can go from one check point to its adjacent 8 check points along a straight line, and each move takes Liaoning one day. Some check points are not available to go due to the bad weather. And, as you know, on the Atlantic Ocean, there is a Bermuda Triangle in which many ships and planes were missing. Liaoning can’t take risk to go into that triangle. Of course, Liaoning can’t go outside the maneuver region. Please figure out a route for Liaoning to reach its destination as soon as possible.</p>
<h2 id="分析">分析</h2>
<p>实际上本体是个Dijkstra，但是两点是否相连需要使用到计算几何的东西。重点就在于如何判断行进过程是否穿过了百慕大三角。</p>
<p>然后就WA了8发。</p>
<p>实际判断时会有很多问题。例如从边上经过，从外界到边，从边到边，从边到外界，从外界到点，从点到外界，从边穿过点……如果一开始选择的判断方法有锅的话，之后就改不出来了，只能WA……</p>
<p>最终想出来的解决办法是拿到行进线段与三角形三边的交点，连接交点构造新线段后，判断线段中点是否在三角形内；并同时判断起点终点是否在三角形内。这样就能避免掉复杂的讨论。</p>
<p>其次，顺便把已经在三角形内的整点全部标记了不能访问。</p>
<p>这样就过了。</p>
<h2 id="代码">代码</h2>
<p>板子判点在线段部分有问题，要改。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>


<span class="kt">bool</span> <span class="n">fuck</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">EPS</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">PI</span><span class="o">=</span><span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;-</span><span class="n">EPS</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">EPS</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="nc">Vec</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span><span class="c1">//never change it yourself unless you dont need polar angle.
</span><span class="c1"></span>    <span class="kt">double</span> <span class="n">_polar</span><span class="p">;</span><span class="c1">// make cache to accumulate speed as atan is too slow.
</span><span class="c1"></span>
    <span class="n">Vec</span><span class="p">(){</span>
        <span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Vec</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span><span class="kt">double</span> <span class="n">y</span><span class="p">)</span><span class="o">:</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">){</span>
        <span class="n">_polar</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">len</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqlen</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">sqlen</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="nf">normalize</span><span class="p">(){</span>
        <span class="kt">double</span> <span class="n">l</span><span class="o">=</span><span class="n">len</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">l</span><span class="p">,</span><span class="n">y</span><span class="o">/</span><span class="n">l</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="nf">rotate</span><span class="p">(</span><span class="kt">double</span> <span class="n">angle</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">x</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="k">operator</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span> <span class="n">factor</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="nf">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">factor</span><span class="p">,</span><span class="n">y</span><span class="o">*</span><span class="n">factor</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="k">operator</span> <span class="o">*</span> <span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="nf">cross</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="k">operator</span> <span class="o">-</span> <span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="nf">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Vec</span> <span class="k">operator</span> <span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="nf">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">polar</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">_polar</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="nf">leftby</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="nf">samed</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">polar</span><span class="p">()</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">polar</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
		<span class="k">return</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span><span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
    <span class="n">out</span><span class="o">&lt;&lt;</span><span class="s">&#34;(&#34;</span><span class="o">&lt;&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="s">&#34;,&#34;</span><span class="o">&lt;&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="o">&lt;&lt;</span><span class="s">&#34;)&#34;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">typedef</span> <span class="n">Vec</span> <span class="n">Point</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Line</span><span class="p">{</span>
    <span class="n">Point</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">Vec</span> <span class="n">dirc</span><span class="p">;</span>
    <span class="n">Line</span><span class="p">(</span><span class="n">Point</span> <span class="n">pos</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">Vec</span> <span class="n">dirc</span><span class="o">=</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">:</span><span class="n">pos</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="n">dirc</span><span class="p">(</span><span class="n">dirc</span><span class="p">){}</span>
    <span class="k">static</span> <span class="n">Line</span> <span class="nf">fromPoints</span><span class="p">(</span><span class="n">Point</span> <span class="n">a</span><span class="p">,</span><span class="n">Point</span> <span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="nf">getarea</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">dirc</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dirc</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// 获得垂线
</span><span class="c1"></span>    <span class="n">Line</span> <span class="nf">getppd</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="n">dirc</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span><span class="n">dirc</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">//TODO: what will happen if they have no intersection,-nan
</span><span class="c1"></span>    <span class="n">Point</span> <span class="nf">getintersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="n">Vec</span> <span class="n">down</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pos</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">aa</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">dirc</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">down</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">bb</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">dirc</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dirc</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">pos</span><span class="o">+</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">dirc</span><span class="o">*</span><span class="p">(</span><span class="n">aa</span><span class="o">/</span><span class="n">bb</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">point_on_line</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">dirc</span><span class="p">.</span><span class="n">samed</span><span class="p">(</span><span class="n">point</span><span class="o">-</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sgn</span><span class="p">((</span><span class="n">point</span><span class="o">-</span><span class="n">pos</span><span class="p">).</span><span class="n">sqlen</span><span class="p">()</span><span class="o">-</span><span class="n">dirc</span><span class="p">.</span><span class="n">sqlen</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">on_ver</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">dirc</span><span class="p">.</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="n">dirc</span><span class="p">.</span><span class="n">y</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="nf">get_distance</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">){</span>
        <span class="n">Line</span> <span class="n">ppd</span><span class="o">=</span><span class="n">getppd</span><span class="p">();</span>
        <span class="n">ppd</span><span class="p">.</span><span class="n">pos</span><span class="o">=</span><span class="n">point</span><span class="p">;</span>

        <span class="n">Point</span> <span class="n">intersection</span><span class="o">=</span><span class="n">getintersection</span><span class="p">(</span><span class="n">ppd</span><span class="p">);</span>

        <span class="n">ppd</span><span class="p">.</span><span class="n">dirc</span><span class="o">=</span><span class="n">intersection</span><span class="o">-</span><span class="n">point</span><span class="p">;</span>
        <span class="n">Vec</span> <span class="n">v</span><span class="o">=</span><span class="n">intersection</span><span class="o">-</span><span class="n">pos</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">point</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">/</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="nf">get_distance</span><span class="p">(</span><span class="n">Line</span> <span class="n">line</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">get_distance</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">pos</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">Point</span> <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">Line</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="kt">char</span> <span class="n">game</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">double</span> <span class="nf">get_area</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">){</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">points</span><span class="p">.</span><span class="n">end</span><span class="p">(),[](</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">polar</span><span class="p">()</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">polar</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="n">Point</span> <span class="n">base</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">Point</span> <span class="n">last</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">double</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">points</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Vec</span> <span class="n">a</span><span class="o">=</span><span class="n">last</span><span class="o">-</span><span class="n">base</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">base</span><span class="p">;</span>
        <span class="n">res</span><span class="o">+=</span><span class="n">a</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="n">last</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">//add the last point(also the first point)
</span><span class="c1"></span>    <span class="n">Vec</span> <span class="n">a</span><span class="o">=</span><span class="n">last</span><span class="o">-</span><span class="n">base</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">base</span><span class="p">;</span>
    <span class="n">res</span><span class="o">+=</span><span class="n">a</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">in_triangle</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fuck</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">],</span><span class="n">points</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]).</span><span class="n">point_on_line</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">areas</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">ps</span><span class="p">;</span>
        <span class="n">ps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">]);</span>
        <span class="n">ps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">points</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]);</span>
        <span class="n">ps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
        <span class="n">areas</span><span class="o">+=</span><span class="n">get_area</span><span class="p">(</span><span class="n">ps</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">ps</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">ps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">areas</span><span class="o">-</span><span class="n">get_area</span><span class="p">(</span><span class="n">ps</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">has_intersetct</span><span class="p">(</span><span class="n">Line</span> <span class="n">line</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fuck</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
    <span class="n">Point</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="kt">bool</span> <span class="n">flg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">dirc</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">triangle</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dirc</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">line</span><span class="p">.</span><span class="n">getintersection</span><span class="p">(</span><span class="n">triangle</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">point_on_line</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">||</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">line</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span> <span class="n">flg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">pos</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">pos</span><span class="o">+</span><span class="n">line</span><span class="p">.</span><span class="n">dirc</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">Line</span> <span class="n">l</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">flg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">{</span>
		<span class="n">l</span><span class="o">=</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">pos</span><span class="o">+</span><span class="n">l</span><span class="p">.</span><span class="n">dirc</span><span class="o">*</span><span class="mf">0.5</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">flg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">{</span>
		<span class="n">l</span><span class="o">=</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">pos</span><span class="o">+</span><span class="n">l</span><span class="p">.</span><span class="n">dirc</span><span class="o">*</span><span class="mf">0.5</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">flg</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="p">{</span>
		<span class="n">l</span><span class="o">=</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">pos</span><span class="o">+</span><span class="n">l</span><span class="p">.</span><span class="n">dirc</span><span class="o">*</span><span class="mf">0.5</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">v4q</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">step</span><span class="p">;</span>
    <span class="n">v4q</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="kt">int</span> <span class="n">step</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">j</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">step</span><span class="p">(</span><span class="n">step</span><span class="p">){}</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">v4q</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">step</span><span class="o">&gt;</span><span class="n">other</span><span class="p">.</span><span class="n">step</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">solve</span><span class="p">(){</span>
    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">v4q</span><span class="o">&gt;</span> <span class="n">pq</span><span class="p">;</span>
    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v4q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">pq</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
        <span class="n">v4q</span> <span class="n">cur</span><span class="o">=</span><span class="n">pq</span><span class="p">.</span><span class="n">top</span><span class="p">();</span><span class="n">pq</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="p">][</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="p">])</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">vis</span><span class="p">[</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="p">][</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
		<span class="c1">//printf(&#34;now:%d %d\n&#34;,cur.i,cur.j);
</span><span class="c1"></span>        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">nlen</span><span class="p">,</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">nlen</span><span class="p">,</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">j</span><span class="o">==</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="err">#</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;)</span><span class="k">continue</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">has_intersetct</span><span class="p">(</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="k">continue</span><span class="p">;</span>
               <span class="c1">//cout&lt;&lt;&#34;arrive &#34;&lt;&lt;i&lt;&lt;&#34;,&#34;&lt;&lt;j;
</span><span class="c1"></span>                <span class="k">if</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dist</span><span class="p">[</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="p">][</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
                    <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="n">cur</span><span class="p">.</span><span class="n">i</span><span class="p">][</span><span class="n">cur</span><span class="p">.</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                    <span class="c1">//cout&lt;&lt;&#34; and update it to &#34;&lt;&lt;dist[i][j];
</span><span class="c1"></span>                    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v4q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]));</span>
                <span class="p">}</span>
                <span class="c1">//cout&lt;&lt;endl;
</span><span class="c1"></span>            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dist</span><span class="p">[</span><span class="n">nlen</span><span class="p">][</span><span class="n">nlen</span><span class="p">];</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
<span class="c1">//	freopen(&#34;in.txt&#34;,&#34;r&#34;,stdin);
</span><span class="c1">//	freopen(&#34;out.txt&#34;,&#34;w&#34;,stdout);
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">){</span>
    	<span class="n">fuck</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">Point</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">triangle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">Line</span><span class="o">::</span><span class="n">fromPoints</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">],</span><span class="n">points</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">triangle</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">].</span><span class="n">dirc</span><span class="p">.</span><span class="n">cross</span><span class="p">(</span><span class="n">triangle</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">].</span><span class="n">dirc</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">fuck</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//solve triangle
</span><span class="c1"></span>        
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">in_triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="err">#</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="cm">/*
</span><span class="cm">        for(int i=nlen;i&gt;=1;i--){
</span><span class="cm">            for(int j=1;j&lt;=nlen;j++){
</span><span class="cm">                cout&lt;&lt;game[i][j];
</span><span class="cm">            }
</span><span class="cm">            cout&lt;&lt;endl;
</span><span class="cm">        }
</span><span class="cm">        */</span>
        
        

        <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="n">solve</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="o">!=</span><span class="mh">0x3f3f3f3f</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;-1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CCPC2017杭州] Heathrock</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/ccpc2017hangzhou-heathrock/" />
            <id>https://blog.kanari.moe/code/ccpc2017hangzhou-heathrock/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-23T19:13:47+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>这题意太长了，我懒得复制。</p>
<h2 id="分析">分析</h2>
<p>额……其实就是爆搜模拟。但是状态比较多，需要记双方生命值，3个随从的生命，当前场数，魔力，体力，以及一些玄学优化。</p>
<ul>
<li>自选目标的牌一定会放在回合的较后出，因为其不会累加魔力。</li>
<li>如果剩下的牌全踢脸也踢不死，直接返回。</li>
</ul>
<p>之后就能跑得飞快。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>这题意太长了，我懒得复制。</p>
<h2 id="分析">分析</h2>
<p>额……其实就是爆搜模拟。但是状态比较多，需要记双方生命值，3个随从的生命，当前场数，魔力，体力，以及一些玄学优化。</p>
<ul>
<li>自选目标的牌一定会放在回合的较后出，因为其不会累加魔力。</li>
<li>如果剩下的牌全踢脸也踢不死，直接返回。</li>
</ul>
<p>之后就能跑得飞快。</p>
<p>{% asset_img &quot;1.png&quot; %}</p>
<h2 id="代码">代码</h2>
<p>一开始输出了&quot;YES&quot;，淦。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Card</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">damage</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cost</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">power</span><span class="p">;</span>

    <span class="n">Card</span><span class="p">(){}</span>
    <span class="n">Card</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">,</span><span class="kt">int</span> <span class="n">damage</span><span class="p">,</span><span class="kt">int</span> <span class="n">cost</span><span class="p">,</span><span class="kt">int</span> <span class="n">power</span><span class="p">)</span><span class="o">:</span><span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">),</span><span class="n">damage</span><span class="p">(</span><span class="n">damage</span><span class="p">),</span><span class="n">cost</span><span class="p">(</span><span class="n">cost</span><span class="p">),</span><span class="n">power</span><span class="p">(</span><span class="n">power</span><span class="p">){}</span>
<span class="p">}</span> <span class="n">cards</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">used</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">md1</span><span class="p">,</span><span class="n">md2</span><span class="p">,</span><span class="n">md3</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">mx1</span><span class="p">,</span><span class="n">mx2</span><span class="p">,</span><span class="n">mx3</span><span class="p">;</span>

<span class="n">stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ans_cards</span><span class="p">,</span><span class="n">ans_target</span><span class="p">;</span>
<span class="kt">bool</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">stone</span><span class="p">,</span><span class="kt">int</span> <span class="n">power</span><span class="p">,</span><span class="kt">int</span> <span class="n">bl_me</span><span class="p">,</span><span class="kt">int</span> <span class="n">bl_en</span><span class="p">,</span><span class="kt">int</span> <span class="n">m1</span><span class="p">,</span><span class="kt">int</span> <span class="n">m2</span><span class="p">,</span><span class="kt">int</span> <span class="n">m3</span><span class="p">,</span><span class="kt">int</span> <span class="n">depth</span><span class="p">,</span><span class="kt">bool</span> <span class="n">nearend</span><span class="o">=</span><span class="nb">false</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">stone</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bl_en</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">stone</span><span class="o">==</span><span class="mi">10</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">bl_me</span><span class="o">-=</span><span class="n">md1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m2</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">bl_me</span><span class="o">-=</span><span class="n">md2</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m3</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">bl_me</span><span class="o">-=</span><span class="n">md3</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="n">m1</span><span class="o">=</span><span class="n">mx1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="n">m2</span><span class="o">=</span><span class="n">mx2</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m3</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="n">m3</span><span class="o">=</span><span class="n">mx3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bl_me</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">//full attacking to owner cannot kill it.
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">fullattack</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">fakepower</span><span class="o">=</span><span class="n">power</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">unusd_lian</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">used</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">fakepower</span><span class="o">+=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">power</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">unusd_lian</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fullattack</span><span class="o">+=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">damage</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fullattack</span><span class="o">+</span><span class="n">fakepower</span><span class="o">*</span><span class="p">(</span><span class="n">unusd_lian</span><span class="p">)</span><span class="o">&lt;</span><span class="n">bl_en</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">used</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="k">continue</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">Card</span> <span class="o">&amp;</span><span class="n">card</span><span class="o">=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">reald</span><span class="o">=</span><span class="n">card</span><span class="p">.</span><span class="n">damage</span><span class="o">+</span><span class="n">power</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;</span><span class="n">stone</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>

        <span class="n">used</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">nearend</span> <span class="o">&amp;&amp;</span> <span class="n">card</span><span class="p">.</span><span class="n">type</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">m1</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m2</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m3</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">depth</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">nearend</span> <span class="o">&amp;&amp;</span> <span class="n">card</span><span class="p">.</span><span class="n">type</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">,</span><span class="n">depth</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">card</span><span class="p">.</span><span class="n">type</span><span class="o">==</span><span class="mi">3</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">m1</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">m2</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">m3</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">m3</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dfs</span><span class="p">(</span><span class="n">stone</span><span class="o">-</span><span class="n">card</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span><span class="n">power</span><span class="o">+</span><span class="n">card</span><span class="p">.</span><span class="n">power</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="o">-</span><span class="n">reald</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">used</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">dfs</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">,</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)){</span>
        <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">mc1</span><span class="p">,</span><span class="n">mc2</span><span class="p">,</span><span class="n">mc3</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">used</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">used</span><span class="p">));</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ans_target</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="n">ans_target</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">bl_me</span><span class="o">&gt;&gt;</span><span class="n">bl_en</span><span class="p">;</span>

        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">md1</span><span class="o">&gt;&gt;</span><span class="n">mc1</span><span class="o">&gt;&gt;</span><span class="n">mx1</span><span class="p">;</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">md2</span><span class="o">&gt;&gt;</span><span class="n">mc2</span><span class="o">&gt;&gt;</span><span class="n">mx2</span><span class="p">;</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">md3</span><span class="o">&gt;&gt;</span><span class="n">mc3</span><span class="o">&gt;&gt;</span><span class="n">mx3</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="o">=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">damage</span><span class="o">=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">power</span><span class="o">=</span><span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">type</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">type</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="o">==</span><span class="mi">1</span> <span class="o">||</span> <span class="n">type</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">cost</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">cost</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">y</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="o">=</span><span class="n">type</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">damage</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">power</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="kt">int</span> <span class="n">cost</span><span class="p">,</span><span class="n">x</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">cost</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="o">=</span><span class="n">type</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">;</span>
                <span class="n">cards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">damage</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">ans_cards</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">ans_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dfs</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bl_me</span><span class="p">,</span><span class="n">bl_en</span><span class="p">,</span><span class="n">mc1</span><span class="p">,</span><span class="n">mc2</span><span class="p">,</span><span class="n">mc3</span><span class="p">,</span><span class="mi">0</span><span class="p">)){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;Yes</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;No</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="kt">int</span> <span class="n">block</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
            <span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pack_ans</span><span class="p">,</span><span class="n">pack_target</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">ans_cards</span><span class="p">.</span><span class="n">top</span><span class="p">()</span><span class="o">!=-</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">pack_ans</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">top</span><span class="p">());</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
                <span class="n">pack_target</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">ans_target</span><span class="p">.</span><span class="n">top</span><span class="p">());</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ans_cards</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
                <span class="n">ans_cards</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
                <span class="n">ans_target</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">pack_ans</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="k">continue</span><span class="p">;</span>

            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">pack_ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">pack_ans</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">pack_ans</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
                <span class="n">pack_ans</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">pack_target</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">pack_target</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="p">;</span>
                <span class="n">pack_target</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="n">block</span><span class="o">++</span><span class="p">;</span>            
        <span class="p">}</span>
        <span class="k">while</span><span class="p">(</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;0</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="n">block</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CCPC 2017] Master of Sequence</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/ccpc-2017-master-of-sequence/" />
            <id>https://blog.kanari.moe/code/ccpc-2017-master-of-sequence/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-21T15:37:14+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[给出2个数列，${a_i},{b_i}$.要求支持以下操作 修改数列a的第i个为x 修改……]]></summary>
            
                <content type="html"><![CDATA[<p>给出2个数列，${a_i},{b_i}$.要求支持以下操作</p>
<ol>
<li>修改数列a的第i个为x</li>
<li>修改数列b的第i个为x</li>
<li>给出k，求最小的t，满足$\sum \lfloor \frac {t-b_i}{a_i} \rfloor \ge k$</li>
</ol>
<p>操作数不多于100000，操作3不多于1000；数列长度不多于10000，<strong>a的值域不大于1000</strong>。</p>
<h2 id="分析">分析</h2>
<p>将$\lfloor \frac {t-b_i}{a_i} \rfloor$拆开，观察前后可能出现的差。</p>
<p>$$
\lfloor \frac {t}{a_i} \rfloor - \lfloor \frac {b_i}{a_i} \rfloor
$$</p>
<p>设$t=k_1a_i+c_1,b_i=k_2a_i+c_2$，代入观察。</p>
<p>$$
\begin{aligned}
\lfloor \frac {t-b_i}{a_i} \rfloor&amp;=\lfloor \frac {(k_1-k_2)a_i+c_1-c_2}{a_i} \rfloor \<br>
\end{aligned}
$$</p>
<p>可以发现，当把式子拆开时，有2种情况。</p>
<ul>
<li>$c_1 &gt; c_2$，啥事没有。</li>
<li>$c_1 &lt; c_2$，拆开后会多统计一个1。</li>
</ul>
<p>事先统计${b_i}$模$a$的余数，那么有$t$后就能快速数出第2种情况的数量。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXA</span><span class="o">=</span><span class="mi">1010</span><span class="p">,</span><span class="n">MAXB</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">mlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXB</span><span class="p">],</span><span class="n">acnt</span><span class="p">[</span><span class="n">MAXA</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="n">MAXB</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">fts</span><span class="p">[</span><span class="n">MAXA</span><span class="p">][</span><span class="n">MAXA</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">pre</span><span class="p">[</span><span class="n">MAXA</span><span class="p">][</span><span class="n">MAXA</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">force</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">){</span>
	<span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">fts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">MAXA</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
		<span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">fts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="kt">bool</span> <span class="nf">check</span><span class="p">(</span><span class="n">ll</span> <span class="n">k</span><span class="p">,</span><span class="n">ll</span> <span class="n">t</span><span class="p">){</span>
	<span class="n">ll</span> <span class="n">res</span><span class="o">=-</span><span class="n">base</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">res</span><span class="o">+=</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">acnt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">c</span><span class="o">=</span><span class="n">t</span><span class="o">%</span><span class="n">i</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">offset</span><span class="o">=</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1000</span><span class="p">]</span><span class="o">-</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">c</span><span class="p">];</span>
		<span class="n">res</span><span class="o">-=</span><span class="n">offset</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">res</span><span class="o">&gt;=</span><span class="n">k</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">acnt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">acnt</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
		<span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">fts</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fts</span><span class="p">));</span>
		
		<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="o">&gt;&gt;</span><span class="n">mlen</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">acnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">fts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
			<span class="n">base</span><span class="o">+=</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">force</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">mlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="kt">int</span> <span class="n">opt</span><span class="p">;</span>
			<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">opt</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
				<span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
				<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">y</span><span class="p">;</span>

				<span class="n">acnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
				<span class="n">fts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">%</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
				<span class="n">base</span><span class="o">-=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
				<span class="n">force</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>

				<span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
				<span class="n">fts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">%</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
				<span class="n">acnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
				<span class="n">base</span><span class="o">+=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
				<span class="n">force</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>

				
			<span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
				<span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
				<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">y</span><span class="p">;</span>

				<span class="n">fts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">%</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
				<span class="n">base</span><span class="o">-=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
				<span class="n">force</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>

				<span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>

				<span class="n">fts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">%</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
				<span class="n">force</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>
				<span class="n">base</span><span class="o">+=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
			<span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">3</span><span class="p">){</span>
				<span class="kt">int</span> <span class="n">qk</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">qk</span><span class="p">;</span>
				<span class="n">ll</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span>
				<span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">r</span><span class="p">){</span>
					<span class="n">ll</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
					<span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">qk</span><span class="p">,</span><span class="n">mid</span><span class="p">)){</span>
						<span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
					<span class="p">}</span><span class="k">else</span> <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="n">i</span><span class="o">=</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
					<span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">qk</span><span class="p">,</span><span class="n">i</span><span class="p">)){</span>
						<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="o">&lt;&lt;</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CFEDU74 E] Keyboard Purchase</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cfedu74-e-keyboard-purchase/" />
            <id>https://blog.kanari.moe/code/cfedu74-e-keyboard-purchase/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-09T15:38:03+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>当在使用一指禅键入一个字符串的时候，你需要不停的移动手指。比如说输入“af”，手指需要跨过3个键（包括终点）输入“a”和“f”。</p>
<p>针对一个经常输入的字符串，你可以定制一个长条键盘，使得在这个键盘上输入字符串需要移动的距离最短。</p>
<p>给出字符串长度$n$与字典大小$k$（小写字母的前$k$个），给出最优情况下手指需要移动的距离。</p>
<h2 id="分析">分析</h2>
<p>这道题和之前那道marbles很像……或者说状压都挺像的。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>当在使用一指禅键入一个字符串的时候，你需要不停的移动手指。比如说输入“af”，手指需要跨过3个键（包括终点）输入“a”和“f”。</p>
<p>针对一个经常输入的字符串，你可以定制一个长条键盘，使得在这个键盘上输入字符串需要移动的距离最短。</p>
<p>给出字符串长度$n$与字典大小$k$（小写字母的前$k$个），给出最优情况下手指需要移动的距离。</p>
<h2 id="分析">分析</h2>
<p>这道题和之前那道marbles很像……或者说状压都挺像的。</p>
<p>题目即依次决定键盘的下一个按键装啥，并在原字符串里计算需要移动的次数。设$f(S)$表示已经考虑了集合$S$里所有的按键。不过仔细思考一下发现这个代价需要知道先前安装的按键的顺序，而这个顺序显然不能加入到状态里，这是无法接受的。必须要通过别的方式来计算。</p>
<p>然后我又卡了。</p>
<p>这是没见过的转移方式……考虑本轮没有排入键A，那么一定就<strong>排入了别的键B</strong>，那么，这次对于事件“排A”的<strong>一次delay</strong>会导致原串里A和相邻<strong>在键盘上已确定位置的</strong>字母间的转移多<strong>一个</strong>代价。</p>
<p>有种模糊的感觉。之前那个题目是计算当前元素和已有元素之间的代价；这个是计算已有元素和未有元素之间的累进式代价。搞不太清楚这个$f(S)$现在代表的是什么了…不知可否有人指导。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXK</span><span class="o">=</span><span class="mi">21</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">klen</span><span class="p">;</span>
<span class="n">string</span> <span class="n">inp</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="n">cost</span><span class="p">[</span><span class="n">MAXK</span><span class="p">][</span><span class="n">MAXK</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="o">&gt;&gt;</span><span class="n">klen</span><span class="p">;</span>
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">inp</span><span class="p">;</span>
 
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">cost</span><span class="p">[</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;][</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">cost</span><span class="p">[</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;][</span><span class="n">inp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="n">a</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;]</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
 
 
    <span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
 
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">klen</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">ll</span> <span class="n">scost</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">klen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">j</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">))</span><span class="k">continue</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">klen</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">k</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
                <span class="n">scost</span><span class="o">+=</span><span class="n">cost</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">klen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">j</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="p">)]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="p">)],</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">scost</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">dp</span><span class="p">[(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">klen</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
 
    
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF EDU72D] Coloring Edges</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf-edu72d-coloring-edges/" />
            <id>https://blog.kanari.moe/code/cf-edu72d-coloring-edges/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-06T18:49:19+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[You are given a directed graph with n vertices and m directed edges without self-loops or multiple edges. Let's denote the k-coloring of a digraph as following: you color each edge in one of k colors. The k-coloring is good if and……]]></summary>
            
                <content type="html"><![CDATA[<p>You are given a directed graph with n vertices and m directed edges without self-loops or multiple edges.</p>
<p>Let's denote the k-coloring of a digraph as following: you color each edge in one of k colors. The k-coloring is good if and only if there no cycle formed by edges of same color.</p>
<p>Find a good k-coloring of given digraph with minimum possible k.</p>
<h2 id="分析">分析</h2>
<p>对我这个菜鸡来说，去染色返祖边的操作并不怎么显然……算了……</p>
<p>没能坚持只有2种颜色的猜想。挂城墙。</p>
<p>没必要挂代码。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF585E] Marbles</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf585e-marbles/" />
            <id>https://blog.kanari.moe/code/cf585e-marbles/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-05T22:18:45+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Monocarp has arranged n colored marbles in a row. The color of the i-th marble is ai. Monocarp likes ordered things, so he wants to rearrange marbles in such a way that all marbles of the same color form a contiguos segment……]]></summary>
            
                <content type="html"><![CDATA[<p>Monocarp has arranged n colored marbles in a row. The color of the i-th marble is ai. Monocarp likes ordered things, so he wants to rearrange marbles in such a way that all marbles of the same color form a contiguos segment (and there is only one such segment for each color).</p>
<p>In other words, Monocarp wants to rearrange marbles so that, for every color j, if the leftmost marble of color j is l-th in the row, and the rightmost marble of this color has position r in the row, then every marble from l to r has color j.</p>
<p>To achieve his goal, Monocarp can do the following operation any number of times: choose two neighbouring marbles, and swap them.</p>
<p>You have to calculate the minimum number of operations Monocarp has to perform to rearrange the marbles. Note that the order of segments of marbles having equal color does not matter, it is only required that, for every color, all the marbles of this color form exactly one contiguous segment.</p>
<h2 id="分析">分析</h2>
<p>这道题的翻译就是“重新确定每个颜色的权值，使得逆序对最少”。</p>
<p>然后我就卡了，现在我也不是特别清楚为啥可以dp，只是知道能dp。</p>
<p>选择状态$f(S)$表示集合$S$已经全部分配权值时产生的最少逆序对。枚举下一个颜色，给予下一个（较小）权值，并计算代价。</p>
<p>$$
f(S+{i})=min{f(S)+w}
$$</p>
<p>接下来是w的处理。我们需要的是在当前颜色的所有点前的<strong>已经拥有新权值</strong>的点数目，这可以事先预处理。预处理颜色i前颜色j的pair数即可。</p>
<h2 id="代码">代码</h2>
<p>不小心把ptr扔到了里层循环里T了发…</p>
<p>明明第一步完事都很直白了，就是非得被卡一下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">400010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXC</span><span class="o">=</span><span class="mi">21</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pos</span><span class="p">[</span><span class="n">MAXC</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAXC</span><span class="p">][</span><span class="n">MAXC</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">tick</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">newColor</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
 
<span class="n">ll</span> <span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">MAXC</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
 
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">newColor</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">newColor</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">newColor</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="n">newColor</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">tick</span><span class="o">++</span><span class="p">;</span>
        <span class="n">pos</span><span class="p">[</span><span class="n">newColor</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]]].</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">tick</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">tick</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="k">while</span><span class="p">(</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">ptr</span><span class="p">]</span><span class="o">&lt;</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
                <span class="n">ptr</span><span class="o">--</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">ptr</span><span class="p">]</span><span class="o">&lt;</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]){</span>
                    <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+=</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
 
    <span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">tick</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">tick</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">j</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
            <span class="n">ll</span> <span class="n">diff</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">tick</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="n">k</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">diff</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="p">)]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="p">)],</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">diff</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">dp</span><span class="p">[(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">tick</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF585D] Ticket Game</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf585d-ticket-game/" />
            <id>https://blog.kanari.moe/code/cf585d-ticket-game/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-05T15:13:52+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Monocarp and Bicarp live in Berland, where every bus ticket consists of n digits (n is an even number). During the evening walk Monocarp and Bicarp found a ticket where some of the digits have been erased. The number of digits that……]]></summary>
            
                <content type="html"><![CDATA[<p>Monocarp and Bicarp live in Berland, where every bus ticket consists of n digits (n is an even number). During the evening walk Monocarp and Bicarp found a ticket where some of the digits have been erased. The number of digits that have been erased is even.</p>
<p>Monocarp and Bicarp have decided to play a game with this ticket. Monocarp hates happy tickets, while Bicarp collects them. A ticket is considered happy if the sum of the first $\frac n2$ digits of this ticket is equal to the sum of the last $\frac n2$ digits.</p>
<p>Monocarp and Bicarp take turns (and Monocarp performs the first of them). During each turn, the current player must replace any erased digit with any digit from 0 to 9. The game ends when there are no erased digits in the ticket.</p>
<p>If the ticket is happy after all erased digits are replaced with decimal digits, then Bicarp wins. Otherwise, Monocarp wins. You have to determine who will win if both players play optimally.</p>
<h2 id="分析">分析</h2>
<p>在做这道题的时候，我发现了实际上影响答案的只和两边的 已知数的和 以及未知位的数目有关，发现了获胜的根本是前后两部分和的差值大小，发现了先手的目的是<strong>扩大差值</strong>使得后手无法通过某种方式追赶。</p>
<p>但是到这我就卡住了。淦，为什么我这么菜。</p>
<p>接下来要考虑的是<strong>优势</strong>，在这道题里优势就是差值。先手的目的是扩大优势，在大的一边增大会加大优势，而在小的一边置0不会扩大优势；后手要<strong>减小优势</strong>，同样的办法就是在小的一侧置数来追赶另一侧，在大的一侧置0不会更好。</p>
<p>那么，又可以得出先手扩大优势最好的办法是置9（最大）。那么游戏最开始的几步，就是双方在两侧填写9。直到某侧不再有空位。</p>
<p>此时，如果空位在大的一侧，先手必赢。如果空位在小的一侧，继续讨论如下</p>
<p>$$
x_1+x_2+\cdots+x_n=C
$$</p>
<p>首先$2|n$显然。</p>
<p>当C不是9的倍数时，先手总有办法让最终结果偏离。因此该情况只有当$\frac n2 \times 9 = n$时后手才能获胜。</p>
<h2 id="代码">代码</h2>
<p>嫖了队友的…我瞎xx搞的结论WA23了…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">200005</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="o">?&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;)</span> <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span> <span class="n">sum</span><span class="o">+=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="mi">0</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;;</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="o">?&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;)</span> <span class="n">cnt</span><span class="o">--</span><span class="p">;</span>
		<span class="k">else</span> <span class="n">sum</span><span class="o">-=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="mi">0</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;;</span>
	<span class="p">}</span>
	<span class="c1">//cout&lt;&lt;cnt&lt;&lt;&#34; &#34;&lt;&lt;sum&lt;&lt;endl;
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">sum</span><span class="o">*</span><span class="mi">2</span><span class="o">==-</span><span class="n">cnt</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Bicarp&#34;</span><span class="p">);</span>
	<span class="k">else</span> <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Monocarp&#34;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">后缀自动机</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/sam/" />
            <id>https://blog.kanari.moe/study/sam/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-10-04T20:44:30+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[如你所见，后缀自动机。 然而就nm看不懂，先看不懂它的图是啥，又看不懂它的边是啥，现在……]]></summary>
            
                <content type="html"><![CDATA[<p>如你所见，后缀自动机。</p>
<blockquote>
<p>然而就nm看不懂，先看不懂它的图是啥，又看不懂它的边是啥，现在还是看不懂它的边是咋找出来的。可是咱不想搞不清楚它是干嘛的就直接用啊靠。</p>
</blockquote>
<p>后缀自动机首先是自动机。一个字符串S的后缀自动机能接受S的所有后缀。基于它的这个性质，它能够做到：</p>
<ul>
<li>查询子串是否出现：这显然跑一次，能在自动机上跑完就是出现过。</li>
<li>统计不同子串的数量：自动机上每条不同的路径对应一个不同的子串。定义$d(x)$为以x为起点的路径数目，递推即可。</li>
<li>计算所有不同子串的长度总和：得到上面的$d$。以x为起点，每条路径都会让子串<strong>总</strong>长度增加<strong>路径个</strong>。依然是递推。</li>
<li>字典序第k小子串：当你有路径数了，只需要按照字典序对节点排序，然后像编码一样找。</li>
<li>最小循环移位：指将原字符串首尾相接移位，找到字典序最小的一个。将字符串$S$断环成链$SS$，然后建立SAM，贪心找最小直到长度达到$|S|$即可。</li>
<li>多组子串出现次数：dfs预处理每个节点的终点集合大小。在自动机上查找串$P$对应的节点,存在则答案为该节点的终点集合大小；不存在答案为$0$.</li>
<li>所有出现位置：遍历树，一旦发现终点直接输出。</li>
</ul>
<h2 id="建立">建立</h2>
<p>最暴力的方式是建立一个O(n^2)级别的自动机，不过那个复杂度就没什么意义了。后缀自动机需要满足状态数最少，为线性级别，且转移（边）也为线性级别。</p>
<p>然后，我们可以开始折腾了。</p>
<p>定义串S的$endpos(x)$为一个集合，元素为x在其内出现的所有位置的结尾下标。</p>
<h2 id="资料">资料</h2>
<ul>
<li><a href="https://saisumit.wordpress.com/2016/01/26/suffix-automaton/">参考资料</a></li>
<li>2015年国家集训队论文</li>
</ul>
<h3 id="子串第一次出现的位置">子串第一次出现的位置</h3>
<p>对SAM中所有状态预处理firstpos（第一次出现该状态的末端位置，也就是endpos集合的最小元素）。</p>
<p>扩展源函数为<code>sam_extend()</code>。创建新状态<code>cur</code>时，令</p>
<p>$$
firstpos(cur)=len(cur)-1
$$</p>
<p>当<code>q</code>复制到<code>clone</code>时，令</p>
<p>$$
firstpos(clone)=firstpos(q)
$$</p>
<p>需要的答案就是$firstpos(t)-|P|+1$，$t$为字符串$P$的状态。每次查询需要$O(|P|)$</p>
<h3 id="最短未出现字符串">最短未出现字符串</h3>
<p>动态规划。</p>
<p>让$d_v$为节点$v$的答案。如果不存在使用字符集中至少一个字符的转移，那么$d_v=1$，否则</p>
<p>$$
d_v=1+\min_{w:(v,w,c) \in SAM} d_w
$$</p>
<p>字符串可以由转移推回去。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF589C] primes and multiplication</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf589c-primes-and-multiplication/" />
            <id>https://blog.kanari.moe/code/cf589c-primes-and-multiplication/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-09-30T09:04:32+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[设$primes(x)$为x的质因数的集合。 设$g(x,p)$表示可以整除x的最大的……]]></summary>
            
                <content type="html"><![CDATA[<p>设$primes(x)$为x的质因数的集合。</p>
<p>设$g(x,p)$表示可以整除x的最大的$p^k$。</p>
<p>设$f(x,y)$表示将x作分解后对每个质因子作用到1到y上求$g$的乘积。</p>
<p>求$f(x,n)$</p>
<h2 id="分析">分析</h2>
<p>……最后你会发现，这题就是求阶乘质因子的乘积。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1010</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">P</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>
 
<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>
 
<span class="kt">void</span> <span class="nf">unpack</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">b</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="n">x</span><span class="o">/=</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span><span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">get</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span><span class="n">ll</span> <span class="n">num</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="p">){</span>
        <span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="n">n</span><span class="o">/</span><span class="n">num</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">n</span><span class="o">/=</span><span class="n">num</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
    <span class="n">unpack</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
 
    <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="nl">item</span><span class="p">:</span><span class="n">primes</span><span class="p">){</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">item</span><span class="p">),</span><span class="n">P</span><span class="p">)</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">%</span><span class="n">P</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CCPC2019 秦皇岛] Angel Beats</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/ccpc2019-qinhuangdao-angel-beats/" />
            <id>https://blog.kanari.moe/code/ccpc2019-qinhuangdao-angel-beats/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-09-29T21:02:19+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[给出一些点，询问对于点$(x,y)$，求其能和已知点形成多少个直角三角形。 分析 首先，……]]></summary>
            
                <content type="html"><![CDATA[<p>给出一些点，询问对于点$(x,y)$，求其能和已知点形成多少个直角三角形。</p>
<h2 id="分析">分析</h2>
<p>首先，对于询问的点，直接加入集合离线操作就可以。这道题就变成了单纯的求三角形。一开始我跟求锐角三角形那道题一样做，然后写得又恶心又不知道哪里出了bug改不出来。</p>
<p>后来，实际上可以事先直接枚举2点按照斜率统计边数，对每个查询$lg(n^2)$查询，会省很多事。</p>
<p>之后的就是很显然的：查询点作为直角扫一遍，查询点作为非直角扫一遍。</p>
<h2 id="代码">代码</h2>
<p>淦。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">2010</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Point</span>
<span class="p">{</span>
    <span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">Point</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="n">y</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">){};</span>
    <span class="n">Point</span><span class="p">(){}</span>

    <span class="n">Point</span> <span class="nf">normalize</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Point</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">//将线按照斜率排序，以在map中统计到一起。
</span><span class="c1"></span>        <span class="n">Point</span> <span class="n">a</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(),</span> <span class="n">b</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">using</span> <span class="n">Vec</span> <span class="o">=</span> <span class="n">Point</span><span class="p">;</span>

<span class="n">Point</span> <span class="n">origin</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">queries</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">ans</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">map</span><span class="o">&lt;</span><span class="n">Vec</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">mp</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span> <span class="n">qlen</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">nlen</span> <span class="o">&gt;&gt;</span> <span class="n">qlen</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ans</span><span class="p">));</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">queries</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">queries</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">mp</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="n">Vec</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">mp</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">qlen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Vec</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">queries</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">ans</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mp</span><span class="p">[</span><span class="n">Vec</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">temp</span><span class="p">.</span><span class="n">x</span><span class="p">)];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="cm">/*
</span><span class="cm">        cout&lt;&lt;&#34;====not====&#34;&lt;&lt;endl;
</span><span class="cm">        for(int i=0;i&lt;qlen;i++){
</span><span class="cm">            cout&lt;&lt;ans[i]&lt;&lt;&#34;\t&#34;;
</span><span class="cm">        }
</span><span class="cm">        cout&lt;&lt;endl&lt;&lt;&#34;====not====&#34;&lt;&lt;endl;
</span><span class="cm">        */</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">mp</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Vec</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">queries</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mp</span><span class="p">[</span><span class="n">Vec</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">temp</span><span class="p">.</span><span class="n">x</span><span class="p">)];</span>
                <span class="n">mp</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[CF1221F] Choose a Sequence</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/cf1221f-choose-a-sequence/" />
            <id>https://blog.kanari.moe/code/cf1221f-choose-a-sequence/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-09-23T23:46:44+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>Petya recently found a game &quot;Choose a Square&quot;. In this game, there are nn points numbered from 11 to nn on an infinite field. The ii-th point has coordinates (xi,yi) and cost ci.</p>
<p>You have to choose a square such that its sides are parallel to coordinate axes, the lower left and upper right corners belong to the line y=x, and all corners have integer coordinates.</p>
<p>The score you get is the sum of costs of the points covered by the selected square minus the length of the side of the square. Note that the length of the side can be zero.</p>
<p>Petya asks you to calculate the maximum possible score in the game that can be achieved by placing exactly one square.</p>
<p>{% asset_img a.png %}</p>
<h2 id="分析">分析</h2>
<p>这道题其实和多校的Snowy Smile（题文无关）挺像的。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>Petya recently found a game &quot;Choose a Square&quot;. In this game, there are nn points numbered from 11 to nn on an infinite field. The ii-th point has coordinates (xi,yi) and cost ci.</p>
<p>You have to choose a square such that its sides are parallel to coordinate axes, the lower left and upper right corners belong to the line y=x, and all corners have integer coordinates.</p>
<p>The score you get is the sum of costs of the points covered by the selected square minus the length of the side of the square. Note that the length of the side can be zero.</p>
<p>Petya asks you to calculate the maximum possible score in the game that can be achieved by placing exactly one square.</p>
<p>{% asset_img a.png %}</p>
<h2 id="分析">分析</h2>
<p>这道题其实和多校的Snowy Smile（题文无关）挺像的。</p>
<p>需要转化条件。正方形全部位于坐标系第一象限的平分线上，可以表示为$(l,r)$这种形式。一个在正方形内的点$(x,y)$(假设$x &lt; y$,由于这个题目的特性，不满足时可以直接调换)满足的条件为</p>
<p>$$l \leq x \leq y \leq r$$</p>
<p>由此，这道题就变成了二维偏序。本来的本来，上个长得像树状数组一类的东西就解决了。</p>
<p>将点按照第一维排序，从大到小枚举，在数据结构中维护结尾到r的前缀和最大值，并查询，更新全局答案。不过这个题目还要求权值要减去正方形边长w。</p>
<p>$$f(r)-(r-l)=l+[f(r)-r]$$</p>
<p>维护最大值，y分开，只在pushup时合在一起。</p>
<p>然后还要离散化……</p>
<h2 id="代码">代码</h2>
<p>这题给我整自闭了，我想用线段树单点修改来魔幻维护我需要的数据，加加减减。结果发现2种维护方式都有无法解决的问题。最后只能打tag。</p>
<p>线段树维护$f(n)$为到$n$为止的前缀和。每次加点以$x$为组，对已有点减去新增线段的长度，再加上新点的影响。那么在线段树上维护的就是答案。取出最大值即可。</p>
<p>代码写得又长又丑，不过过了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">500010</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">tag</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">dMax</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dy</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
    <span class="n">dy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="k">return</span><span class="p">;</span>
    <span class="n">tag</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">tag</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">dMax</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">dMax</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">+=</span><span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

    <span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dMax</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">&gt;</span><span class="n">dMax</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]){</span>
        <span class="n">dMax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">dMax</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
        <span class="n">dy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">dy</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">dMax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">dMax</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
        <span class="n">dy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">dy</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="n">dMax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">R</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="n">collect</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">first</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="k">return</span> <span class="nf">make_pair</span><span class="p">(</span><span class="n">dMax</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">dy</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">pushdown</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">R</span><span class="p">);</span>
    
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">res</span><span class="o">=</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="mh">0x3f3f3f3f</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]));</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="nc">Point</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">;</span>
<span class="p">}</span> <span class="n">points</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">nums</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="cm">/*
</span><span class="cm">    build(root,1,10);
</span><span class="cm">    int opt;
</span><span class="cm">    while(cin&gt;&gt;opt){
</span><span class="cm">        if(opt==1){
</span><span class="cm">            int l,r,x;cin&gt;&gt;l&gt;&gt;r&gt;&gt;x;
</span><span class="cm">            modify(l,r,x,1,10,root);
</span><span class="cm">        }
</span><span class="cm">        if(opt==2){
</span><span class="cm">            int l,r;cin&gt;&gt;l&gt;&gt;r;
</span><span class="cm">            cout&lt;&lt;query(l,r,1,10,root).first&lt;&lt;&#34; &#34;&lt;&lt;query(l,r,1,10,root).second&lt;&lt;endl;
</span><span class="cm">        }
</span><span class="cm">    }
</span><span class="cm">    */</span>
    

    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Point</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="n">swap</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">nums</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">nums</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">nums</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">rit</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">nums</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">rit</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
        <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">rit</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">points</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">points</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nlen</span><span class="p">,[](</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="o">!=</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">rit</span><span class="o">-</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">len</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">lastit</span><span class="o">=</span><span class="n">rit</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ans</span><span class="o">=</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="mh">0x3f3f3f3f</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">pairl</span><span class="o">=-</span><span class="mh">0x3f3f3f3f</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">thisx</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
        <span class="c1">//auto it=lower_bound(nums.begin(),rit,points[i].x);
</span><span class="c1"></span>        <span class="k">auto</span> <span class="n">it</span><span class="o">=</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="n">thisx</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(;</span><span class="n">lastit</span><span class="o">!=</span><span class="n">it</span><span class="p">;</span><span class="n">lastit</span><span class="o">--</span><span class="p">){</span>
            <span class="n">modify</span><span class="p">(</span><span class="n">lastit</span><span class="o">-</span><span class="n">nums</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">len</span><span class="p">,</span><span class="o">*</span><span class="p">(</span><span class="n">lastit</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-*</span><span class="n">lastit</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
            <span class="c1">//cout&lt;&lt;&#34;cost &#34;&lt;&lt;*(lastit-1)-*lastit&lt;&lt;&#34; from &#34;&lt;&lt;lastit-nums.begin()&lt;&lt;&#34; to &#34;&lt;&lt;len&lt;&lt;endl;
</span><span class="c1"></span>        <span class="p">}</span>
        <span class="cm">/*
</span><span class="cm">        for(int j=0;j&lt;=len;j++){
</span><span class="cm">            cout&lt;&lt;query(j,j,0,len,root).first&lt;&lt;&#34;\t&#34;;
</span><span class="cm">        }
</span><span class="cm">        cout&lt;&lt;endl;
</span><span class="cm">        */</span>
        <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span> <span class="o">&amp;&amp;</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">==</span><span class="n">thisx</span><span class="p">){</span>
            <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">modify</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
            <span class="c1">//cout&lt;&lt;&#34;add &#34;&lt;&lt;p.w&lt;&lt;&#34; from &#34;&lt;&lt;p.y&lt;&lt;&#34; to &#34;&lt;&lt;len&lt;&lt;endl;
</span><span class="c1"></span>            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">--</span><span class="p">;</span>
        <span class="cm">/*
</span><span class="cm">        for(int j=0;j&lt;=len;j++){
</span><span class="cm">            auto temp2=query(j,j,0,len,root);
</span><span class="cm">            cout&lt;&lt;temp2.first&lt;&lt;&#34;,&#34;&lt;&lt;temp2.second&lt;&lt;&#34;\t&#34;;
</span><span class="cm">        }
</span><span class="cm">        cout&lt;&lt;endl;
</span><span class="cm">        */</span>

        <span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">temp</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="o">&lt;=</span><span class="n">temp</span><span class="p">){</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">temp</span><span class="p">;</span>
            <span class="n">pairl</span><span class="o">=</span><span class="n">nums</span><span class="p">[</span><span class="n">thisx</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">first</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="p">.</span><span class="n">first</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">pairl</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;</span><span class="n">pairl</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;</span><span class="n">nums</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">second</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;</span><span class="n">nums</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">second</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;*</span><span class="n">nums</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;*</span><span class="n">nums</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;*</span><span class="n">nums</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="s">&#34; &#34;</span><span class="o">&lt;&lt;*</span><span class="n">nums</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">使用Mathematica绘制股票相关曲线</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/mathematica-in-stocks/" />
            <id>https://blog.kanari.moe/code/mathematica-in-stocks/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-09-20T09:33:52+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[Mathematica是个好东西。虽然早有耳闻功能强大，但是没想到强大到这种地步。 原……]]></summary>
            
                <content type="html"><![CDATA[<p>Mathematica是个好东西。虽然早有耳闻功能强大，但是没想到强大到这种地步。</p>
<p>原本因为课程原因，研究了一下如何在Mathematica里绘制股票数据。不过现在<strong>停止</strong>，只完成了一小部分。剩下的……想折腾的话，按照已经有的代码，能容易改出来其他功能。</p>
<h2 id="数据来源">数据来源</h2>
<p>首先要说的是，Mathematica中<strong>自行提供</strong>了非权威的金融数据。这对我们很方便。</p>
<p>使用命令<code>FinancialData</code>,就可以获取大量需要的数据。具体可以查看文档。不过问题是，不知何种原因，该函数对深沪股票支持很差，所以在实际使用时，并不能直接使用该函数，比较可惜……</p>
<p>我们需要实现自己的数据处理。</p>
<p>经过一番寻找后，我发现了一个基于Python的证券数据平台<code>baostock</code>。经过简单的封装后，Mathematica就可以使用Python从平台上拉取数据了。</p>
<p>这个例子只能拉取日K。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mathematica" data-lang="mathematica"><span class="w">
</span><span class="w"></span><span class="n">BeginPackage</span><span class="p">[</span><span class="s">&#34;StockLink`&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">StockLink</span><span class="err">::</span><span class="n">usage</span><span class="o">=</span><span class="s">&#34;StockLink&#34;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">CloseLink</span><span class="err">::</span><span class="n">usage</span><span class="o">=</span><span class="s">&#34;CloseLink&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">DailyKLine</span><span class="err">::</span><span class="n">usage</span><span class="o">=</span><span class="s">&#34;Get KLine data&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">CandlestickData</span><span class="err">::</span><span class="n">usage</span><span class="o">=</span><span class="s">&#34;adjust KLine data to fit Candlestick Chart&#34;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">TradingChartData</span><span class="err">::</span><span class="n">usage</span><span class="o">=</span><span class="s">&#34;adjust KLine data to fit Trading Chart&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">Begin</span><span class="p">[</span><span class="s">&#34;`Private`&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">StockLink</span><span class="p">[]</span><span class="o">:=</span><span class="n">Module</span><span class="p">[{</span><span class="n">conn</span><span class="p">},</span><span class="w">
</span><span class="w"></span><span class="n">conn</span><span class="o">=</span><span class="n">StartExternalSession</span><span class="p">[</span><span class="s">&#34;Python&#34;</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="n">ExternalEvaluate</span><span class="p">[</span><span class="n">conn</span><span class="p">,</span><span class="err">&#34;</span><span class="w">
</span><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">baostock</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">bs</span><span class="w">
</span><span class="w"></span><span class="n">lg</span><span class="o">=</span><span class="n">bs</span><span class="err">.</span><span class="n">login</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="err">&#34;</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="n">conn</span><span class="w">
</span><span class="w"></span><span class="p">];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">CloseLink</span><span class="p">[</span><span class="nv">conn_</span><span class="p">]</span><span class="o">:=</span><span class="n">Module</span><span class="p">[{},</span><span class="w">
</span><span class="w"></span><span class="n">ExternalEvaluate</span><span class="p">[</span><span class="n">conn</span><span class="p">,</span><span class="err">&#34;</span><span class="w">
</span><span class="w"></span><span class="n">bs</span><span class="err">.</span><span class="n">logout</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="err">&#34;</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="n">DeleteObject</span><span class="p">[</span><span class="n">conn</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="p">];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">MMAListToPythonList</span><span class="p">[</span><span class="nv">list_</span><span class="p">]</span><span class="o">:=</span><span class="n">StringReplace</span><span class="p">[</span><span class="n">ToString</span><span class="p">[</span><span class="n">list</span><span class="p">,</span><span class="n">InputForm</span><span class="p">],{</span><span class="s">&#34;\&#34;</span><span class="w"> </span><span class="s">&#34;-&gt;&#34;</span><span class="err">&#39;</span><span class="s">&#34;,&#34;</span><span class="p">{</span><span class="s">&#34;-&gt;&#34;</span><span class="p">[</span><span class="s">&#34;,&#34;</span><span class="p">}</span><span class="s">&#34;-&gt;&#34;</span><span class="p">]</span><span class="err">&#34;</span><span class="p">}];</span><span class="w">
</span><span class="w"></span><span class="n">DateObjectToStr</span><span class="p">[</span><span class="nv">date_</span><span class="p">]</span><span class="o">:=</span><span class="n">DateString</span><span class="p">[</span><span class="n">date</span><span class="p">,</span><span class="s">&#34;ISODate&#34;</span><span class="p">];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">DailyKLine</span><span class="p">[</span><span class="nv">conn_</span><span class="p">,</span><span class="nv">code_</span><span class="p">,</span><span class="nv">startDate_</span><span class="p">,</span><span class="nv">endDate_</span><span class="p">]</span><span class="o">:=</span><span class="n">Module</span><span class="p">[{},</span><span class="w">
</span><span class="w"></span><span class="n">raw</span><span class="o">=</span><span class="n">ExternalEvaluate</span><span class="p">[</span><span class="n">conn</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">StringTemplate</span><span class="p">[</span><span class="err">&#34;</span><span class="w">
</span><span class="w"></span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bs</span><span class="err">.</span><span class="nv">query_history_k_data_plus</span><span class="p">(</span><span class="err">&#39;``&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="err">&#39;</span><span class="n">date</span><span class="p">,</span><span class="n">open</span><span class="p">,</span><span class="n">high</span><span class="p">,</span><span class="n">low</span><span class="p">,</span><span class="n">close</span><span class="p">,</span><span class="n">preclose</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">amount</span><span class="p">,</span><span class="n">adjustflag</span><span class="p">,</span><span class="n">turn</span><span class="p">,</span><span class="n">tradestatus</span><span class="p">,</span><span class="n">pctChg</span><span class="p">,</span><span class="n">isST</span><span class="err">&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="nv">start_date</span><span class="o">=</span><span class="err">&#39;``&#39;</span><span class="p">,</span><span class="w"> </span><span class="nv">end_date</span><span class="o">=</span><span class="err">&#39;``&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">frequency</span><span class="o">=</span><span class="err">&#39;</span><span class="n">d</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">adjustflag</span><span class="o">=</span><span class="err">&#39;</span><span class="mi">3</span><span class="err">&#39;</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="nv">data_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="n">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="err">.</span><span class="nv">error_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">0</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">rs</span><span class="err">.</span><span class="n">next</span><span class="p">()</span><span class="err">:</span><span class="w">
</span><span class="w">    </span><span class="n">temp</span><span class="o">=</span><span class="n">rs</span><span class="err">.</span><span class="nv">get_row_data</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="nv">data_list</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="err">:</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="nv">data_list</span><span class="err">&#34;</span><span class="p">][</span><span class="n">code</span><span class="p">,</span><span class="n">DateObjectToStr</span><span class="p">[</span><span class="n">startDate</span><span class="p">],</span><span class="n">DateObjectToStr</span><span class="p">[</span><span class="n">endDate</span><span class="p">]]];</span><span class="w">
</span><span class="w"></span><span class="n">ToExpression</span><span class="p">[</span><span class="nv">#</span><span class="p">]</span><span class="o">&amp;</span><span class="w"> </span><span class="o">/@</span><span class="w"> </span><span class="n">raw</span><span class="w">
</span><span class="w"></span><span class="p">];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">CandlestickData</span><span class="p">[</span><span class="nv">raw_</span><span class="p">]</span><span class="o">:=</span><span class="n">Table</span><span class="p">[{</span><span class="n">DateObject</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">raw</span><span class="p">[</span><span class="n">key</span><span class="p">][[</span><span class="mi">1</span><span class="o">;;</span><span class="mi">4</span><span class="p">]]},{</span><span class="n">key</span><span class="p">,</span><span class="n">Keys</span><span class="p">[</span><span class="n">raw</span><span class="p">]}];</span><span class="w">
</span><span class="w"></span><span class="n">TradingChartData</span><span class="p">[</span><span class="nv">raw_</span><span class="p">]</span><span class="o">:=</span><span class="n">Table</span><span class="p">[{</span><span class="n">DateObject</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">raw</span><span class="p">[</span><span class="n">key</span><span class="p">][[</span><span class="mi">1</span><span class="o">;;</span><span class="mi">5</span><span class="p">]]},{</span><span class="n">key</span><span class="p">,</span><span class="n">Keys</span><span class="p">[</span><span class="n">raw</span><span class="p">]}];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">End</span><span class="p">[]</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">EndPackage</span><span class="p">[]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="图表绘制">图表绘制</h2>
<p>在实际使用时，首先需要导入该库，并且初始化链接后，灵活组合各部分功能即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mathematica" data-lang="mathematica"><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">NotebookDirectory</span><span class="p">[]</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">&#34;StockLink.wl&#34;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StockLink</span><span class="p">[];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="err">:例如获取某个日期区间内的数据并转化，绘制交互图标:</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">DailyKLine</span><span class="p">[</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;ss.000001&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Today</span><span class="p">,</span><span class="w"> </span><span class="n">Today</span><span class="p">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">TradingChartData</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">InteractiveTradingChart</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>输入日期时，可以直接按<code>ctrl+=</code>，在框中描述时间，比较方便。</p>
<h2 id="可能遇到的问题">可能遇到的问题</h2>
<p>如果python配置不对的话，可能会出现Mathematica找不到python。问题的解决方法在官方文档上非常清晰。</p>
<p>不过我不折腾股票，就这样了。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">一些筛法的题</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/some-sieve/" />
            <id>https://blog.kanari.moe/study/some-sieve/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-09-05T20:22:11+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<h2 id="技巧">技巧</h2>
<h3 id="自然溢出">自然溢出</h3>
<ul>
<li>自然溢出不会影响低位数据,所以有的时候你不需要取模,而是一个unsigned.</li>
</ul>
<h3 id="除法取模">除法取模</h3>
<p>对于式子</p>
<p>$$
\frac {a \times b}{c} \mod p \equiv \frac{a \times b \mod cp}{c}
$$</p>
<h2 id="细节">细节</h2>
<ul>
<li>注意数据类型,例如<code>6*(ll)(1&lt;&lt;30)</code>是要出问题的</li>
<li>注意函数在$f(1)$位置的取值,不要忘记初始化</li>
</ul>
<h2 id="单点phi的求解">单点$\phi$的求解</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">ll</span> <span class="nf">euler_phi</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ll</span> <span class="n">m</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
    <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">n</span> <span class="o">/=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="divisor">Divisor</h2>
<p>Given $n$ and $m$ ($1 \leq n,m \leq 5 \times 10^4$),  please calculate</p>……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="技巧">技巧</h2>
<h3 id="自然溢出">自然溢出</h3>
<ul>
<li>自然溢出不会影响低位数据,所以有的时候你不需要取模,而是一个unsigned.</li>
</ul>
<h3 id="除法取模">除法取模</h3>
<p>对于式子</p>
<p>$$
\frac {a \times b}{c} \mod p \equiv \frac{a \times b \mod cp}{c}
$$</p>
<h2 id="细节">细节</h2>
<ul>
<li>注意数据类型,例如<code>6*(ll)(1&lt;&lt;30)</code>是要出问题的</li>
<li>注意函数在$f(1)$位置的取值,不要忘记初始化</li>
</ul>
<h2 id="单点phi的求解">单点$\phi$的求解</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">ll</span> <span class="nf">euler_phi</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ll</span> <span class="n">m</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
    <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">n</span> <span class="o">/=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="divisor">Divisor</h2>
<p>Given $n$ and $m$ ($1 \leq n,m \leq 5 \times 10^4$),  please calculate</p>
<h3 id="分析">分析</h3>
<p>下面所有的除法都是舍去小数的整除.</p>
<p>$$
\begin{aligned}
\sum_{i=1}^n\sum_{j=1}^m \sigma_0(ij) &amp;= \sum_{i=1}^n\sum_{j=1}^m \sum_{p|i}\sum_{q|j}[p \perp q] \<br>
&amp;=\sum_{i=1}^n\sum_{j=1}^m \sum_{p|i}\sum_{q|j}\sum_{d|(p,q)}\mu(d) \<br>
&amp;=\sum_{i=1}^n\sum_{j=1}^m \sum_{p|i}\sum_{q|j}\sum_{d}\mu(d)[d|p][d|q] \<br>
&amp;=\sum_d \mu(d)\sum_{i=1}^n\sum_{j=1}^m \sum_{pd} \sum_{qd}[pd|i][qd|j] \<br>
&amp;=\sum_d \mu(d) \sum_{pd} \sum_{qd}\sum_{i=1}^{n/pd}\sum_{j=1}^{m/qd} \<br>
&amp;=\sum_d \mu(d) \sum_{pd} \sum_{qd} \frac n {pd}\frac m {qd} \<br>
&amp;=\sum_d \mu(d) \sum_p^{n/d} \frac n {pd} \sum_q^{m/d} \frac m {qd} \<br>
\end{aligned}
$$</p>
<p>设$S(n)=\sum_{1\leq i \leq n} \frac n i$</p>
<p>$$
\begin{aligned}
\sum_{i=1}^n\sum_{j=1}^m \sigma_0(ij) &amp;=\sum_d \mu(d)S(n/d)S(m/d)
\end{aligned}
$$</p>
<p>$n/d$的取值在一个区间中是相同的,因此可以把这个求和公式分块计算.(在分块后,需要获知该段区域内$\mu$的和,所以需要求前缀和)由于$n/d$的取值为$O(\sqrt n)$的级别,因此在知道$S$的值的情况下,每个询问可以这个复杂度中计算出来.</p>
<p>对于$\mu$,使用筛法,并求出其前缀和.</p>
<p>对于$S$,直接暴力计算.</p>
<h3 id="代码">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">50010</span><span class="p">;</span>

<span class="kt">bool</span> <span class="n">isn_p</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">mu</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">premu</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">init_prime</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
    <span class="n">isn_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">len</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isn_p</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
            <span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">primes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">len</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">isn_p</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">premu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">len</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">premu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">premu</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>


<span class="n">ll</span> <span class="n">S</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">init_S</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">len</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">;</span><span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
	        <span class="c1">//remember this line
</span><span class="c1"></span>            <span class="n">r</span><span class="o">=</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">l</span><span class="p">);</span>
            <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="p">(</span><span class="n">ll</span><span class="p">)(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">l</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">init_prime</span><span class="p">(</span><span class="mi">50000</span><span class="p">);</span>
    <span class="n">init_S</span><span class="p">(</span><span class="mi">50000</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="c1">// the minimum one will fastly approach to 0, leading the extra parts of bigger one do nothing to the answer.
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">minn</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">minn</span><span class="p">;</span><span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">r</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">),</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">));</span>
            <span class="n">ans</span><span class="o">+=</span><span class="n">S</span><span class="p">[</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">S</span><span class="p">[</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">premu</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">premu</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="table">table</h2>
<p>给出多组$n,m,a$,求</p>
<p>$$
\sum_{i=1}^n \sum_{j=1}^m \sigma_1((i,j))[\sigma_1((i,j)) \geq a]
$$</p>
<h3 id="分析-1">分析</h3>
<blockquote>
<p>这道题让谁都能看出来重点是如何处理条件</p>
<p>$$[\sigma_1((i,j)) \geq a]$$</p>
</blockquote>
<p>可是这我显然不知道该怎么做.</p>
<p>对询问作以$a$从小到大离线处理,询问前先处理新增$a$的影响.</p>
<p>在已经满足条件的前提下对公式作化简.</p>
<p>$$
\begin{aligned}
\sum_{i=1}^n \sum_{j=1}^m \sigma_1((i,j)) &amp;= \sum_d \sum_{i=1}^n \sum_{j=1}^m \sigma_1(d)[(i,j)=d] \<br>
&amp;=\sum_d \sum_{i\leq \frac nd}\sum_{j\leq \frac md}\sigma_1(d)[(i,j)=1] \<br>
&amp;=\sum_d \sum_{i\leq \frac n{td}}\sum_{j\leq \frac m{td}}\sigma_1(d) \sum_t \mu(t) \<br>
&amp;=\sum_d \sum_t \mu(t) \sigma_1(d)  \sum_{i\leq \frac n{td}}\sum_{j\leq \frac m{td}} 1 \<br>
&amp;=\sum_T \lfloor \frac nT \rfloor \lfloor \frac mT \rfloor \sum_{d|T}\mu(t)\sigma_1(\frac Td)
\end{aligned}
$$</p>
<p>可以看到还是套路,引入d,引入$\mu$,之后胡乱化简.</p>
<p>按照这个式子,需要计算的就是$g(x)=\sum_{d|T}\mu(t)\sigma_1(\frac Td)$的前缀和.</p>
<p>接下来是如何处理条件...</p>
<p>当$a$每扩大一点,就有一部分$\mu(t)\sigma_1(\frac Td)$被加入到函数$g$的各个部分.使用一种数据结构来维护$g$的前缀和,例如树状数组.$a$最大到,每次受到影响的就是$d$的倍数,以此可以计算出总的时间复杂度为</p>
<p>$$
WTF
$$</p>
<p>至此,问题就解决了.</p>
<h3 id="代码-1">代码</h3>
<p>又丑又长.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXQ</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXFT</span><span class="o">=</span><span class="mi">400010</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">P</span><span class="o">=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">31</span><span class="p">;</span>


<span class="n">ll</span> <span class="n">FT</span><span class="p">[</span><span class="n">MAXFT</span><span class="p">];</span>
<span class="n">ll</span> <span class="nf">lowbit</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">&amp;-</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">ftadd</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">pos</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">)){</span>
        <span class="n">FT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">FT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">ftget</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">pos</span><span class="p">;</span><span class="n">i</span><span class="p">;</span><span class="n">i</span><span class="o">-=</span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">)){</span>
        <span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="n">FT</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">is_np</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">sigma</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">mu</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">t</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Sig</span><span class="p">{</span>
    <span class="n">ll</span> <span class="n">sigma</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">Sig</span><span class="p">(){}</span>
    <span class="n">Sig</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">ll</span> <span class="n">sigma</span><span class="p">)</span><span class="o">:</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">sigma</span><span class="p">(</span><span class="n">sigma</span><span class="p">){}</span>
<span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Sig</span><span class="o">&gt;</span> <span class="n">sigma_vec</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">is_np</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is_np</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
            <span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">primes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">is_np</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">sigma</span><span class="p">[</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">qpow</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="o">*</span><span class="p">((</span><span class="n">ll</span><span class="p">)</span><span class="mi">1</span><span class="o">-</span><span class="n">qpow</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">],(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
                <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">sigma_vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Sig</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">Q</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">ll</span> <span class="n">ans</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">qs</span><span class="p">[</span><span class="n">MAXQ</span><span class="p">];</span>

<span class="n">ll</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">ftget</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">curidx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">mergea</span><span class="p">(</span><span class="kt">int</span> <span class="n">newa</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">curidx</span><span class="o">&lt;</span><span class="n">sigma_vec</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">curidx</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Sig</span> <span class="o">&amp;</span><span class="n">sig</span><span class="o">=</span><span class="n">sigma_vec</span><span class="p">[</span><span class="n">curidx</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">sigma</span><span class="o">&gt;</span><span class="n">newa</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">sig</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="n">sig</span><span class="p">.</span><span class="n">x</span><span class="p">){</span>
            <span class="n">ftadd</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">sig</span><span class="p">.</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="n">sig</span><span class="p">.</span><span class="n">sigma</span><span class="o">%</span><span class="n">P</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">init</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">sigma_vec</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">sigma_vec</span><span class="p">.</span><span class="n">end</span><span class="p">(),[](</span><span class="n">Sig</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="n">Sig</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">sigma</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">sigma</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="kt">int</span> <span class="n">qlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">qlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Q</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">=</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">.</span><span class="n">m</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
        <span class="n">q</span><span class="p">.</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span><span class="n">qs</span><span class="o">+</span><span class="n">qlen</span><span class="p">,[](</span><span class="n">Q</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Q</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">=</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
        <span class="n">ll</span> <span class="o">&amp;</span><span class="n">ans</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">mergea</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">);</span><span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">r</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">),</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">));</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">+</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        
    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span><span class="n">qs</span><span class="o">+</span><span class="n">qlen</span><span class="p">,[](</span><span class="n">Q</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%lld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ans</span><span class="o">%</span><span class="n">P</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="product">product</h2>
<p>定义斐波纳妾(?)(linux这输入法够魔性)函数$f(x)$</p>
<p>求</p>
<p>$$
\prod_{i=1}^n \prod_{j=1}^m f((i,j))
$$</p>
<h3 id="分析-2">分析</h3>
<p>首先,先引个$d$是没错了.</p>
<p>但是</p>
<p>这道题,我又不会.我不知道该怎么处理$\prod$...蔡就完事了.</p>
<p>现在来看,当引入一个$d$后,在该求积公式里出现了相同项相乘.将该部分的计算调整为幂,剩下的就又都一样了.</p>
<p>$$
\begin{aligned}
\prod_{i=1}^n \prod_{j=1}^m f((i,j)) &amp;= \prod_d f(d)^{\sum_{i\leq n} \sum_{j \leq m} [(i,j)=d]} \<br>
&amp;=\prod_d f(d)^{\sum_{i\leq \frac nd} \sum_{j \leq \frac md} [(i,j)=1]} \<br>
&amp;=\prod_d f(d)^{\sum_t \mu(t) \sum_{i\leq \frac n{td}} \sum_{j \leq \frac m{td}} 1 } \<br>
&amp;=\prod_d \prod_t f(d)^{\mu(t) \sum_{i\leq \frac n{td}} \sum_{j \leq \frac m{td}} 1 } \<br>
&amp;=\prod_T (\prod_{d|T}  f(d)^{\mu(\frac Tt)})^{\lfloor \frac nT \rfloor \lfloor \frac mT \rfloor }
\end{aligned}
$$</p>
<p>设$g(x)=\prod_{d|T}  f(d)^{\mu(\frac Tt)}$,求前缀和就完事了.</p>
<blockquote>
<p>这道题需要使用<strong>欧拉定理</strong>来优化求幂的速度.</p>
</blockquote>
<h3 id="欧拉定理">欧拉定理</h3>
<p>当$(a,p)=1$,有以下式子</p>
<p>$$
a^b \equiv a^{b \mod \phi(p)} \pmod p
$$</p>
<p>当$(a,p)\neq 1$,有扩展欧拉定理</p>
<p>$$
a^b \equiv a^{b \mod \phi(p)+ \phi(p)} \pmod p
$$</p>
<p>根据这2个式子,可以在快速降幂,来加快运算.</p>
<h3 id="代码-2">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1000010</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">P</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">b</span><span class="p">;</span><span class="n">b</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="o">*</span><span class="n">a</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">get_inv</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">p</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">qpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">is_np</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">inv_f</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">preg</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">inv_pg</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">mu</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">is_np</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is_np</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
            <span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">primes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">is_np</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">inv_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">get_inv</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">+=</span><span class="n">i</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">j</span><span class="o">/</span><span class="n">i</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">inv_f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">j</span><span class="o">/</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
            <span class="c1">//when mu==0,nothing happens
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">preg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
    <span class="n">inv_pg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">inv_pg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">get_inv</span><span class="p">(</span><span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">)</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">init</span><span class="p">(</span><span class="mi">1000000</span><span class="p">);</span>
    <span class="c1">//cout&lt;&lt;&#34;done&#34;&lt;&lt;endl;
</span><span class="c1"></span>    <span class="cm">/*
</span><span class="cm">    
</span><span class="cm">    for(auto i:primes){
</span><span class="cm">        cout&lt;&lt;i&lt;&lt;&#34; &#34;;
</span><span class="cm">    }
</span><span class="cm">    cout&lt;&lt;endl;
</span><span class="cm">    
</span><span class="cm">    for(int i=1;i&lt;=20;i++){
</span><span class="cm">        cout&lt;&lt;g[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">    }
</span><span class="cm">    cout&lt;&lt;endl;
</span><span class="cm">    */</span>
    

    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">kase</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="n">ll</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;</span><span class="n">m</span><span class="p">)</span><span class="n">swap</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">);</span>

        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">r</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">),</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">));</span>
            <span class="n">ll</span> <span class="n">sum</span><span class="o">=</span><span class="n">preg</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">*</span><span class="n">inv_pg</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">*</span><span class="n">qpow</span><span class="p">(</span><span class="n">sum</span><span class="p">,(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">P</span><span class="p">)</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%lld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="phi3">phi3</h2>
<p>给出$n$,求</p>
<p>$$
(\sum_{i=1}^n\sum_{j=1}^n\sum_{k=1}^n \frac {\phi(i)\phi(j^2)\phi(k^3)}{\phi(i)\phi(j)\phi(k)} \phi((i,j,k))) \mod 2^{30}
$$</p>
<h3 id="分析-3">分析</h3>
<p>这道题重点在于</p>
<p>$$\frac {\phi(i)\phi(j^2)\phi(k^3)}{\phi(i)\phi(j)\phi(k)}$$</p>
<p>这堆东西的化简.很显然,我又不会.</p>
<p>观察$\phi(n)$的公式</p>
<p>$$
\phi(n)=n\prod_i(1-\frac 1{\phi(i)})
$$</p>
<p>可以得出上面那一堆等于$jk^2$.剩下的就又都一样了.</p>
<p>$$
\begin{aligned}
\sum_{i=1}^n\sum_{j=1}^n\sum_{k=1}^n jk^2 \phi((i,j,k)) &amp;=\sum_d\sum_{i=1}^n\sum_{j=1}^n\sum_{k=1}^n jk^2 \phi(d)[(i,j,k)=d] \<br>
&amp;=\sum_d \sum_{t} \phi(d) \mu(t) t^3d^3 \sum_{i\leq \frac n{td}}\sum_{j \leq \frac n{td}}\sum_{k \leq \frac n{td}} jk^2 \<br>
&amp;=\sum_T \sum_{i\leq \frac nT}\sum_{j \leq \frac nT} j\sum_{k \leq \frac nT}k^2 (T^3 \sum_{d|T} \phi(d) \mu(\frac Td))
\end{aligned}
$$</p>
<p>设$g(n)=\sum_{d|T} \phi(d) \mu(\frac Td)$,直接筛.最后计算前缀和的时候再乘上$n^3$就可以了.</p>
<blockquote>
<p>这道题的取模还有这种处理方法: 直接取数组为<code>unsigned</code>并自然溢出.<strong>二进制后30位</strong>不会受到影响.</p>
</blockquote>
<h3 id="代码-3">代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ull</span><span class="o">=</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">10000010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">30</span><span class="p">;</span>

<span class="kt">bool</span> <span class="n">isnp</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primes</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">t</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="n">Mt</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="n">g</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">preg</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="n">isnp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isnp</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
            <span class="n">primes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>

            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">Mt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">primes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">newone</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="n">isnp</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">g</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
            <span class="n">t</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">M</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">Mt</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">t</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">Mt</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">Mt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
                
                <span class="n">g</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">Mt</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">Mt</span><span class="p">[</span><span class="n">newone</span><span class="p">]</span><span class="o">+</span><span class="n">Mt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Mt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">P</span><span class="o">*</span><span class="n">i</span><span class="o">%</span><span class="n">P</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
        <span class="n">preg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%=</span><span class="n">P</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">init</span><span class="p">(</span><span class="mi">10000000</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">kase</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
            <span class="n">r</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">);</span>
            <span class="n">ull</span> <span class="n">lim</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="p">;</span>
            <span class="n">ull</span> <span class="n">sum1</span><span class="o">=</span><span class="n">lim</span><span class="o">*</span><span class="p">(</span><span class="n">lim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">P</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
            <span class="n">ull</span> <span class="n">sum2</span><span class="o">=</span><span class="n">lim</span><span class="o">*</span><span class="p">(</span><span class="n">lim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">lim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">P</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">;</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">+</span><span class="n">lim</span><span class="o">*</span><span class="n">sum1</span><span class="o">%</span><span class="n">P</span><span class="o">*</span><span class="n">sum2</span><span class="o">%</span><span class="n">P</span><span class="o">*</span><span class="p">(</span><span class="n">preg</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">preg</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%lld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">ans</span><span class="o">%</span><span class="n">P</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[HDU 6704] Kth Occurrence</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/hdu-6704-kth-occurrence/" />
            <id>https://blog.kanari.moe/code/hdu-6704-kth-occurrence/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-25T15:11:37+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>You are given a string S consisting of only lowercase english letters and some queries.</p>
<p>For each query (l,r,k), please output the starting position of the k-th occurence of the substring SlSl+1...Sr in S.</p>
<h2 id="分析">分析</h2>
<p>第一个问题是快速找出所有出现的子串的位置,可以使用后缀数组.这些字串出现在sa的一个连续的区间中.</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>You are given a string S consisting of only lowercase english letters and some queries.</p>
<p>For each query (l,r,k), please output the starting position of the k-th occurence of the substring SlSl+1...Sr in S.</p>
<h2 id="分析">分析</h2>
<p>第一个问题是快速找出所有出现的子串的位置,可以使用后缀数组.这些字串出现在sa的一个连续的区间中.</p>
<p>第二个问题是找出这些出现位置中的第k大,可以使用主席树,以sa建树.</p>
<h2 id="代码">代码</h2>
<p>思路清晰,但这代码它不好写</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">100060</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ull</span><span class="o">=</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">sa</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">SA</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
        <span class="n">sa</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">--</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
            <span class="n">y</span><span class="p">[</span><span class="o">++</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">y</span><span class="p">[</span><span class="o">++</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
            <span class="n">sa</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span><span class="o">--</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">x</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">];</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">x</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">];</span>
            <span class="n">y</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="nl">p</span> <span class="p">:</span> <span class="o">++</span><span class="n">p</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">tot</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">sum</span><span class="p">[(</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">rt</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">ls</span><span class="p">[(</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span>
    <span class="n">rs</span><span class="p">[(</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">//建树
</span><span class="c1"></span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">root</span> <span class="o">=</span> <span class="o">++</span><span class="n">tot</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">ls</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">);</span>
    <span class="n">rs</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">root</span><span class="p">;</span> <span class="c1">//返回该子树的根节点
</span><span class="c1"></span><span class="p">}</span>
<span class="kt">int</span> <span class="nf">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="c1">//插入操作
</span><span class="c1"></span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">dir</span> <span class="o">=</span> <span class="o">++</span><span class="n">tot</span><span class="p">;</span>
    <span class="n">ls</span><span class="p">[</span><span class="n">dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">root</span><span class="p">],</span> <span class="n">rs</span><span class="p">[</span><span class="n">dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">root</span><span class="p">],</span> <span class="n">sum</span><span class="p">[</span><span class="n">dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dir</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span>
        <span class="n">ls</span><span class="p">[</span><span class="n">dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">dir</span><span class="p">]);</span>
    <span class="k">else</span>
        <span class="n">rs</span><span class="p">[</span><span class="n">dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rs</span><span class="p">[</span><span class="n">dir</span><span class="p">]);</span>
    <span class="k">return</span> <span class="n">dir</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//left root, right root, querying l,r, the k-th
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="c1">//查询操作
</span><span class="c1"></span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sum</span><span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="n">v</span><span class="p">]]</span> <span class="o">-</span> <span class="n">sum</span><span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="n">u</span><span class="p">]];</span> <span class="c1">//通过区间减法得到左儿子的信息
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">l</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="c1">//说明在左儿子中
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
    <span class="k">else</span> <span class="c1">//说明在右儿子中
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">rs</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">height</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">st</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">get_height</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">--</span><span class="n">k</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">])</span> <span class="o">++</span><span class="n">k</span><span class="p">;</span>
        <span class="n">height</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">build_st</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">19</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">st</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">lcp</span><span class="p">(</span><span class="kt">int</span> <span class="n">ll</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ll</span><span class="p">],</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="n">sa</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">qlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="o">&gt;&gt;</span><span class="n">qlen</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">n</span><span class="o">=</span><span class="n">nlen</span><span class="p">;</span>
        <span class="n">SA</span><span class="p">();</span>
        <span class="n">n</span><span class="o">=</span><span class="n">nlen</span><span class="p">;</span>

        <span class="n">get_height</span><span class="p">();</span>
        <span class="n">build_st</span><span class="p">();</span>
        
        <span class="cm">/*
</span><span class="cm">        for(int i=1;i&lt;=nlen;i++)cout&lt;&lt;sa[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">        cout&lt;&lt;endl;
</span><span class="cm">        for(int i=1;i&lt;=nlen;i++)cout&lt;&lt;x[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">        cout&lt;&lt;endl;
</span><span class="cm">        */</span>

        <span class="n">tot</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
        <span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlen</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlen</span><span class="p">,</span> <span class="n">rt</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>

        <span class="k">while</span><span class="p">(</span><span class="n">qlen</span><span class="o">--</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">qk</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ql</span><span class="p">,</span><span class="o">&amp;</span><span class="n">qr</span><span class="p">,</span><span class="o">&amp;</span><span class="n">qk</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">sublen</span><span class="o">=</span><span class="n">qr</span><span class="o">-</span><span class="n">ql</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">ex_l</span><span class="p">,</span><span class="n">ex_r</span><span class="p">;</span>
            <span class="c1">//binary search
</span><span class="c1"></span>            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">ql</span><span class="p">];</span>
                <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
                    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">lcp</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">ql</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sublen</span><span class="p">){</span>
                        <span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
                    <span class="p">}</span><span class="k">else</span> <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">for</span><span class="p">(</span><span class="n">l</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">;</span><span class="n">l</span><span class="o">++</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">lcp</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">ql</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sublen</span><span class="p">){</span>
                        <span class="n">ex_l</span><span class="o">=</span><span class="n">l</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">ql</span><span class="p">],</span><span class="n">r</span><span class="o">=</span><span class="n">nlen</span><span class="p">;</span>
                <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
                    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">lcp</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">ql</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sublen</span><span class="p">){</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
                    <span class="p">}</span><span class="k">else</span> <span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">for</span><span class="p">(</span><span class="n">r</span><span class="p">;</span><span class="n">r</span><span class="o">&gt;=</span><span class="n">l</span><span class="p">;</span><span class="n">r</span><span class="o">--</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">lcp</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">ql</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sublen</span><span class="p">){</span>
                        <span class="n">ex_r</span><span class="o">=</span><span class="n">r</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1">//cout&lt;&lt;ex_l&lt;&lt;&#34; &#34;&lt;&lt;ex_r&lt;&lt;endl;
</span><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="n">ex_r</span><span class="o">-</span><span class="n">ex_l</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">qk</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;-</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">query</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">ex_l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rt</span><span class="p">[</span><span class="n">ex_r</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlen</span><span class="p">,</span> <span class="n">qk</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">记一个bug (HDU 6703)</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/a-wonderful-bug/" />
            <id>https://blog.kanari.moe/gossip/a-wonderful-bug/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-24T22:28:48+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[You are given an array a1,a2,...,an(∀i∈[1,n],1≤ai≤n). Initially, each element of the array is……]]></summary>
            
                <content type="html"><![CDATA[<p>You are given an array a1,a2,...,an(∀i∈[1,n],1≤ai≤n). Initially, each element of the array is <strong>unique</strong>.</p>
<p>Moreover, there are m instructions.</p>
<p>Each instruction is in one of the following two formats:</p>
<ol>
<li>(1,pos),indicating to change the value of apos to apos+10,000,000;</li>
<li>(2,r,k),indicating to ask the minimum value which is <strong>not equal</strong> to any ai ( 1≤i≤r ) and **not less ** than k.</li>
</ol>
<p>Please print all results of the instructions in format 2.</p>
<h2 id="分析">分析</h2>
<p>这题强制在线.首先1操作相当于删除了这个数.</p>
<p>dalao自闭了一会get到了它的正确做法,我就直接拿来用了.</p>
<p>维护一权值线段树,位置i存其在a中出现的位置.那么当1到r区间内出现位置的最大值超过了r,根据鸽巢原理,至少有一个数未被限制.</p>
<p>加上不小于k的条件,就是k到r中,找到最小的一个r,使得它满足上面的条件,输出这个r.</p>
<h2 id="代码">代码</h2>
<p>一个奇葩的bug...</p>
<p>当使用了fread这种先读完缓冲区再处理的快速读入而删漏了cin时...会显而易见的遇到bug.</p>
<p>但是,因为缓冲区的存在,<strong>小范围数据被快乐的读入了缓冲区,cin并不会实际影响什么</strong>.一旦遇到大范围数据,cin提前读入了接下来的数据,导致第一个缓冲区之外的数据全部出错...</p>
<p>艹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">400000</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">IO</span>
<span class="p">{</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXSIZE</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">MAXSIZE</span><span class="p">],</span> <span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">p2</span><span class="p">;</span>
<span class="cp">#define gc()                                                                 \
</span><span class="cp">    (p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, 1, MAXSIZE, stdin), p1 == p2) \
</span><span class="cp">         ? EOF                                                               \
</span><span class="cp">         : *p1++)
</span><span class="cp"></span><span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rd</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">^</span> <span class="mi">48</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">char</span> <span class="n">pbuf</span><span class="p">[</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">],</span> <span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="n">pbuf</span><span class="p">;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">push</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pp</span> <span class="o">-</span> <span class="n">pbuf</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">pbuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">,</span> <span class="n">stdout</span><span class="p">),</span> <span class="n">pp</span> <span class="o">=</span> <span class="n">pbuf</span><span class="p">;</span>
    <span class="o">*</span><span class="n">pp</span><span class="o">++</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">sta</span><span class="p">[</span><span class="mi">35</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">sta</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="n">x</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">push</span><span class="p">(</span><span class="n">sta</span><span class="p">[</span><span class="o">--</span><span class="n">top</span><span class="p">]</span> <span class="o">+</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span> <span class="c1">// namespace IO
</span><span class="c1">///////////////////////////////////////////////////////////////////////////////////////
</span><span class="c1"></span>
<span class="kt">int</span> <span class="n">dat</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">imax</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">)</span><span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">dat</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">++</span><span class="n">idx</span><span class="p">;</span>
    <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">imax</span><span class="p">(</span><span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">),</span> <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="n">R</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">R</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span>
        <span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>

    <span class="n">collect</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="n">R</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="o">&gt;</span><span class="n">r</span> <span class="o">||</span> <span class="n">R</span><span class="o">&lt;</span><span class="n">l</span> <span class="o">||</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">target</span><span class="p">)</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="o">==</span><span class="n">R</span><span class="p">)</span><span class="k">return</span> <span class="n">L</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">R</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">target</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
    <span class="k">return</span> <span class="o">~</span><span class="n">res</span><span class="o">?</span><span class="nl">res</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">target</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span> <span class="n">qlen</span><span class="p">;</span>
        <span class="n">nlen</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
        <span class="n">qlen</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">nlen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
            <span class="n">a</span><span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlen</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">lastans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">qlen</span><span class="o">--</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">opt</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">pos</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
                <span class="n">pos</span> <span class="o">^=</span> <span class="n">lastans</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="n">num</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">&gt;</span><span class="n">nlen</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
                <span class="n">modify</span><span class="p">(</span><span class="mh">0x3f3f3f3f</span><span class="p">,</span> <span class="n">num</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">num</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlen</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">;</span>
                <span class="n">t2</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
                <span class="n">t3</span><span class="o">=</span><span class="n">IO</span><span class="o">::</span><span class="n">rd</span><span class="p">();</span>
                <span class="c1">//cin &gt;&gt; t2 &gt;&gt; t3;
</span><span class="c1"></span>                <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">^</span> <span class="n">lastans</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">t3</span> <span class="o">^</span> <span class="n">lastans</span><span class="p">;</span>

                <span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nlen</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">lastans</span><span class="o">=</span><span class="p">(</span><span class="o">~</span><span class="n">t</span><span class="o">?</span><span class="nl">t</span><span class="p">:</span><span class="n">nlen</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">OJ的后端</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/backend-of-oj/" />
            <id>https://blog.kanari.moe/code/backend-of-oj/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-22T14:43:39+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>内容有复制和参考。</p>
<p>这篇文章主要用于记录在探索评测系统Reef期间我所学的东西,以便之后查阅.</p>
<p>Reef预计主要支持远程评测</p>
<p>加一点本地评测.....</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>内容有复制和参考。</p>
<p>这篇文章主要用于记录在探索评测系统Reef期间我所学的东西,以便之后查阅.</p>
<p>Reef预计主要支持远程评测</p>
<p>加一点本地评测.....</p>
<p>结果主要的东西都特么是本地评测的.</p>
<h2 id="总体架构">总体架构</h2>
<p>Reef预计将采用seccomp作为第一道安全关卡,使用多线程检测程序耗时/内存等信息.</p>
<p>在外层使用docker封装并再次限制资源,接入队列以能够方便的横向扩展.</p>
<h2 id="seccomp">seccomp</h2>
<p>seccomp为linux系统上才有的安全技术,因此必须使用linux.在安装必要的安装包后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo apt install libseccomp2 libseccomp-dev seccomp
</code></pre></td></tr></table>
</div>
</div><p>即可使用.</p>
<p>当然,在windows下的Jobs似乎也可以利用,但是我不太懂,微软文档写得也奇怪,而且还得是服务器版本的windows才能用.</p>
<h3 id="基本使用">基本使用</h3>
<p>seccomp需要由程序主动加载.其使用方法基本为下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//g++ -g test.c -o o -lseccomp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;seccomp.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;linux/seccomp.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
	<span class="c1">//初始化筛选器
</span><span class="c1"></span>	<span class="n">scmp_filter_ctx</span> <span class="n">ctx</span><span class="p">;</span>
	<span class="n">ctx</span> <span class="o">=</span> <span class="n">seccomp_init</span><span class="p">(</span><span class="n">SCMP_ACT_ALLOW</span><span class="p">);</span><span class="c1">//flag指明默认通过
</span><span class="c1"></span>	<span class="c1">//添加拦截,并指明一旦拦截就将程序kill掉.
</span><span class="c1"></span>	<span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_KILL</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">execve</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
	<span class="c1">//将规则加载注入.
</span><span class="c1"></span>	<span class="n">seccomp_load</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>

	<span class="kt">char</span> <span class="o">*</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#34;/bin/sh&#34;</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="nb">NULL</span><span class="p">};</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="n">envp</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">NULL</span><span class="p">};</span>
	<span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#34;i will give you a shell</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
	<span class="c1">//程序将会在此行崩溃.
</span><span class="c1"></span>	<span class="n">syscall</span><span class="p">(</span><span class="mi">59</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">argv</span><span class="p">,</span><span class="n">envp</span><span class="p">);</span><span class="c1">//execve
</span><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>seccomp_init是初始化的过滤状态,这里用的是SCMP_ACT_ALLOW,表示默认允许所有的syscacll.如果初始化状态为SCMP_ACT_KILL,则表示默认不允许所有的syscall.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cm">/**
</span><span class="cm"> * Kill the process
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_KILL		0x00000000U
</span><span class="cp"></span><span class="cm">/**
</span><span class="cm"> * Throw a SIGSYS signal
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_TRAP		0x00030000U
</span><span class="cp"></span><span class="cm">/**
</span><span class="cm"> * Return the specified error code
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_ERRNO(x)	(0x00050000U | ((x) &amp; 0x0000ffffU))
</span><span class="cp"></span><span class="cm">/**
</span><span class="cm"> * Notify a tracing process with the specified value
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_TRACE(x)	(0x7ff00000U | ((x) &amp; 0x0000ffffU))
</span><span class="cp"></span><span class="cm">/**
</span><span class="cm"> * Allow the syscall to be executed after the action has been logged
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_LOG		0x7ffc0000U
</span><span class="cp"></span><span class="cm">/**
</span><span class="cm"> * Allow the syscall to be executed
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_ACT_ALLOW		0x7fff0000U
</span></code></pre></td></tr></table>
</div>
</div><p>规则添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cm">/**
</span><span class="cm"> * Add a new rule to the filter
</span><span class="cm"> * @param ctx the filter context
</span><span class="cm"> * @param action the filter action
</span><span class="cm"> * @param syscall the syscall number
</span><span class="cm"> * @param arg_cnt the number of argument filters in the argument filter chain
</span><span class="cm"> * @param ... scmp_arg_cmp structs (use of SCMP_ARG_CMP() recommended)
</span><span class="cm"> *
</span><span class="cm"> * This function adds a series of new argument/value checks to the seccomp
</span><span class="cm"> * filter for the given syscall; multiple argument/value checks can be
</span><span class="cm"> * specified and they will be chained together (AND&amp;#039;d together) in the filter.
</span><span class="cm"> * If the specified rule needs to be adjusted due to architecture specifics it
</span><span class="cm"> * will be adjusted without notification.  Returns zero on success, negative
</span><span class="cm"> * values on failure.
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">seccomp_rule_add</span><span class="p">(</span><span class="n">scmp_filter_ctx</span> <span class="n">ctx</span><span class="p">,</span>
		     <span class="kt">uint32_t</span> <span class="n">action</span><span class="p">,</span> <span class="kt">int</span> <span class="n">syscall</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">arg_cnt</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></td></tr></table>
</div>
</div><p>seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), 0);,arg_cnt为0,表示直接限制execve,不管他什么参数.</p>
<p>如果arg_cnt不为0,那arg_cnt表示后面限制的参数的个数,也就是只有调用execve,且参数满足要求时,才会拦截syscall.</p>
<pre><code>seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(write),1,SCMP_A2(SCMP_CMP_EQ,0x10));//第2(从0)个参数等于0x10
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for use in declaring rules
</span><span class="cm"> * @param arg the argument number, starting at 0
</span><span class="cm"> * @param op the comparison operator, e.g. SCMP_CMP_*
</span><span class="cm"> * @param datum_a dependent on comparison
</span><span class="cm"> * @param datum_b dependent on comparison, optional
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_CMP(...)		((struct scmp_arg_cmp){__VA_ARGS__})
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 0
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A0(...)		SCMP_CMP(0, __VA_ARGS__)
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 1
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A1(...)		SCMP_CMP(1, __VA_ARGS__)
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 2
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A2(...)		SCMP_CMP(2, __VA_ARGS__)
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 3
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A3(...)		SCMP_CMP(3, __VA_ARGS__)
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 4
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A4(...)		SCMP_CMP(4, __VA_ARGS__)
</span><span class="cp"></span>
<span class="cm">/**
</span><span class="cm"> * Specify an argument comparison struct for argument 5
</span><span class="cm"> */</span>
<span class="cp">#define SCMP_A5(...)		SCMP_CMP(5, __VA_ARGS__)
</span><span class="cp"></span>


<span class="cm">/**
</span><span class="cm"> * Comparison operators
</span><span class="cm"> */</span>
<span class="k">enum</span> <span class="nc">scmp_compare</span> <span class="p">{</span>
	<span class="n">_SCMP_CMP_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SCMP_CMP_NE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>		<span class="cm">/**&lt; not equal */</span>
	<span class="n">SCMP_CMP_LT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>		<span class="cm">/**&lt; less than */</span>
	<span class="n">SCMP_CMP_LE</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>		<span class="cm">/**&lt; less than or equal */</span>
	<span class="n">SCMP_CMP_EQ</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>		<span class="cm">/**&lt; equal */</span>
	<span class="n">SCMP_CMP_GE</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>		<span class="cm">/**&lt; greater than or equal */</span>
	<span class="n">SCMP_CMP_GT</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>		<span class="cm">/**&lt; greater than */</span>
	<span class="n">SCMP_CMP_MASKED_EQ</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>		<span class="cm">/**&lt; masked equality */</span>
	<span class="n">_SCMP_CMP_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**
</span><span class="cm"> * Argument datum
</span><span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">uint64_t</span> <span class="n">scmp_datum_t</span><span class="p">;</span>

<span class="cm">/**
</span><span class="cm"> * Argument / Value comparison definition
</span><span class="cm"> */</span>
<span class="k">struct</span> <span class="nc">scmp_arg_cmp</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">;</span>	<span class="cm">/**&lt; argument number, starting at 0 */</span>
	<span class="k">enum</span> <span class="nc">scmp_compare</span> <span class="n">op</span><span class="p">;</span>	<span class="cm">/**&lt; the comparison op, e.g. SCMP_CMP_* */</span>
	<span class="n">scmp_datum_t</span> <span class="n">datum_a</span><span class="p">;</span>
	<span class="n">scmp_datum_t</span> <span class="n">datum_b</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>ctx的内容可以使用函数dump出来,之后可以直接使用prctl命令相关直接载入,方便使用?</p>
<h3 id="seccomp调试">seccomp调试</h3>
<p>使用如下命令导出所有可能的命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">file</span><span class="o">=</span>syscall-names.h
<span class="nb">echo</span> <span class="s2">&#34;static const char *syscall_names[] = {&#34;</span> &gt; <span class="nv">$file</span>
<span class="nb">echo</span> <span class="s2">&#34;#include &lt;sys/syscall.h&gt;&#34;</span> <span class="p">|</span> cpp -dM <span class="p">|</span> grep <span class="p">&amp;</span><span class="c1">#039;^#define __NR_&amp;#039; | LC_ALL=C sed -r -n -e &amp;#039;s/^\#define[ \t]+__NR_([a-z0-9_]+)[ \t]+([0-9]+)(.*)/ [\2] = &#34;\1&#34;,/p&amp;#039; &gt;&gt; $file</span>
<span class="nb">echo</span> <span class="s2">&#34;};&#34;</span> &gt;&gt; <span class="nv">$file</span>
</code></pre></td></tr></table>
</div>
</div><p>使用如下代码导出一段代码所需要的权限.遵循最小权限原则,试验代码运行所需要的最少权限.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#define __USE_GNU 1
</span><span class="cp">#define _GNU_SOURCE 1
</span><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/prctl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;linux/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;linux/filter.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;linux/seccomp.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;seccomp.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;syscall-names.h&#34;</span><span class="cp">
</span><span class="cp">#if defined(__i386__)
</span><span class="cp">#define REG_RESULT	REG_EAX
</span><span class="cp">#define REG_SYSCALL	REG_EAX
</span><span class="cp">#define REG_ARG0	REG_EBX
</span><span class="cp">#define REG_ARG1	REG_ECX
</span><span class="cp">#define REG_ARG2	REG_EDX
</span><span class="cp">#define REG_ARG3	REG_ESI
</span><span class="cp">#define REG_ARG4	REG_EDI
</span><span class="cp">#define REG_ARG5	REG_EBP
</span><span class="cp">#elif defined(__x86_64__)
</span><span class="cp">#define REG_RESULT	REG_RAX
</span><span class="cp">#define REG_SYSCALL	REG_RAX
</span><span class="cp">#define REG_ARG0	REG_RDI
</span><span class="cp">#define REG_ARG1	REG_RSI
</span><span class="cp">#define REG_ARG2	REG_RDX
</span><span class="cp">#define REG_ARG3	REG_R10
</span><span class="cp">#define REG_ARG4	REG_R8
</span><span class="cp">#define REG_ARG5	REG_R9
</span><span class="cp">#endif
</span><span class="cp">#ifndef SYS_SECCOMP
</span><span class="cp">#define SYS_SECCOMP 1
</span><span class="cp">#endif
</span><span class="cp"></span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">msg</span><span class="o">=</span><span class="s">&#34;system call invalid: &#34;</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">write_uint</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tens</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">tens</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="n">tens</span><span class="p">;</span> <span class="n">tens</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="o">++</span> <span class="n">width</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="err">\</span><span class="mi">0</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">tens</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="n">tens</span><span class="p">;</span> <span class="n">tens</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">buf</span><span class="p">[</span><span class="o">--</span><span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="mi">0</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span> <span class="o">+</span> <span class="p">(</span><span class="n">tens</span> <span class="o">%</span> <span class="mi">10</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">helper</span><span class="p">(</span><span class="kt">int</span> <span class="n">nr</span><span class="p">,</span> <span class="n">siginfo_t</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">void_context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
    <span class="n">ucontext_t</span> <span class="o">*</span><span class="n">ctx</span> <span class="o">=</span> <span class="p">(</span><span class="n">ucontext_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">void_context</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">syscall</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">si_code</span> <span class="o">!=</span> <span class="n">SYS_SECCOMP</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">syscall</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">uc_mcontext</span><span class="p">.</span><span class="n">gregs</span><span class="p">[</span><span class="n">REG_SYSCALL</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">syscall</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">syscall_names</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">syscall_names</span><span class="p">[</span><span class="n">syscall</span><span class="p">]);</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;(&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">write_uint</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">syscall</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">syscall</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">syscall_names</span><span class="p">))</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;)&#34;</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">write</span><span class="p">(</span><span class="n">STDOUT_FILENO</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">install_helper</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="nc">sigaction</span> <span class="n">act</span><span class="p">;</span>
    <span class="n">sigset_t</span> <span class="n">mask</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">act</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">act</span><span class="p">));</span>
    <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">);</span>
    <span class="n">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span> <span class="n">SIGSYS</span><span class="p">);</span>
    <span class="n">act</span><span class="p">.</span><span class="n">sa_sigaction</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">helper</span><span class="p">;</span>
    <span class="n">act</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="n">SA_SIGINFO</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGSYS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">act</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;sigaction&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_UNBLOCK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;sigprocmask&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">install_helper</span><span class="p">()){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;install helper failed&#34;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">scmp_filter_ctx</span> <span class="n">ctx</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">ctx</span> <span class="o">=</span> <span class="n">seccomp_init</span><span class="p">(</span><span class="n">SCMP_ACT_ALLOW</span><span class="p">);</span>

	<span class="n">seccomp_rule_add</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SCMP_ACT_TRAP</span><span class="p">,</span> <span class="n">SCMP_SYS</span><span class="p">(</span><span class="n">execve</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">seccomp_load</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
	<span class="n">seccomp_release</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
	<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&#34;something to stdout</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#34;/bin/sh&#34;</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">,</span><span class="nb">NULL</span><span class="p">};</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="n">envp</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">NULL</span><span class="p">};</span>
	<span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#34;i will give you a shell</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
	<span class="n">syscall</span><span class="p">(</span><span class="mi">59</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">argv</span><span class="p">,</span><span class="n">envp</span><span class="p">);</span><span class="c1">//execve
</span><span class="c1"></span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="注入程序">注入程序</h3>
<p>刚刚提到了seccomp必须由程序主动加载,因此需要有一个办法将代码注入到用户的代码中.</p>
<blockquote>
<p>等待完成</p>
</blockquote>
<h3 id="其他语言">其他语言</h3>
<p>这玩意貌似至少能方便的用在c系语言,java和python上.</p>
<h2 id="docker">Docker</h2>
<p>准备使用Docker重构整个OJ</p>
<h3 id="多阶段构建">多阶段构建</h3>
<p>使用Docker,将OJ分解为多个阶段来构建.</p>
<ol>
<li>前端构建</li>
<li>后端构建</li>
<li>运行环境构建与代码整合</li>
<li>nginx构建</li>
</ol>
<h4 id="命令">命令</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="c">#...</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># 使用php作为基础,指明该构建阶段为codeisland</span><span class="err">
</span><span class="err"></span><span class="k">FROM</span><span class="s"> php:alpine as codeisland</span><span class="err">
</span><span class="err"></span><span class="c"># 在容器打包阶段安装数据库驱动</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> docker-php-ext-install pdo pdo_pgsql<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ARG</span> <span class="nv">PATH</span><span class="o">=</span>/app/laravel<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># 从其他阶段复制代码到本阶段</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>DELETED /app/ <span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># 执行其他初始化命令</span><span class="err">
</span><span class="err"></span><span class="c"># [DELETED]</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># 指明容器的工作路径</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> ${PATH}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">#...</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="容器协调">容器协调</h3>
<p>使用Docker-compose来协调各个容器的关系.</p>
<ul>
<li>数据库容器</li>
<li>redis容器</li>
<li>网站后端容器</li>
<li>评测器容器</li>
<li>评测代理容器</li>
<li>nginx容器</li>
</ul>
<p>限制评测器容器的资源消耗的例子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">deploy</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">resources</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">limits</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">cpus</span><span class="p">:</span><span class="w"> </span><span class="cp">&amp;#039;0.50&amp;#039;</span><span class="w">
</span><span class="w">      </span><span class="k">memory</span><span class="p">:</span><span class="w"> </span>1024M<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="网络">网络</h3>
<p>...学校网关的登录状态根本没法维持,卡死.</p>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[FZU 2204]Seven</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/fzu-2204seven/" />
            <id>https://blog.kanari.moe/code/fzu-2204seven/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-10T10:53:02+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[n个有标号的球围成一个圈。每个球有两种颜色可以选择黑或白染色。问有多少种方案使得没有……]]></summary>
            
                <content type="html"><![CDATA[<p>n个有标号的球围成一个圈。每个球有两种颜色可以选择黑或白染色。问有多少种方案使得没有出现连续白球7个或连续黑球7个。</p>
<p>对方案数mod 2015，球最多有100000个。</p>
<h1 id="分析">分析</h1>
<p>考虑对于非环状球的答案计算，可以设$sum(i,k)$表示第i个球为k色时的方案数。其计算非常显然</p>
<p>$$
sum(i,k)=\sum_{1\leq j \leq 6}{sum(i-j,1-k)}
$$</p>
<p>接下来考虑收尾相接后需要排除的情况，即收尾同色球长度相加超过6的情况，这可以直接枚举。</p>
<p>首取i个末取j个同色，从答案中删除此时剩下球的方案数，注意剩下的球的首末球颜色<strong>不能</strong>和已经枚举的颜色同色。鉴于这种要求，我们退回到sum的递推公式处，决定sum的边界条件为首个球固定为黑色，这样就能很方便的确定球的颜色，且根据对称性答案可以直接x2得到。</p>
<p>题就做完了。</p>
<h1 id="代码">代码</h1>
<blockquote>
<p>淦，为什么当时没写。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">P</span><span class="o">=</span><span class="mi">2015</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">sum</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">100000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">%=</span><span class="n">P</span><span class="p">;</span>
            <span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">%=</span><span class="n">P</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="n">nlen</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sum</span><span class="p">[</span><span class="n">nlen</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nlen</span><span class="o">&gt;=</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">&gt;=</span><span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="n">nlen</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ans</span><span class="o">=</span><span class="p">(</span><span class="n">ans</span><span class="o">-</span><span class="n">sum</span><span class="p">[</span><span class="n">nlen</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">%</span><span class="n">P</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;Case #&#34;</span><span class="o">&lt;&lt;++</span><span class="n">cnt</span><span class="o">&lt;&lt;</span><span class="s">&#34;: &#34;</span><span class="o">&lt;&lt;</span><span class="p">((</span><span class="n">ans</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="n">P</span><span class="o">+</span><span class="mi">2015</span><span class="p">)</span><span class="o">%</span><span class="n">P</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[HDU6638] Snowy Smile</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/hdu6638-snowy-smile/" />
            <id>https://blog.kanari.moe/code/hdu6638-snowy-smile/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-07T20:45:09+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>There are n pirate chests buried in Byteland, labeled by 1,2,…,n. The i-th chest's location is (xi,yi), and its value is wi, wi can be negative since the pirate can add some poisonous gases into the chest. When you open the i-th pirate chest, you will get wi value.</p>
<p>You want to make money from these pirate chests. You can select a rectangle, the sides of which are all paralleled to the axes, and then all the chests inside it or on its border will be opened. Note that you must open all the chests within that range regardless of their values are positive or negative. But you can choose a rectangle with nothing in it to get a zero sum.</p>
<p>Please write a program to find the best rectangle with maximum total value.</p>
<p>The first line of the input contains an integer T(1≤T≤100), denoting the number of test cases.</p>
<p>In each test case, there is one integer n(1≤n≤2000) in the first line, denoting the number of pirate chests.</p>
<p>For the next n lines, each line contains three integers xi,yi,wi(−109≤xi,yi,wi≤109), denoting each pirate chest.</p>
<p>It is guaranteed that ∑n≤10000.</p>
<h2 id="分析">分析</h2>
<p>首先，我没做出来。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>There are n pirate chests buried in Byteland, labeled by 1,2,…,n. The i-th chest's location is (xi,yi), and its value is wi, wi can be negative since the pirate can add some poisonous gases into the chest. When you open the i-th pirate chest, you will get wi value.</p>
<p>You want to make money from these pirate chests. You can select a rectangle, the sides of which are all paralleled to the axes, and then all the chests inside it or on its border will be opened. Note that you must open all the chests within that range regardless of their values are positive or negative. But you can choose a rectangle with nothing in it to get a zero sum.</p>
<p>Please write a program to find the best rectangle with maximum total value.</p>
<p>The first line of the input contains an integer T(1≤T≤100), denoting the number of test cases.</p>
<p>In each test case, there is one integer n(1≤n≤2000) in the first line, denoting the number of pirate chests.</p>
<p>For the next n lines, each line contains three integers xi,yi,wi(−109≤xi,yi,wi≤109), denoting each pirate chest.</p>
<p>It is guaranteed that ∑n≤10000.</p>
<h2 id="分析">分析</h2>
<p>首先，我没做出来。</p>
<p>这道题实际上就是在要求你用小于$O(N^3)$的复杂度求出最大和子矩阵。注意到该题的点<strong>稀疏</strong>，所以以点为考虑对象。</p>
<p>三方的做法，枚举矩阵的上边界和下边界，维护纵向上的和，求最大字段和。当以点考虑时，上下边界就可以直接由<strong>排序后</strong>的点决定。之后，使用线段树维护最大子段和。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">400010</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">d_sub</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">d_pre</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">d_suf</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">d_sum</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
    <span class="n">d_sum</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_sub</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_pre</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_suf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
    <span class="c1">//combine data
</span><span class="c1"></span><span class="p">}</span>
<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="n">d_sum</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_sum</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_sum</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]];</span>

    <span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">d_pre</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sum</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_pre</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>
    <span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">d_suf</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sum</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_suf</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>

    <span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d_sub</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sub</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]),</span><span class="n">d_suf</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_pre</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="c1">//only single point to modify
</span><span class="c1"></span>        <span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_sum</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>

    <span class="n">collect</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
<span class="n">ll</span> <span class="nf">query_all</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">d_sub</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">Chest</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Chest</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="k">return</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">chests</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">refy</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
        <span class="n">refy</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">Chest</span> <span class="o">&amp;</span><span class="n">chest</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">v</span><span class="p">;</span>
            <span class="n">refy</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">chest</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">chests</span><span class="p">,</span><span class="n">chests</span><span class="o">+</span><span class="n">nlen</span><span class="p">);</span>

        <span class="n">sort</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refy</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="k">auto</span> <span class="n">refyend</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refy</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="kt">int</span> <span class="n">maxy</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refyend</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">maxy</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">lastx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lastx</span><span class="o">==</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
            <span class="n">lastx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
            <span class="c1">//cout&lt;&lt;&#34;start from &#34;&lt;&lt;lastx&lt;&lt;endl;
</span><span class="c1"></span>
            <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxy</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">nextx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="o">!=</span><span class="n">nextx</span><span class="p">){</span>
                    <span class="n">nextx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
                    <span class="n">ans</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query_all</span><span class="p">());</span>
                <span class="p">}</span>
                <span class="n">modify</span><span class="p">(</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxy</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query_all</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">max</span><span class="p">(</span><span class="mi">0ll</span><span class="p">,</span><span class="n">ans</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">莫队算法</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/mo-s-algorithm/" />
            <id>https://blog.kanari.moe/study/mo-s-algorithm/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-03T13:47:41+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>对于可以离线的区间询问问题，莫队算法提出了一种可以在$O(n\sqrt n)$(无修改)，$n^{3/5}$(带修改)内得出答案的方法。</p>
<p>主要的思路是对询问离线并分块，利用在2个区间间答案的<strong>快速转移</strong>（如果无法找到快速转移的方法，就没法用了）降低复杂度。</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>对于可以离线的区间询问问题，莫队算法提出了一种可以在$O(n\sqrt n)$(无修改)，$n^{3/5}$(带修改)内得出答案的方法。</p>
<p>主要的思路是对询问离线并分块，利用在2个区间间答案的<strong>快速转移</strong>（如果无法找到快速转移的方法，就没法用了）降低复杂度。</p>
<h2 id="无修改莫队">无修改莫队</h2>
<p>以$B=\sqrt{n}$，按照$(l/B,r)$对询问排序。</p>
<p>之后枚举每一个询问，将答案在相邻询问区间间暴力的+1-1转移。</p>
<h3 id="problem-小y的袜子">Problem: 小Y的袜子</h3>
<p>没有在针对哪个人。</p>
<p>作为一个生活散漫的人，小Z每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小Z再也无法忍受这恼人的找袜子过程，于是他决定听天由命……</p>
<p>具体来说，小Z把这N只袜子从1到N编号，然后从编号L到R(L 尽管小Z并不在意两只袜子是不是完整的一双，甚至不在意两只袜子是否一左一右，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。</p>
<p>你的任务便是告诉小Z，他有多大的概率抽到两只颜色相同的袜子。当然，小Z希望这个概率尽量高，所以他可能会询问多个(L,R)以方便自己选择。</p>
<p>袜子的数量最多为50000（是真的🐂🍺）</p>
<h4 id="分析">分析</h4>
<p>这似乎是莫队的例题（</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">50010</span><span class="p">,</span><span class="n">MAXQ</span><span class="o">=</span><span class="mi">50010</span><span class="p">;</span>

<span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">){</span>
    <span class="k">return</span> <span class="o">!</span><span class="n">b</span><span class="o">?</span><span class="nl">a</span><span class="p">:</span><span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">%</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">c2</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">block</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Q</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">ll</span> <span class="n">ansu</span><span class="p">,</span><span class="n">ansd</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">block</span><span class="o">!=</span><span class="n">b</span><span class="p">.</span><span class="n">l</span><span class="o">/</span><span class="n">block</span><span class="p">)</span><span class="k">return</span> <span class="n">l</span><span class="o">/</span><span class="n">block</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">l</span><span class="o">/</span><span class="n">block</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="n">qs</span><span class="p">[</span><span class="n">MAXQ</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">cup</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cdown</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">){</span>
    <span class="n">cup</span><span class="o">-=</span><span class="n">c2</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]);</span>
    <span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span>
    <span class="n">cdown</span><span class="o">--</span><span class="p">;</span>
    <span class="n">cup</span><span class="o">+=</span><span class="n">c2</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">ptr</span><span class="p">){</span>
    <span class="n">cup</span><span class="o">-=</span><span class="n">c2</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]);</span>
    <span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
    <span class="n">cdown</span><span class="o">++</span><span class="p">;</span>
    <span class="n">cup</span><span class="o">+=</span><span class="n">c2</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">ptr</span><span class="p">]]);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">qlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="o">&gt;&gt;</span><span class="n">qlen</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="o">&gt;&gt;</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="n">block</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nlen</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span><span class="n">qs</span><span class="o">+</span><span class="n">qlen</span><span class="p">);</span>
    <span class="cm">/*
</span><span class="cm">    cout&lt;&lt;&#34;current queries:&#34;&lt;&lt;endl;
</span><span class="cm">    for(auto q:qs){
</span><span class="cm">        cout&lt;&lt;q.l&lt;&lt;&#34; &#34;&lt;&lt;q.r&lt;&lt;endl;
</span><span class="cm">    }
</span><span class="cm">    cout&lt;&lt;&#34;=====&#34;&lt;&lt;endl;
</span><span class="cm">*/</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Q</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">=</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">l</span><span class="o">==</span><span class="n">q</span><span class="p">.</span><span class="n">r</span><span class="p">){</span>
            <span class="n">q</span><span class="p">.</span><span class="n">ansu</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">q</span><span class="p">.</span><span class="n">ansd</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">l</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="n">add</span><span class="p">(</span><span class="o">--</span><span class="n">l</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="n">q</span><span class="p">.</span><span class="n">r</span><span class="p">)</span><span class="n">add</span><span class="p">(</span><span class="o">++</span><span class="n">r</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">q</span><span class="p">.</span><span class="n">l</span><span class="p">)</span><span class="n">remove</span><span class="p">(</span><span class="n">l</span><span class="o">++</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">r</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">remove</span><span class="p">(</span><span class="n">r</span><span class="o">--</span><span class="p">);</span>

        <span class="n">q</span><span class="p">.</span><span class="n">ansu</span><span class="o">=</span><span class="n">cup</span><span class="p">;</span>
        <span class="n">q</span><span class="p">.</span><span class="n">ansd</span><span class="o">=</span><span class="n">cdown</span><span class="p">;</span>
        <span class="c1">//cout&lt;&lt;cup/c2(cdown)&lt;&lt;endl;
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span><span class="n">qs</span><span class="o">+</span><span class="n">qlen</span><span class="p">,[](</span><span class="k">const</span> <span class="n">Q</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="k">const</span> <span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
            <span class="p">});</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ansd</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;0/1&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">ll</span> <span class="n">u</span><span class="o">=</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ansu</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">d</span><span class="o">=</span><span class="n">c2</span><span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ansd</span><span class="p">);</span>
        <span class="n">ll</span> <span class="n">g</span><span class="o">=</span><span class="n">gcd</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">d</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">g</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="n">u</span><span class="o">/=</span><span class="n">g</span><span class="p">,</span><span class="n">d</span><span class="o">/=</span><span class="n">g</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">&lt;&lt;</span><span class="s">&#34;/&#34;</span><span class="o">&lt;&lt;</span><span class="n">d</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="带修改莫队">带修改莫队</h2>
<blockquote>
<p>一切都是石x门的选择！</p>
</blockquote>
<p>将修改操作平铺在时间线上，计算每次询问所处的时间点，以$B=\sqrt{n}$，按照$(l/B,r/B,time)$对询问排序。</p>
<p>之后枚举每一个询问，将答案在不同时间线间暴力+1-1跳转，再暴力在相邻询问的区间间+1-1转移。</p>
<p><del>听起来有点中二的意思。</del></p>
<h3 id="problem-game">Problem: Game</h3>
<p>Again Alice and Bob is playing a game with stones. There are N piles of stones labelled from 1 to N, the i th pile has ai stones.</p>
<p>First Alice will choose piles of stones with consecutive labels, whose leftmost is labelled with L and the rightmost one is R. After, Bob will choose another consecutive piles labelled from l to r (L≤l≤r≤R). Then they're going to play game within these piles.</p>
<p>Here's the rules of the game: Alice takes first and the two will take turn to make a move: choose one pile with nonegetive stones and take at least one stone and at most all away. One who cant make a move will lose.</p>
<p>Bob thinks this game is not so intersting because Alice always take first. So they add a new rule, which is that Bob can swap the number of two adjacent piles' stones whenever he want before a new round. That is to say, if the i th and i+1 pile have ai and ai+1 stones respectively, after this swapping there will be ai+1 and ai.</p>
<p>Before today's game with Bob, Alice wants to know, if both they play game optimally when she choose the piles from L to R, there are how many pairs (l, r) chosed by Bob that will make Alice <em>win</em>.</p>
<h4 id="分析-1">分析</h4>
<p>nim游戏输赢就是看异或和，异或和可以看前缀异或和内有多少个值相同的点。所以它就是在问一个区间里有多少个相同点对。</p>
<p>带单点修改的区间点对计数。</p>
<h4 id="代码">代码</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">100010</span><span class="p">,</span><span class="n">MAXQ</span><span class="o">=</span><span class="mi">100010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXPOS</span><span class="o">=</span><span class="mf">2e6</span><span class="o">+</span><span class="mi">11</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">qlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">game</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">pre</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">modified</span><span class="p">[</span><span class="n">MAXQ</span><span class="p">],</span><span class="n">midx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">belong</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">block</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Q</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tick</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Q</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
 <span class="c1">//       if(l/block!=b.l/block)return l/block&lt;b.l/block;
</span><span class="c1"></span>   <span class="c1">//     if(r/block!=b.r/block)return r/block&lt;b.r/block;
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">belong</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">!=</span><span class="n">belong</span><span class="p">[</span><span class="n">b</span><span class="p">.</span><span class="n">l</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">belong</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">&lt;</span><span class="n">belong</span><span class="p">[</span><span class="n">b</span><span class="p">.</span><span class="n">l</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">belong</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">!=</span><span class="n">belong</span><span class="p">[</span><span class="n">b</span><span class="p">.</span><span class="n">r</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">belong</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">&lt;</span><span class="n">belong</span><span class="p">[</span><span class="n">b</span><span class="p">.</span><span class="n">r</span><span class="p">];</span>
        <span class="k">return</span>  <span class="n">tick</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">tick</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="n">q</span><span class="p">[</span><span class="n">MAXQ</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">qidx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">cache</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAXPOS</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
    <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="o">=</span><span class="n">cnt</span><span class="p">[</span><span class="n">pre</span><span class="p">[</span><span class="n">pos</span><span class="p">]];</span>
    <span class="n">cache</span><span class="o">-=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">c</span><span class="o">++</span><span class="p">;</span>
    <span class="n">cache</span><span class="o">+=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rm</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
    <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="o">=</span><span class="n">cnt</span><span class="p">[</span><span class="n">pre</span><span class="p">[</span><span class="n">pos</span><span class="p">]];</span>
    <span class="n">cache</span><span class="o">-=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">c</span><span class="o">--</span><span class="p">;</span>
    <span class="n">cache</span><span class="o">+=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">curt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">jumpup</span><span class="p">(</span><span class="kt">int</span> <span class="n">tim</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">tim</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">pos</span><span class="o">=</span><span class="n">modified</span><span class="p">[</span><span class="n">tim</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">game</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="n">game</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span><span class="n">game</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">pos</span> <span class="o">&amp;&amp;</span> <span class="n">pos</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="n">rm</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">pre</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">^=</span><span class="n">a</span><span class="p">;</span>
    <span class="n">pre</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">^=</span><span class="n">b</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">pos</span> <span class="o">&amp;&amp;</span> <span class="n">pos</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">jumpdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">tim</span><span class="p">){</span>
    <span class="n">jumpup</span><span class="p">(</span><span class="n">tim</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">qans</span><span class="p">[</span><span class="n">MAXQ</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">//freopen(&#34;00.in&#34;,&#34;r&#34;,stdin);
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nlen</span><span class="p">,</span><span class="o">&amp;</span><span class="n">qlen</span><span class="p">)){</span>
        <span class="n">block</span><span class="o">=</span><span class="n">pow</span><span class="p">(</span><span class="n">nlen</span><span class="p">,</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">belong</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">block</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="n">qidx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">midx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">qlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">opt</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">opt</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
                <span class="n">q</span><span class="p">[</span><span class="n">qidx</span><span class="p">].</span><span class="n">i</span><span class="o">=</span><span class="n">qidx</span><span class="p">;</span>
                <span class="n">q</span><span class="p">[</span><span class="n">qidx</span><span class="p">].</span><span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">;</span>
                <span class="n">q</span><span class="p">[</span><span class="n">qidx</span><span class="p">].</span><span class="n">l</span><span class="o">--</span><span class="p">;</span>
                <span class="n">q</span><span class="p">[</span><span class="n">qidx</span><span class="p">].</span><span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">;</span>
                <span class="n">q</span><span class="p">[</span><span class="n">qidx</span><span class="p">].</span><span class="n">tick</span><span class="o">=</span><span class="n">midx</span><span class="p">;</span>
                <span class="n">qidx</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">modified</span><span class="p">[</span><span class="o">++</span><span class="n">midx</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="n">qidx</span><span class="p">);</span>

        <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>
        <span class="n">cache</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">l</span><span class="o">=</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">curt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qidx</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">){</span>
                <span class="n">qans</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">while</span><span class="p">(</span><span class="n">curt</span><span class="o">&lt;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tick</span><span class="p">)</span><span class="n">jumpup</span><span class="p">(</span><span class="o">++</span><span class="n">curt</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tick</span><span class="o">&lt;</span><span class="n">curt</span><span class="p">)</span><span class="n">jumpdown</span><span class="p">(</span><span class="n">curt</span><span class="o">--</span><span class="p">);</span>

            <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="n">add</span><span class="p">(</span><span class="o">--</span><span class="n">l</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span><span class="n">add</span><span class="p">(</span><span class="o">++</span><span class="n">r</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span><span class="n">rm</span><span class="p">(</span><span class="n">l</span><span class="o">++</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">rm</span><span class="p">(</span><span class="n">r</span><span class="o">--</span><span class="p">);</span>
 
            <span class="c1">//qans[q[i].i]=cache;
</span><span class="c1"></span>            <span class="n">ll</span> <span class="n">len</span><span class="o">=</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">qans</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">len</span><span class="o">*</span><span class="p">(</span><span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">cache</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">qidx</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%lld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">qans</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="注意">注意</h2>
<ul>
<li>关于记录当前问题的区间的开闭问题，需要谨慎安排。</li>
<li>在确认了区间开闭后，关于最初始的状态，需要谨慎安排。</li>
</ul>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Distribution of Books</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/distribution-of-books/" />
            <id>https://blog.kanari.moe/code/distribution-of-books/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-01T15:15:47+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[zz6d likes reading very much, so he bought a lot of books. One day, zz6d brought n books to a classroom in school. The books of zz6d is so popular that K students in the classroom want to borrow his books to……]]></summary>
            
                <content type="html"><![CDATA[<p>zz6d likes reading very much, so he bought a lot of books. One day, zz6d brought n books to a classroom in school. The books of zz6d is so popular that K students in the classroom want to borrow his books to read. Every book of zz6d has a number i (1&lt;=i&lt;=n). Every student in the classroom wants to get a continuous number books. Every book has a pleasure value, which can be 0 or even negative (causing discomfort). Now zz6d needs to distribute these books to K students. The pleasure value of each student is defined as the sum of the pleasure values of all the books he obtains.Zz6d didn't want his classmates to be too happy, so he wanted to minimize the maximum pleasure of the K classmates. zz6d can hide some last numbered books and not distribute them,which means he can just split the first x books into k parts and ignore the rest books, every part is consecutive and no two parts intersect with each other.However,every classmate must get at least one book.Now he wonders how small can the maximum pleasure of the K classmates be.</p>
<p>1&lt;=T&lt;=10</p>
<p>1&lt;=n&lt;=2*105</p>
<p>1&lt;=k&lt;=n</p>
<p>-109&lt;=ai&lt;=109</p>
<h1 id="分析">分析</h1>
<p>最大值最小，考虑二分答案。思考题目是否具有单调性：当最大值极大时，书可以随便分，当最大值极小时，可能会出现无法凑齐的状况，目测满足。</p>
<p>题目要求分书时必须连续分，可以使用动态规划来做。假设二分的答案为lim</p>
<p>$$f(i)=\max { f(j) | \sum_{k=j+1}^i a_k \leq lim  }+1$$</p>
<p>将求和改为前缀和，$pre(i)$。</p>
<p>$$f(i)=\max { f(j) | pre(i)-pre(j-1) \leq lim  }+1$$</p>
<p>动态规划的复杂度为$O(n^2)$，太慢，考虑优化。</p>
<p>每次转移都从先前已经出现的满足要求的f中转移。限制条件转一下，就是</p>
<p>$$pre(i)-lim \leq pre(?)$$</p>
<ul>
<li>当有2个f对应的前缀和相同，我们选择更大的那个</li>
</ul>
<p>所以可以直接维护已经出现的每种前缀和所对应的最大f。可以离散化后使用权值线段树。复杂度变为$O(n\lg n)$</p>
<p>总复杂度为$O(n\lg n \lg n)$。</p>
<h1 id="代码">代码</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">900010</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">dat</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
    <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=-</span><span class="mh">0x3f3f3f3f</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">r</span><span class="p">)</span><span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">),</span><span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">collectchild</span><span class="p">(</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="n">dat</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">dat</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query_n</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">)</span><span class="k">return</span> <span class="n">dat</span><span class="p">[</span><span class="n">node</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span><span class="o">=-</span><span class="mh">0x3f3f3f3f</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query_n</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">query_n</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]));</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">L</span><span class="o">&gt;=</span><span class="n">R</span><span class="p">){</span>
        <span class="n">dat</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">node</span><span class="p">],</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>
    <span class="n">collectchild</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="n">prefix</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">bprefix</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">num</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">nlen</span><span class="p">,</span><span class="n">sel</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">rlen</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
<span class="kt">bool</span> <span class="nf">check</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rlen</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">zero</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">bprefix</span><span class="p">,</span><span class="n">bprefix</span><span class="o">+</span><span class="n">rlen</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">bprefix</span><span class="p">;</span>
    <span class="n">modify</span><span class="p">(</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">start</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">bprefix</span><span class="p">,</span><span class="n">bprefix</span><span class="o">+</span><span class="n">rlen</span><span class="p">,</span><span class="n">bprefix</span><span class="p">[</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">bprefix</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">dp</span><span class="o">=</span><span class="n">query_n</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">rlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">root</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dp</span><span class="o">&gt;=</span><span class="n">sel</span><span class="p">)</span><span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">modify</span><span class="p">(</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">//debug
</span><span class="c1"></span>    <span class="cm">/*
</span><span class="cm">    int opt;
</span><span class="cm">    build(root,0,10-1);
</span><span class="cm">    while(cin&gt;&gt;opt){
</span><span class="cm">        if(opt==1){
</span><span class="cm">            int pos,x;cin&gt;&gt;pos&gt;&gt;x;
</span><span class="cm">            modify(pos,pos,x,0,10-1,root);
</span><span class="cm">        }else{
</span><span class="cm">            int l,r;cin&gt;&gt;l&gt;&gt;r;
</span><span class="cm">            cout&lt;&lt;query_n(l,r,0,10-1,root)&lt;&lt;endl;
</span><span class="cm">        }
</span><span class="cm">    }
</span><span class="cm">    */</span>

    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="o">&gt;&gt;</span><span class="n">sel</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">bprefix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">prefix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">bprefix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="c1">//discrete
</span><span class="c1"></span>        <span class="n">sort</span><span class="p">(</span><span class="n">bprefix</span><span class="p">,</span><span class="n">bprefix</span><span class="o">+</span><span class="n">nlen</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">rlen</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">bprefix</span><span class="p">,</span><span class="n">bprefix</span><span class="o">+</span><span class="n">nlen</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">bprefix</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">bprefix</span><span class="p">,</span><span class="n">bprefix</span><span class="o">+</span><span class="n">rlen</span><span class="p">,</span><span class="n">prefix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="n">bprefix</span><span class="p">;</span>

        


        <span class="c1">//binary
</span><span class="c1"></span>        <span class="n">ll</span> <span class="n">l</span><span class="o">=-</span><span class="mf">1e15</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mf">1e15</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">r</span><span class="p">){</span>
            <span class="n">ll</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">mid</span><span class="p">)){</span>
                <span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span> <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="n">i</span><span class="o">=</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">)){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>多组询问没有清理干净数组，WA了好几发。</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Fansblog</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/fansblog/" />
            <id>https://blog.kanari.moe/code/fansblog/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-08-01T15:15:00+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>Farmer John keeps a website called ‘FansBlog’ .Everyday , there are many people visited this blog.One day, he find the visits has reached P , which is a prime number.He thinks it is a interesting fact.And he remembers that the visits had reached another prime number.He try to find out the largest prime number Q ( Q &lt; P ) ,and get the answer of Q! Module P.But he is too busy to find out the answer. So he ask you for help. ( Q! is the product of all positive integers less than or equal to n: n! = n * (n-1) * (n-2) * (n-3) *… * 3 * 2 * 1 . For example, 4! = 4 * 3 * 2 * 1 = 24 )</p>
<p>First line contains an number T(1&lt;=T&lt;=10) indicating the number of testcases.
Then T line follows, each contains a positive prime number P (1e9≤p≤1e14)</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>Farmer John keeps a website called ‘FansBlog’ .Everyday , there are many people visited this blog.One day, he find the visits has reached P , which is a prime number.He thinks it is a interesting fact.And he remembers that the visits had reached another prime number.He try to find out the largest prime number Q ( Q &lt; P ) ,and get the answer of Q! Module P.But he is too busy to find out the answer. So he ask you for help. ( Q! is the product of all positive integers less than or equal to n: n! = n * (n-1) * (n-2) * (n-3) *… * 3 * 2 * 1 . For example, 4! = 4 * 3 * 2 * 1 = 24 )</p>
<p>First line contains an number T(1&lt;=T&lt;=10) indicating the number of testcases.
Then T line follows, each contains a positive prime number P (1e9≤p≤1e14)</p>
<h1 id="分析">分析</h1>
<p>这题得知道2个结论，然而我都不知道。</p>
<h2 id="威尔逊定理">威尔逊定理</h2>
<p>当P为质数时，$(P-1)! \equiv -1 \pmod P$.</p>
<p>注意这里$!$是阶乘，不是取反的意思。</p>
<h2 id="素数分布">素数分布</h2>
<p>当范围变大时，素数的出现频率增高，寻找一素数的相邻素数复杂度逐渐趋近于线性。</p>
<p>所以，寻找素数P的前一个素数可以直接暴力找。找到之后利用$(P-1)! \equiv -1 \pmod P$即可快速由$P-1$的阶乘通过逆元转到$Q$的阶乘，这题就做完了。</p>
<p>因为在计算逆元时会爆ll，使用快速乘法来避免，复杂度符合要求。</p>
<h1 id="代码">代码</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">qmul</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="n">ll</span> <span class="n">y</span><span class="p">,</span><span class="n">ll</span> <span class="n">q</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">y</span><span class="p">;</span><span class="n">y</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">q</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">q</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>


<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">qpow</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">q</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">a</span><span class="p">;</span><span class="n">a</span><span class="p">;</span><span class="n">a</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">qmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="p">)){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">qmul</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">get_rev</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">,</span><span class="n">ll</span> <span class="n">q</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">qpow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="nf">factor</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span><span class="n">ll</span> <span class="n">r</span><span class="p">,</span><span class="n">ll</span> <span class="n">q</span><span class="p">){</span>
    <span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">ll</span> <span class="n">i</span><span class="o">=</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">res</span><span class="o">=</span><span class="n">qmul</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="n">ll</span> <span class="n">x</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">prex</span><span class="o">=</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">is_prime</span><span class="p">(</span><span class="n">prex</span><span class="p">))</span><span class="n">prex</span><span class="o">--</span><span class="p">;</span>

        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="n">qmul</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">get_rev</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">prex</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">);</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">咸鱼数论</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/salt-fish-playing-number/" />
            <id>https://blog.kanari.moe/code/salt-fish-playing-number/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-07-22T15:59:05+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[一些结论 $N!$的质因数分解中某质数的指数为$\sum_{r=1}^{\inf}n/……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="一些结论">一些结论</h2>
<ul>
<li>$N!$的质因数分解中某质数的指数为$\sum_{r=1}^{\inf}n/p^r $</li>
<li>约数个数为质因数指数+1的乘积，和为质因数枚举指数次和的乘积。</li>
<li>费马小定理要求p是质数</li>
</ul>
<h2 id="欧拉函数">欧拉函数</h2>
<p>小于x且与其互质的数的个数
$$
\phi(x)=x\prod_{k=1}^n(1-\frac{1}{p_k})
$$</p>
<ul>
<li>$phi(1)=1$</li>
<li>$phi(p)=p-1$,当p为质数</li>
<li>$phi(2n)=phi(n)$</li>
<li>$phi(phi(phi...))))=1$</li>
</ul>
<p>对于任意积性函数$f(xy)=f(x)f(y)$，可以筛。欧拉函数非完全积性函数。</p>
<ul>
<li>$phi(xy)=phi(x)(y-1)$,当x与y互质</li>
<li>$phi(xy)=phi(x)y$,当x与y不互质</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">no</span><span class="p">[</span><span class="n">i</span><span class="p">]){</span>
        <span class="n">p</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">cnt</span><span class="o">&amp;&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="n">no</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
            <span class="n">phi</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="扩展欧几里得">扩展欧几里得</h2>
<ul>
<li>存在x，y使得ax+by=gcd（a，b）</li>
<li>求逆元，要求x与模数互质</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">exgcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span><span class="n">ll</span> <span class="n">b</span><span class="p">,</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">){</span>
        <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">exgcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">%</span><span class="n">b</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
        <span class="n">y</span><span class="o">-=</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="递推逆元">递推逆元</h2>
<p>inv(i) = inv(mod % i) * (mod-mod/i) % mod;</p>
<ul>
<li>阶乘的逆元：inv(i)=inv(i+1)*(i+1)</li>
</ul>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">水的合集 1</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/water-series/" />
            <id>https://blog.kanari.moe/code/water-series/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-07-22T15:59:04+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[集合挑选 从给定的N个集合中各挑出一个数并求和，求出前$K$大的$K$个和。 考虑如何从……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="集合挑选">集合挑选</h2>
<p>从给定的N个集合中各挑出一个数并求和，求出前$K$大的$K$个和。</p>
<p>考虑如何从2个集合$A$,$B$中选出前$K$大。降序排序后$a_1$和$b_1$显然是最大，第二大则是$(a_1,b_2)$或者$(a_2,b_1)$。不妨以$(a_1,b_2)$来讲，那么第三大竞争者除$(a_2,b_1)$还有$(a_1,b_3)$，$(a_2,b_3)$……每对组合都能找到直接小于它的2个组合，而这种后继关系显然取遍了所有组合。仅需要前K大的我们按需扩展这一棵树即可。2个集合的前K大可与第3个集合执行相同的操作，从而得到最终答案。实际编写时，按照一定顺序限制扩展方向来保证每个方案仅访问一次，使用优先队列维护，复杂度为$O(\sum^N{K\log n_k}) \leq O(KN)$</p>
<h2 id="lis优化">LIS优化</h2>
<p>$$f(i)=max{f(j)| j &lt; i, a(j) &lt; a(i) }+1$$</p>
<p>可以发现，一旦有$a(k) &lt; a(j), f(k) \geq f(j)$，j这个位置就没有用了。按照该规律维护一个单调栈记录，以长度单调（则数字a结尾的LIS自然单调）。此后转移</p>
]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[BUPT WARMUP|CF] 珍珠奶茶</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/bupt-warmupcf-milktea/" />
            <id>https://blog.kanari.moe/code/bupt-warmupcf-milktea/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-07-20T17:12:40+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>给出一个$N \times N$的非负整数矩阵，要求找到一条从左上角数字到右下角数字的路线，且</p>
<ul>
<li>只能向右或者下走。</li>
<li>将经过数字相乘后得到的结果，使其末尾的“0”最少。</li>
</ul>
<p>$$
N \leq 1000
$$</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>给出一个$N \times N$的非负整数矩阵，要求找到一条从左上角数字到右下角数字的路线，且</p>
<ul>
<li>只能向右或者下走。</li>
<li>将经过数字相乘后得到的结果，使其末尾的“0”最少。</li>
</ul>
<p>$$
N \leq 1000
$$</p>
<h2 id="分析">分析</h2>
<p>大概是因为末尾的0长得像珍珠。</p>
<p>思考0是怎么出现的，可以发现结果中因数10的指数越小越好，即，使得经过的路上凑出的因数10最少即可。10的质因数分解为$2 \times 5$，以矩阵中每个数所含因数2和5的数目分别DP一遍求路径，再在两次DP的结果中取小。</p>
<p>一个特殊情况是数字里有0，那么经过0的路的末尾0一定是1个……一开始脑袋抽了以为是0个。如果其他情况的路径末尾0都多于1个的话，就特判走0。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">1010</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">game</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">fac</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">fac</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
        <span class="n">x</span><span class="o">/=</span><span class="n">fac</span><span class="p">;</span>
        <span class="n">res</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">from</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">dodp</span><span class="p">(</span><span class="kt">int</span> <span class="n">fac</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mh">0x3f3f3f3f</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]){</span>
                <span class="n">from</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">from</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+=</span><span class="n">num</span><span class="p">[</span><span class="n">fac</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">string</span> <span class="nf">genpath</span><span class="p">(){</span>
    <span class="n">string</span> <span class="n">res</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="n">n</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="o">=</span><span class="n">from</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span><span class="n">i</span><span class="o">!=</span><span class="mi">1</span> <span class="o">||</span> <span class="n">j</span><span class="o">!=</span><span class="mi">1</span> <span class="p">;</span><span class="n">p</span><span class="o">=</span><span class="n">from</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
            <span class="n">res</span><span class="o">+=</span><span class="s">&#34;D&#34;</span><span class="p">;</span>
            <span class="n">i</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">res</span><span class="o">+=</span><span class="s">&#34;R&#34;</span><span class="p">;</span>
            <span class="n">j</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">res</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">haszero</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">zeroi</span><span class="p">,</span><span class="n">zeroj</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="n">haszero</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">zeroi</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">zeroj</span><span class="o">=</span><span class="n">j</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mh">0x7f7f7f7f</span><span class="p">;</span>
    <span class="n">dodp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">P</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="o">&gt;</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">]){</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">];</span>
        <span class="n">P</span><span class="o">=</span><span class="n">genpath</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">dodp</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="o">&gt;</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">]){</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">];</span>
        <span class="n">P</span><span class="o">=</span><span class="n">genpath</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">haszero</span> <span class="o">&amp;&amp;</span> <span class="n">ans</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">zeroi</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;D&#34;</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">zeroj</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;R&#34;</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">zeroi</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;D&#34;</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">zeroj</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;R&#34;</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">P</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Colorful Tree</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/code/colorful-tree/" />
            <id>https://blog.kanari.moe/code/colorful-tree/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-07-12T14:04:50+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[There is a tree having n nodes, the i-th node of which has a type of color, denoted by an integer $c_i$ The path between every two nodes is unique, of which we define the value is the number of distinct types……]]></summary>
            
                <content type="html"><![CDATA[<p>There is a tree having n nodes, the i-th node of which has a type of color, denoted by an integer $c_i$</p>
<p>The path between every two nodes is unique, of which we define the value is the number of distinct types of colors appearing on it.</p>
<p>Calculate the sum of values of all possible paths, $\frac{n(n-1)}{2}$ in total, between two different nodes on the tree.</p>
<h2 id="输入范围">输入范围</h2>
<p>多组数据,约50;节点数$2 \times 10^5$.</p>
<h1 id="分析">分析</h1>
<p>没想出来该怎么做.统计路径颜色的答案没有什么合并的好方法,同时也不能按照每种颜色单独考虑.</p>
<p>后来经过dalao点拨,该题中的&quot;统计一条路径上颜色种类&quot;的要求可以转化为求其<strong>反面</strong>&quot;没有某种颜色的路径有多少种&quot;.</p>
<p>如此,对于每一种颜色就可以使用$n(n-1)/2-size$来求其对答案的贡献了.So,来解决这个问题.</p>
<p>原图是一棵树,如果某点$N$为颜色$c$,那么经过$N$的子树任意点跨越$N$的路径都有该颜色.所有不包括该颜色$c$的路径只<strong>能</strong>出现在以$N$为切点的其他2部分.考虑其中一个部分,任意选中其中2个节点即可构建一条路径,但还是必须满足刚刚的条件(不能跨越颜色$c$的节点).以dfs递归进去即可.</p>
<p>考虑能否递归合并已有答案.能够得到的数据有<em>子节点中2部分的节点数目</em>,显然能够合并出以当前节点为界划分的2部分中的一部分,自然可以在递归返回后推出另一部分.</p>
<h1 id="代码">代码</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span><span class="o">=</span><span class="mi">200010</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">adde</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">v</span><span class="p">){</span>
    <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">color</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">sz</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">gsz</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="kt">int</span> <span class="n">fa</span><span class="p">){</span>
    <span class="n">gsz</span><span class="o">++</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">==</span><span class="n">fa</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">b_gsz</span><span class="o">=</span><span class="n">gsz</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">b_sz</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]];</span>
        <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>

        <span class="n">ll</span> <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">gsz</span><span class="o">-</span><span class="n">b_gsz</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">-</span><span class="n">b_sz</span><span class="p">);</span>
        <span class="n">res</span><span class="o">+=</span><span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">+=</span><span class="n">d</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">flag</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sz</span><span class="p">));</span>
        <span class="n">gsz</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">discol</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">flag</span><span class="p">[</span><span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="n">discol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">u</span><span class="o">&gt;&gt;</span><span class="n">v</span><span class="p">;</span>
            <span class="n">adde</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
            <span class="n">adde</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">disnum</span><span class="o">=</span><span class="n">discol</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="n">dfs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">disnum</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">i</span><span class="p">:</span><span class="n">discol</span><span class="p">){</span>
            <span class="n">ll</span> <span class="n">t</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">ans</span><span class="o">-=</span><span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;Case #&#34;</span><span class="o">&lt;&lt;++</span><span class="n">kase</span><span class="o">&lt;&lt;</span><span class="s">&#34;: &#34;</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">-</span><span class="n">res</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/code/" term="code" label="code" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">快速傅里叶变换</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/study/fast-fourier-transform/" />
            <id>https://blog.kanari.moe/study/fast-fourier-transform/</id>
            <updated>2020-04-07T20:48:06+08:00</updated>
            <published>2019-07-12T14:03:22+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<blockquote>
<p>写代码是不可能写代码的,今下午是不想写代码的.不想写代码,又不想咸鱼,就只能靠学点新东西来假装自己在工作的样子,心里才能好受些.</p>
<blockquote>
<p>窃格码拉</p>
</blockquote>
</blockquote>
<p>几乎可以肯定,下面的内容肯定会出锅.</p>……]]></summary>
            
                <content type="html"><![CDATA[<blockquote>
<p>写代码是不可能写代码的,今下午是不想写代码的.不想写代码,又不想咸鱼,就只能靠学点新东西来假装自己在工作的样子,心里才能好受些.</p>
<blockquote>
<p>窃格码拉</p>
</blockquote>
</blockquote>
<p>几乎可以肯定,下面的内容肯定会出锅.</p>
<h2 id="傅里叶变换的实际意义">傅里叶变换的实际意义</h2>
<h3 id="从电压说起">从电压说起</h3>
<p>被模电折磨的同学都知道,有种东西叫做傅里叶级数,可以将成周期性变化的电压分解为数个三角函数波的叠加.</p>
<p>在这里,我们提出另一个问题,如果不知道周期,该如何将这些叠加在一起的信号拆分为单纯的三角波?</p>
<blockquote>
<p>三角波叠加图象周期并不那么显然,也许你可以试一试.</p>
</blockquote>
<h3 id="一种缠绕机">一种缠绕机</h3>
<p>有一种奇特的方法,我们将一段<code>时域图象</code>在笛卡尔坐标系上以原点为圆心<strong>绕</strong>起来,一圈一圈缠起来,然后调整源图象缠绕的速率(几秒一圈),观察整个图形的<strong>质心</strong>变化.</p>
<p>这个质心会随着图象缠绕的频率而发生位移.取质心的x坐标为y轴,以缠绕的频率为横轴,作出图象<code>B</code>.在这个图象上,会观测到一个现象:(假设我们已知原图像的分解三角波频率)当缠绕频率接近某个源三角波的频率时,缠绕图象出现<strong>重合</strong>,质心相对原点出现较大位移,图象出现一个<strong>峰值</strong>.</p>
<p>继续调整缠绕频率,峰值消失,图象回归到小范围波动.</p>
<p>通过观察图象<code>B</code>,可以认为,出现峰值的频率对应着一个频率的源三角波.如此,就将叠加图象还原了回去.</p>
<h2 id="傅里叶变换的数学实现">傅里叶变换的数学实现</h2>
<p>现在,考虑如何通过的数学的方法来实现这个缠绕.</p>
<h3 id="如何缠绕">如何缠绕</h3>
<p>将$g(t)$的图象缠绕到圆上听起来挺奇怪的,有这样的数学方法吗.</p>
<p>有一个东西,叫做$y=e^{ix}$.当其图象画在复平面时,就出现了有趣的事情:一个圆.对这个公式做一些加工.</p>
<p>$$
y=g(t)e^{-2\pi i ft}
$$</p>
<p>如此,就能够将$g(t)$以$f$频率缠绕.</p>
<h3 id="关于质心">关于质心</h3>
<p>上文我们取质心的x坐标作图,现在需要稍微修改一下.</p>
<p>实际上,我们关心的是质心相对于原点的偏移<strong>距离</strong>.同样,以复平面的方式来表示质心位置就能够同时保留x和y坐标信息.</p>
<p>关于如何求取质心,其实也很直观.选取缠绕图象上的数个点,取平均,就是质心的大约位置.当点的数目达到极限,求和公式化为积分,所求即为质心.</p>
<p>$$
\hat g(f)=\frac{1}{t_2-t_1} \int_{t_1}^{t_2}{g(t)e^{-2\pi i ft}}
$$</p>
<h3 id="heading">?</h3>
<p>目前为止,这几乎已经是傅里叶变换了.在数学应用时,傅里叶变换会去掉取均值,即</p>
<p>$$
\hat g(f)=\int_{t_1}^{t_2}{g(t)e^{-2\pi i ft}}
$$</p>
<p>也就是说,取样的时域信号越长,该质心的偏移倾向越大,这和我们想要的效果一致.</p>
<p>这就是傅里叶变换,实现了<code>时域信号</code>到<code>频域信号</code>的转换.</p>
<p>此外,还有方法将频域信号再次逆变换为时域信号的方法.</p>
<h2 id="应用">应用</h2>
<p>傅里叶变换在很多领域都有重要作用.只要问题能转换为时域频域之间的变化,就有傅里叶变换的用武之处.</p>
<p>比如,在音频处理软件中,常常有一个功能叫做<code>消除人声</code>.基于傅里叶变换我们可以设计一个(至少理论上有用)的算法.</p>
<p>首先,任何声音都是相应频率的波对气压变化引起的,也就是不同<strong>频率</strong>的波在<strong>时间</strong>上叠加在一起,产生了声音.将源波使用傅里叶变换拆分到多个三角波上去.<strong>删除人声所在的频域</strong>,再将频域信号逆变换为时域信号.人声便消失了.</p>
<h2 id="离散傅里叶变换">离散傅里叶变换</h2>
<p>连续意义下的傅里叶变换先到此为止.在计算机中所处理的数据一般都是离散的.我们需要的是离散傅里叶变换.</p>
<p>离散意义下的时域信号和频域信号就都变成了点集.当从连续向离散过渡时,可以这样思考:</p>
<blockquote>
<p>在连续的图象上以一定间隔<strong>取样</strong>得到离散点集.使用该点集进行傅里叶变换.</p>
</blockquote>
<p>这也是我们一开始采取的质心求解方法,只不过,这次我们从缠绕时就取样.(质点依然是真正的质点)
对于点集$g(0\leq n &lt; N)$,它的傅里叶变化就是</p>
<p>$$
\hat g(k)=\sum_{n=0}^{N-1}g(n)e^{-i\frac {2\pi}{N}nk}
$$</p>
<p>简单粗暴.</p>
<h2 id="快速傅里叶变换">快速傅里叶变换</h2>
<p>在了解了关于傅里叶变换的一系列背景与一个应用后,我们再回来解决一些重要的问题.</p>
<p>根据傅里叶变换的公式定义</p>
<p>$$
\hat g(k)=\sum_{n=0}^{N-1}g(n)e^{-i\frac {2\pi}{N}nk}
$$</p>
<p>其朴素算法的时间复杂度为$O(N^2)$ 这个复杂度还不够优秀.一种快速傅里叶变换算法利用$e^{ix}$的性质,将复杂度降低到了$O(N\lg N)$.</p>
<h3 id="单位根">单位根</h3>
<p>给$e^{ix}$个名字.</p>
<p>在数学上, $n$次<strong>单位根</strong>是 $n$次幂为1的复数.它们位于复平面的单位圆上,构成正n边形的顶点,其中一个顶点是1.</p>
<p>记</p>
<p>$$
\omega_{n,k}=-e^{i\frac{2\pi}{n}k}
$$</p>
<p>其几何意义为单位圆上的n等分点的顺时针第k个.</p>
<blockquote>
<p>一般来说,单位根取逆时针,不过这里为了方便,取顺时针.</p>
</blockquote>
<p>如同三角函数一样,单位根存在一些显然的定理.</p>
<p>**折半:**$\omega_{2n,2k}=\omega_{n,k}$</p>
<p>**化简:**$\omega_{n,k+\frac 2n}=-\omega_{n,k}$</p>
<h4 id="修改公式">修改公式</h4>
<p>来看原本的离散傅里叶变换公式</p>
<p>$$
\hat g(k)=\sum_{n=0}^{N-1}g(n)e^{-i\frac {2\pi}{N}nk}
$$</p>
<p>使用单位根来替换一下</p>
<p>$$
\hat g(k)=\sum_{n=0}^{N-1}\omega_{N,nk} g(n)
$$</p>
<p>按照<del>神</del>化简公式的指引,将求和公式按照单位根奇偶拆分为2部分.</p>
<p>​                                                                                                           <br>
$$
\begin{aligned}
\hat g(k) &amp;= \sum_{n=0}^{N-1}\omega_{N,nk} g(n) \<br>
&amp;= \sum_{0 \leq n &lt; N}\omega_{N,nk} g(n) \<br>
&amp;= \sum_{0 \leq 2n &lt; N}\omega_{N,2nk} g(2n) + \sum_{0 \leq 2n+1 &lt; N}\omega_{N,(2n+1)k} g(2n+1) \<br>
&amp;=\sum_{0 \leq 2n &lt; N}\omega_{N,2nk} g(2n) + \sum_{0 \leq 2n+1 &lt; N}\omega_{N,2nk+k} g(2n+1) \<br>
&amp;=\sum_{0 \leq 2n &lt; N}\omega_{\frac N2,nk} g(2n) + \omega_{N,k}\sum_{0 \leq 2n+1 &lt; N}\omega_{\frac N2,nk} g(2n+1) \<br>
&amp;=\hat g_{even}(k)+\omega_{N,k} \hat g_{odd}(k)
\end{aligned}
$$</p>
<p>注意到不管是$\hat g_{even}(k)$还是$\hat g_{even}(k)$,它们都以$N/2$为周期.接下来,应用化简定理</p>
<p>$$
\hat g(k+\frac N2)=\hat g_{even}(k)-\omega_{N,k} \hat g_{odd}(k)
$$</p>
<p>将这2个式子放在一起</p>
<p>$$
\hat g(k)=\hat g_{even}(k)+\omega_{N,k} \hat g_{odd}(k) \<br>
\hat g(k+\frac N2)=\hat g_{even}(k)-\omega_{N,k} \hat g_{odd}(k)
$$</p>
<p>当k取遍原问题规模的一半时,可以直接由第二个式子得到另一半.问题的规模减半.递归求解,最终的复杂度就降到了$O(N \lg N)$.</p>
<p>这就是<code>Cooley-Turkey</code>快速傅里叶变换算法.</p>
<h2 id="快速乘法">快速乘法</h2>
<p>定义多项式$A(x)=\sum_k a_kx^{k+1}$,$B(x)$同理,求解$C(x)=A(x)B(x)$.</p>
<p>很容易看出,朴素算法的复杂度为$O(N^2)$.</p>
<p>现在,来看如何使用FFT快速计算.</p>
<h3 id="点值表示">点值表示</h3>
<blockquote>
<p>对于一个次数为$n-1$的多项式,其图象上互不相同的$n$个点可以唯一确定该多项式.
...
如同确定混合在一起的几个波一样.</p>
</blockquote>
<p>至于为什么是对的,大可在Google上搜索一番.</p>
<p>取$x$为数个单位根,在$A(x)$和$B(x)$上利用单位根的性质得到$A$和$B$的点值表示,将点值相乘得到$C$的点值表示.之后,将$C$的点值表示再转换为系数表示.</p>
<p>嗯?FFT在哪?</p>
<p>其实在这里,</p>
<p>$$
\hat g(\omega)=A(\omega)=\sum_{n}\omega A[x^{n+1}]
$$</p>
<h3 id="离散卷积">离散卷积</h3>
<p>有一种<strong>数学运算</strong>,叫做<strong>卷积</strong>.现在只讨论它的离散情况.</p>
<p>$$
(f * g)(n)=\sum_{\tau=-\inf}^{inf}f(\tau)g(n-\tau)
$$</p>
<p>这玩意的意义...实在是不怎么明显.不过好在我们只是想算个多项式乘法,也就是把多项式的<strong>系数</strong>算来算去:</p>
<p>$C[x^n]$ 表示多项式$C$中$x^n$项的系数.</p>
<p>$$
C[x^{n}]=\sum_{\tau=0}^{n}A[x^\tau]B[x^{n-\tau}]
$$</p>
<p>嗯?</p>
<p>如果我们设多项式中不存在的项的系数为0的话.</p>
<p>$$
C[x^{n}]=\sum_{\tau=-\inf}^{\inf}A[x^\tau]B[x^{n-\tau}]
$$</p>
<p>哈,</p>
<p>$$
C[x^n]=(A*B)[x^n]
$$</p>
<h3 id="卷积定理">卷积定理</h3>
<p>卷积定理指出:</p>
<blockquote>
<p>一个域中的卷积对应于另一个域中的乘积.</p>
</blockquote>
<p>这意味着,上面这个计算(卷积)对应着另一个域里的乘积.也就是</p>
<p>$$
F(C[x^n])=F(A[x^n]) \cdot F(B[x^n])
$$</p>
<p>这便是深层原理.对A和B的取样(频域)称为A和B的点值表示,最终以乘积的方式得到了C的点值表示(频域).用FFT来计算乘法的说法是对的.</p>
<h2 id="傅里叶逆变换">傅里叶逆变换</h2>
<p>如何从一个频域信号再得到时域信号?</p>
<p>$$
g(n)=\frac 1N\sum_{k=0}^{N-1}e^{i\frac{2\pi}{N}nk} \hat g(k)
$$</p>
<blockquote>
<p>注意:此处的1/N与上面的变换是相匹配的.</p>
</blockquote>
<p>这个式子可以理解成对变换后的式子再变换,意味着它同样可以用变换时的思想来加速.</p>
<h2 id="fft的c实现">FFT的C++实现</h2>
<p>一个值得注意的问题就是,对于单位根的运算涉及到了精度的问题.但目前还不需要讨论.</p>
<h3 id="翻转操作">翻转操作</h3>
<p>可以观察到,按照上面的算法实现,我们需要在每次递归按照奇和偶将取样分组.且每次递归都会分组.每次分组都会涉及到数组的复制,常数较大.</p>
<p>观察分组操作中下标的变化.</p>
<pre><code>(表示下标)
0 1 2 3 4 5 6 7
0 2 4 6 | 1 3 5 7
0 4 | 2 6 | 1 5 | 3 7
</code></pre><p>将其转换为二进制</p>
<pre><code>000 001 010 011 100 101 110 111
000 100 010 110 001 101 011 111
</code></pre><p>可以发现,最终的分组结果就是将原下标二进制翻转.所以可以直接一次完成分组.</p>
<p>注意,<strong>这要求取样为2的幂次</strong>.</p>
<h3 id="蝴蝶操作">🦋蝴蝶操作</h3>
<p>解决了递归中由顶至底的分组后,接下来优化子问题合并时的数组复制.</p>
<p>观察原来的合并式子</p>
<p>$$
\hat g(k)=\hat g_{even}(k)+\omega_{N,k} \hat g_{odd}(k) \<br>
\hat g(k+\frac N2)=\hat g_{even}(k)-\omega_{N,k} \hat g_{odd}(k)
$$</p>
<p>按照算法中的实现方法,其为</p>
<p>$$
\hat g(k)=\hat g(k)+\omega_{N,k} \hat g(k+\frac N2) \<br>
\hat g(k+\frac N2)=\hat g(k)-\omega_{N,k} \hat g(k+\frac N2)
$$</p>
<p>想要省略数组复制,进行原地合并,问题出在新数值太早地替换掉了我们需要的数值.</p>
<p>取辅助变量,修改原式</p>
<p>$$
t=\omega_{N,k} \hat g(k+\frac N2)\<br>
\hat g(k+\frac N2)=\hat g(k)-t\<br>
\hat g(k)=\hat g(k)+t
$$</p>
<p>这个操作被称为&quot;蝴蝶操作&quot;,名字很有意思.</p>
<h3 id="代码">代码</h3>
<p>在这段代码中同时去掉了递归.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">const</span> <span class="kt">double</span> <span class="n">PI</span><span class="o">=</span><span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="kr">inline</span> <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">gomega</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="kt">bool</span> <span class="n">rev</span><span class="o">=</span><span class="nb">false</span><span class="p">){</span>
    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rev</span><span class="p">)</span><span class="k">return</span> <span class="n">conj</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">FFT</span><span class="p">{</span>
    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">omega</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">omegaI</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

    <span class="n">FFT</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">gomega</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
            <span class="n">omegaI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">gomega</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">transform</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="k">const</span> <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">omega</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">j</span><span class="p">)</span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="c1">//二进制换位
</span><span class="c1"></span>            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;(</span><span class="n">j</span><span class="o">^=</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="n">l</span><span class="p">;</span><span class="n">l</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">m</span><span class="o">=</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">p</span><span class="o">=</span><span class="n">a</span><span class="p">;</span><span class="n">p</span><span class="o">!=</span><span class="n">a</span><span class="o">+</span><span class="n">n</span><span class="p">;</span><span class="n">p</span><span class="o">+=</span><span class="n">l</span><span class="p">){</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
                <span class="c1">//蝴蝶操作
</span><span class="c1"></span>                    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">t</span><span class="o">=</span><span class="n">omega</span><span class="p">[</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="n">i</span><span class="p">];</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">;</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">t</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">dft</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="n">transform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">omega</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">idft</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="n">transform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">omegaI</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/=</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>如果想要实现快速乘法,只要将2个多项式的系数函数传入进行变换,变换结果相乘并逆变换即可.</p>
<h2 id="应用-1">应用</h2>
<h3 id="快速乘法-1">快速乘法</h3>
<p>指快速大数乘法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">300000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">PI</span><span class="o">=</span><span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="kr">inline</span> <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">gomega</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="kt">bool</span> <span class="n">rev</span><span class="o">=</span><span class="nb">false</span><span class="p">){</span>
    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rev</span><span class="p">)</span><span class="k">return</span> <span class="n">conj</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="nc">FFT</span><span class="p">{</span>
    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">omega</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">omegaI</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

    <span class="n">FFT</span><span class="p">(){</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">gomega</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
            <span class="n">omegaI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">gomega</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">transform</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="k">const</span> <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">omega</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">j</span><span class="p">)</span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="c1">//二进制换位
</span><span class="c1"></span>            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;(</span><span class="n">j</span><span class="o">^=</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="n">l</span><span class="p">;</span><span class="n">l</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">l</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">m</span><span class="o">=</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">p</span><span class="o">=</span><span class="n">a</span><span class="p">;</span><span class="n">p</span><span class="o">!=</span><span class="n">a</span><span class="o">+</span><span class="n">n</span><span class="p">;</span><span class="n">p</span><span class="o">+=</span><span class="n">l</span><span class="p">){</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
                    <span class="c1">//蝴蝶操作
</span><span class="c1"></span>                    <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">t</span><span class="o">=</span><span class="n">omega</span><span class="p">[</span><span class="n">n</span><span class="o">/</span><span class="n">l</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="n">i</span><span class="p">];</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">;</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">t</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">dft</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="n">transform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">omega</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">idft</span><span class="p">(</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
        <span class="n">transform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">omegaI</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/=</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">ans</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">FFT</span> <span class="n">fft</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>

    <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="c1">//根据原理，n必须取大于2nlen的数，才能满足取样要求和反转操作要求
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">*</span><span class="n">nlen</span><span class="p">)</span><span class="n">n</span><span class="o">*=</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">fft</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>


    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">string</span> <span class="n">inp</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">inp</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">inp</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">inp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">j</span><span class="o">++</span><span class="p">,</span><span class="n">k</span><span class="o">--</span><span class="p">){</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;</span><span class="mi">0</span><span class="o">&amp;</span><span class="err">#</span><span class="mo">03</span><span class="mi">9</span><span class="p">;,</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">fft</span><span class="p">.</span><span class="n">dft</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
    <span class="n">fft</span><span class="p">.</span><span class="n">idft</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">reslen</span><span class="o">=</span><span class="n">nlen</span><span class="o">+</span><span class="n">nlen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">reslen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">,</span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">real</span><span class="p">()</span><span class="o">+</span><span class="mf">0.5</span><span class="p">);</span>
    <span class="cm">/*
</span><span class="cm">    for(int i=0;i&lt;reslen;i++)cout&lt;&lt;ans[i]&lt;&lt;&#34; &#34;;
</span><span class="cm">    cout&lt;&lt;endl;
</span><span class="cm">    */</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">MAXN</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%=</span><span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">ptr</span><span class="o">=</span><span class="n">MAXN</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="n">ptr</span><span class="o">--</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span><span class="n">ptr</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">ptr</span><span class="o">--</span><span class="p">)</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="p">[</span><span class="n">ptr</span><span class="p">];</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/study/" term="study" label="study" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">我把快排写错了?</title>
            <link rel="alternate" type="text/html" href="https://blog.kanari.moe/gossip/do-i-write-qsort-right/" />
            <id>https://blog.kanari.moe/gossip/do-i-write-qsort-right/</id>
            <updated>2020-04-07T20:55:05+08:00</updated>
            <published>2019-07-12T14:02:52+08:00</published>
            <author>
                    <name>Kanari</name>
                    <uri>https://blog.kanari.moe/</uri>
                    <email>secret@a.b</email>
                    </author>
            
    
    <summary type="html"><![CDATA[<p>众所周知，快速排序的时间复杂度是$O(n\lg n)$的。然而因为我太菜，写出来的快速排序一不小心就成了$O(n^2)$...</p>……]]></summary>
            
                <content type="html"><![CDATA[<p>众所周知，快速排序的时间复杂度是$O(n\lg n)$的。然而因为我太菜，写出来的快速排序一不小心就成了$O(n^2)$...</p>
<h2 id="这个辣鸡问题">这个辣鸡问题</h2>
<p>这个应该都知道，当待排序数组已经有序时，固定选择某一个位置的数字当哨兵的快排会变成$O(n^2)$。一个解决方法就是随机选择哨兵，或者干脆将输入的数组打乱后再排序。</p>
<p>然而，如果输入的数组数字全部相同呢？</p>
<p>当然这在实际中很少见，但是在实现的时候就要小心。在这种情况下，所实现的快排必须对于相同数字也交换位置，否则就会退化为$O(n^2)$。</p>
<p>比如说，这个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp">    <span class="kt">void</span> <span class="nf">quicksort</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span><span class="kt">int</span> <span class="n">right</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">temp</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">left</span><span class="o">&gt;</span><span class="n">right</span><span class="p">)</span>
       <span class="k">return</span><span class="p">;</span>

    <span class="n">temp</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">left</span><span class="p">];</span> <span class="c1">//temp中存的就是基准数
</span><span class="c1"></span>    <span class="n">i</span><span class="o">=</span><span class="n">left</span><span class="p">;</span>
    <span class="n">j</span><span class="o">=</span><span class="n">right</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">)</span>
    <span class="p">{</span>
       <span class="c1">//顺序很重要，要先从右边开始找
</span><span class="c1"></span>       <span class="k">while</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">temp</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="p">)</span>
    <span class="n">j</span><span class="o">--</span><span class="p">;</span>
       <span class="c1">//再找右边的
</span><span class="c1"></span>       <span class="k">while</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">temp</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="p">)</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
       <span class="c1">//交换两个数在数组中的位置
</span><span class="c1"></span>       <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="p">)</span>
       <span class="p">{</span>
    <span class="n">t</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//最终将基准数归位
</span><span class="c1"></span>    <span class="n">a</span><span class="p">[</span><span class="n">left</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">temp</span><span class="p">;</span>

    <span class="n">quicksort</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="c1">//继续处理左边的，这里是一个递归的过程
</span><span class="c1"></span>    <span class="n">quicksort</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">right</span><span class="p">);</span><span class="c1">//继续处理右边的 ，这里是一个递归的过程
</span><span class="c1"></span>    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>还有这个，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">quick_sort</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span>
    <span class="p">{</span>
		<span class="c1">//Swap(s[l], s[(l + r) / 2]); //将中间的这个数和第一个数交换 参见注1
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// 从右向左找第一个小于x的数
</span><span class="c1"></span>				<span class="n">j</span><span class="o">--</span><span class="p">;</span>  
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span> 
				<span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			
            <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// 从左向右找第一个大于等于x的数
</span><span class="c1"></span>				<span class="n">i</span><span class="o">++</span><span class="p">;</span>  
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span> 
				<span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">--</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">quick_sort</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 递归调用 
</span><span class="c1"></span>        <span class="n">quick_sort</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>它们都会跳过相同的数字，每次排序后哨兵总会在边界上，导致算法劣化到$O(n^2)$。</p>
<p>大概就是这回事，没别的了。这种情况当然有改进的快速排序可以直接避免这种罕见的情况，在不大幅度改动算法的前提下，就要对相同的元素也进行换位才可以，即使会增加交换次数。</p>]]></content>
            
            
            
                
                
                
                    
                    
                    
                        
                            <category scheme="https://blog.kanari.moe/gossip/" term="gossip" label="gossip" />
                        
                    
                
            
            
            
                
                    
                
            
        </entry>
    
</feed>
