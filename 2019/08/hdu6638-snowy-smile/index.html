<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>[HDU6638] Snowy Smile - Kanari&#39;s blog</title>
        <meta name="Description" content="Kanari&#39;s blog"><meta property="og:title" content="[HDU6638] Snowy Smile" />
<meta property="og:description" content="There are n pirate chests buried in Byteland, labeled by 1,2,…,n. The i-th chest&rsquo;s location is (xi,yi), and its value is wi, wi can be negative since the pirate can add some poisonous gases into the chest. When you open the i-th pirate chest, you will get wi value.
You want to make money from these pirate chests. You can select a rectangle, the sides of which are all paralleled to the axes, and then all the chests inside it or on its border will be opened. Note that you must open all the chests within that range regardless of their values are positive or negative. But you can choose a rectangle with nothing in it to get a zero sum.
Please write a program to find the best rectangle with maximum total value.
The first line of the input contains an integer T(1≤T≤100), denoting the number of test cases.
In each test case, there is one integer n(1≤n≤2000) in the first line, denoting the number of pirate chests.
For the next n lines, each line contains three integers xi,yi,wi(−109≤xi,yi,wi≤109), denoting each pirate chest.
It is guaranteed that ∑n≤10000.
分析
首先，我没做出来。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/2019/08/hdu6638-snowy-smile/" />
<meta property="article:published_time" content="2019-08-07T20:45:09+08:00" />
<meta property="article:modified_time" content="2019-08-07T20:45:09+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[HDU6638] Snowy Smile"/>
<meta name="twitter:description" content="There are n pirate chests buried in Byteland, labeled by 1,2,…,n. The i-th chest&rsquo;s location is (xi,yi), and its value is wi, wi can be negative since the pirate can add some poisonous gases into the chest. When you open the i-th pirate chest, you will get wi value.
You want to make money from these pirate chests. You can select a rectangle, the sides of which are all paralleled to the axes, and then all the chests inside it or on its border will be opened. Note that you must open all the chests within that range regardless of their values are positive or negative. But you can choose a rectangle with nothing in it to get a zero sum.
Please write a program to find the best rectangle with maximum total value.
The first line of the input contains an integer T(1≤T≤100), denoting the number of test cases.
In each test case, there is one integer n(1≤n≤2000) in the first line, denoting the number of pirate chests.
For the next n lines, each line contains three integers xi,yi,wi(−109≤xi,yi,wi≤109), denoting each pirate chest.
It is guaranteed that ∑n≤10000.
分析
首先，我没做出来。"/>
<meta name="application-name" content="Kanari&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Kanari&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/2019/08/hdu6638-snowy-smile/" /><link rel="prev" href="http://example.org/2019/08/mo-s-algorithm/" /><link rel="next" href="http://example.org/2019/08/fzu-2204seven/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[HDU6638] Snowy Smile",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/2019\/08\/hdu6638-snowy-smile\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","wordcount":  655 ,
        "url": "http:\/\/example.org\/2019\/08\/hdu6638-snowy-smile\/","datePublished": "2019-08-07T20:45:09+08:00","dateModified": "2019-08-07T20:45:09+08:00","publisher": {
                "@type": "Organization",
                "name": "Kanari",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "Kanari"
            },"description": ""
    }
    </script></head>
    <body><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kanari&#39;s blog">Kanari&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kanari&#39;s blog">Kanari&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">[HDU6638] Snowy Smile</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kanari</a></span>&nbsp;
                    <span class="post-category">收录于<a href="/categories/code/">
                                <i class="far fa-folder fa-fw"></i>code
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-08-07>2019-08-07</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 655 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 2 分钟&nbsp;<span id="/2019/08/hdu6638-snowy-smile/" class="leancloud_visitors" data-flag-title="[HDU6638] Snowy Smile">
                        <i class="far fa-eye fa-fw"></i><span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="content" id="content"><p>There are n pirate chests buried in Byteland, labeled by 1,2,…,n. The i-th chest&rsquo;s location is (xi,yi), and its value is wi, wi can be negative since the pirate can add some poisonous gases into the chest. When you open the i-th pirate chest, you will get wi value.</p>
<p>You want to make money from these pirate chests. You can select a rectangle, the sides of which are all paralleled to the axes, and then all the chests inside it or on its border will be opened. Note that you must open all the chests within that range regardless of their values are positive or negative. But you can choose a rectangle with nothing in it to get a zero sum.</p>
<p>Please write a program to find the best rectangle with maximum total value.</p>
<p>The first line of the input contains an integer T(1≤T≤100), denoting the number of test cases.</p>
<p>In each test case, there is one integer n(1≤n≤2000) in the first line, denoting the number of pirate chests.</p>
<p>For the next n lines, each line contains three integers xi,yi,wi(−109≤xi,yi,wi≤109), denoting each pirate chest.</p>
<p>It is guaranteed that ∑n≤10000.</p>
<h2 id="分析">分析</h2>
<p>首先，我没做出来。</p>
<p>这道题实际上就是在要求你用小于$O(N^3)$的复杂度求出最大和子矩阵。注意到该题的点<strong>稀疏</strong>，所以以点为考虑对象。</p>
<p>三方的做法，枚举矩阵的上边界和下边界，维护纵向上的和，求最大字段和。当以点考虑时，上下边界就可以直接由<strong>排序后</strong>的点决定。之后，使用线段树维护最大子段和。</p>
<h2 id="代码">代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span><span class="o">=</span><span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MAXN</span><span class="o">=</span><span class="mi">400010</span><span class="p">;</span>

<span class="n">ll</span> <span class="n">d_sub</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">d_pre</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">d_suf</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">d_sum</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">lc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="n">rc</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="n">n</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
    <span class="n">d_sum</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_sub</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_pre</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d_suf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
    <span class="c1">//combine data
</span><span class="c1"></span><span class="p">}</span>
<span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="n">d_sum</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_sum</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_sum</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]];</span>

    <span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">d_pre</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sum</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_pre</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>
    <span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">d_suf</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sum</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_suf</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>

    <span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d_sub</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span><span class="n">d_sub</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]),</span><span class="n">d_suf</span><span class="p">[</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">+</span><span class="n">d_pre</span><span class="p">[</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span><span class="kt">int</span> <span class="n">R</span><span class="p">,</span><span class="kt">int</span> <span class="n">node</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">L</span> <span class="o">&amp;&amp;</span> <span class="n">R</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">){</span>
        <span class="c1">//only single point to modify
</span><span class="c1"></span>        <span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_sub</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_pre</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">d_suf</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
        <span class="n">d_sum</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">lc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span><span class="n">modify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">rc</span><span class="p">[</span><span class="n">node</span><span class="p">]);</span>

    <span class="n">collect</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
<span class="n">ll</span> <span class="nf">query_all</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">d_sub</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">Chest</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Chest</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="k">return</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">chests</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">refy</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">kase</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">kase</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">kase</span><span class="o">--</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">nlen</span><span class="p">;</span>
        <span class="n">refy</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">Chest</span> <span class="o">&amp;</span><span class="n">chest</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="n">chest</span><span class="p">.</span><span class="n">v</span><span class="p">;</span>
            <span class="n">refy</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">chest</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">chests</span><span class="p">,</span><span class="n">chests</span><span class="o">+</span><span class="n">nlen</span><span class="p">);</span>

        <span class="n">sort</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refy</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="k">auto</span> <span class="n">refyend</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refy</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="kt">int</span> <span class="n">maxy</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">refyend</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">refy</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">maxy</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">lastx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lastx</span><span class="o">==</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span>
            <span class="n">lastx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
            <span class="c1">//cout&lt;&lt;&#34;start from &#34;&lt;&lt;lastx&lt;&lt;endl;
</span><span class="c1"></span>
            <span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxy</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">nextx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">nlen</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="o">!=</span><span class="n">nextx</span><span class="p">){</span>
                    <span class="n">nextx</span><span class="o">=</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
                    <span class="n">ans</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query_all</span><span class="p">());</span>
                <span class="p">}</span>
                <span class="n">modify</span><span class="p">(</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">,</span><span class="n">chests</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxy</span><span class="p">,</span><span class="n">root</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">query_all</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">max</span><span class="p">(</span><span class="mi">0ll</span><span class="p">,</span><span class="n">ans</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2019-08-07 更新</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://example.org/2019/08/hdu6638-snowy-smile/" data-title="[HDU6638] Snowy Smile"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="http://example.org/2019/08/hdu6638-snowy-smile/" data-title="[HDU6638] Snowy Smile"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2019/08/mo-s-algorithm/" class="prev" rel="prev" title="莫队算法"><i class="fas fa-angle-left fa-fw"></i>莫队算法</a>
            <a href="/2019/08/fzu-2204seven/" class="next" rel="next" title="[FZU 2204]Seven">[FZU 2204]Seven<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Kanari</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript">
    window.config = {"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"8nBBk4hz3GnYEEbGmLHafecq-gzGzoHsz","appKey":"LnYrhY3glo9zNm02k21R0XHb","avatar":"mp","el":"#valine","enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"headerMode":{"desktop":"fixed","mobile":"auto"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","noResultsFound":"没有找到结果","type":"lunr"}};
</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=Element.prototype.closest%2CrequestAnimationFrame%2CCustomEvent%2CPromise%2CObject.entries%2CObject.assign%2CObject.values%2Cfetch%2CElement.prototype.after%2CArray.prototype.fill%2CIntersectionObserver%2CArray.from%2CArray.prototype.find%2CMath.sign"></script><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/object-fit-images/ofi.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
            ga('create', 'UA-104395871-2',{ 'storage': 'none' });ga('set', 'anonymizeIp', true);ga('send', 'pageview');
        </script><script type="text/javascript" src="https://www.google-analytics.com/analytics.js" async></script></body>
</html>
